const vl=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};vl();var Xi=function(e,t){return Xi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Xi(e,t)};function R(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Xi(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var kn=function(){return kn=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},kn.apply(this,arguments)};function m(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function u(h){try{c(r.next(h))}catch(l){s(l)}}function a(h){try{c(r.throw(h))}catch(l){s(l)}}function c(h){h.done?o(h.value):i(h.value).then(u,a)}c((r=r.apply(e,t||[])).next())})}function y(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(c){return function(h){return a([c,h])}}function a(c){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(c[0]===6&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(h){c=[6,h],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Pi(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function dr(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function H(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var da=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},gl=function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){var o=e[n++],s=e[n++],u=e[n++],a=((i&7)<<18|(o&63)<<12|(s&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(a>>10)),t[r++]=String.fromCharCode(56320+(a&1023))}else{var o=e[n++],s=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return t.join("")},yl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,u=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,h=o>>2,l=(o&3)<<4|u>>4,f=(u&15)<<2|c>>6,p=c&63;a||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(da(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):gl(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length,u=s?n[e.charAt(i)]:0;++i;var a=i<e.length,c=a?n[e.charAt(i)]:64;++i;var h=i<e.length,l=h?n[e.charAt(i)]:64;if(++i,o==null||u==null||c==null||l==null)throw Error();var f=o<<2|u>>4;if(r.push(f),c!==64){var p=u<<4&240|c>>2;if(r.push(p),l!==64){var d=c<<6&192|l;r.push(d)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},ml=function(e){var t=da(e);return yl.encodeByteArray(t,!0)},Bs=function(e){return ml(e).replace(/\./g,"")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(e){return xn(void 0,e)}function xn(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var n=t;return new Date(n.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)!t.hasOwnProperty(r)||!bl(r)||(e[r]=xn(e[r],t[r]));return e}function bl(e){return e!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var El=function(){function e(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(n,r){t.resolve=n,t.reject=r})}return e.prototype.wrapCallback=function(t){var n=this;return function(r,i){r?n.reject(r):n.resolve(i),typeof t=="function"&&(n.promise.catch(function(){}),t.length===1?t(r):t(r,i))}},e}();/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=kn({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e),u="";return[Bs(JSON.stringify(n)),Bs(JSON.stringify(s)),u].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _e(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Tl(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_e())}function va(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _l(){return typeof self=="object"&&self.self===self}function Sl(){var e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Al(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Nl(){return _e().indexOf("Electron/")>=0}function Dl(){var e=_e();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Cl(){return _e().indexOf("MSAppHost/")>=0}function Rl(){return!va()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kl="FirebaseError",xl=function(e){R(t,e);function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name=kl,Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,No.prototype.create),o}return t}(Error),No=function(){function e(t,n,r){this.service=t,this.serviceName=n,this.errors=r}return e.prototype.create=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=n[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?Ol(s,i):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new xl(o,a,i);return c},e}();function Ol(e,t){return e.replace(Ll,function(n,r){var i=t[r];return i!=null?String(i):"<"+r+"?>"})}var Ll=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ks(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pl(e,t){var n=new Fl(e,t);return n.subscribe.bind(n)}var Fl=function(){function e(t,n){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(function(){t(r)}).catch(function(i){r.error(i)})}return e.prototype.next=function(t){this.forEachObserver(function(n){n.next(t)})},e.prototype.error=function(t){this.forEachObserver(function(n){n.error(t)}),this.close(t)},e.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},e.prototype.subscribe=function(t,n,r){var i=this,o;if(t===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Ml(t,["next","error","complete"])?o=t:o={next:t,error:n,complete:r},o.next===void 0&&(o.next=Fi),o.error===void 0&&(o.error=Fi),o.complete===void 0&&(o.complete=Fi);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?o.error(i.finalError):o.complete()}catch{}}),this.observers.push(o),s},e.prototype.unsubscribeOne=function(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))},e.prototype.forEachObserver=function(t){if(!this.finalized)for(var n=0;n<this.observers.length;n++)this.sendOne(n,t)},e.prototype.sendOne=function(t,n){var r=this;this.task.then(function(){if(r.observers!==void 0&&r.observers[t]!==void 0)try{n(r.observers[t])}catch(i){typeof console!="undefined"&&console.error&&console.error(i)}})},e.prototype.close=function(t){var n=this;this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(function(){n.observers=void 0,n.onNoObservers=void 0}))},e}();function Ml(e,t){if(typeof e!="object"||e===null)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&typeof e[i]=="function")return!0}return!1}function Fi(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X(e){return e&&e._delegate?e._delegate:e}var ii=function(){function e(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},e.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},e.prototype.setServiceProps=function(t){return this.serviceProps=t,this},e.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},e}();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ve="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vl=function(){function e(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return e.prototype.get=function(t){var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var r=new El;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{var i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise},e.prototype.getImmediate=function(t){var n,r=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(n=t==null?void 0:t.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error("Service "+this.name+" is not available")}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(t){var n,r;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,!!this.shouldAutoInitialize()){if(ql(t))try{this.getOrInitializeService({instanceIdentifier:ve})}catch{}try{for(var i=Pi(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=dr(o.value,2),u=s[0],a=s[1],c=this.normalizeInstanceIdentifier(u);try{var h=this.getOrInitializeService({instanceIdentifier:c});a.resolve(h)}catch{}}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}},e.prototype.clearInstance=function(t){t===void 0&&(t=ve),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},e.prototype.delete=function(){return m(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(H(H([],dr(t.filter(function(r){return"INTERNAL"in r}).map(function(r){return r.INTERNAL.delete()}))),dr(t.filter(function(r){return"_delete"in r}).map(function(r){return r._delete()}))))];case 1:return n.sent(),[2]}})})},e.prototype.isComponentSet=function(){return this.component!=null},e.prototype.isInitialized=function(t){return t===void 0&&(t=ve),this.instances.has(t)},e.prototype.getOptions=function(t){return t===void 0&&(t=ve),this.instancesOptions.get(t)||{}},e.prototype.initialize=function(t){var n,r;t===void 0&&(t={});var i=t.options,o=i===void 0?{}:i,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var u=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var a=Pi(this.instancesDeferred.entries()),c=a.next();!c.done;c=a.next()){var h=dr(c.value,2),l=h[0],f=h[1],p=this.normalizeInstanceIdentifier(l);s===p&&f.resolve(u)}}catch(d){n={error:d}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return u},e.prototype.onInit=function(t,n){var r,i=this.normalizeInstanceIdentifier(n),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(t),this.onInitCallbacks.set(i,o);var s=this.instances.get(i);return s&&t(s,i),function(){o.delete(t)}},e.prototype.invokeOnInitCallbacks=function(t,n){var r,i,o=this.onInitCallbacks.get(n);if(!!o)try{for(var s=Pi(o),u=s.next();!u.done;u=s.next()){var a=u.value;try{a(t,n)}catch{}}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},e.prototype.getOrInitializeService=function(t){var n=t.instanceIdentifier,r=t.options,i=r===void 0?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Ul(n),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch{}return o||null},e.prototype.normalizeInstanceIdentifier=function(t){return t===void 0&&(t=ve),this.component?this.component.multipleInstances?t:ve:t},e.prototype.shouldAutoInitialize=function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"},e}();function Ul(e){return e===ve?void 0:e}function ql(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jl=function(){function e(t){this.name=t,this.providers=new Map}return e.prototype.addComponent=function(t){var n=this.getProvider(t.name);if(n.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);n.setComponent(t)},e.prototype.addOrOverwriteComponent=function(t){var n=this.getProvider(t.name);n.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},e.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var n=new Vl(t,this);return this.providers.set(t,n),n},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Lt(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var de,Do=[],V;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(V||(V={}));var ga={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},Bl=V.INFO,Kl=(de={},de[V.DEBUG]="log",de[V.VERBOSE]="log",de[V.INFO]="info",de[V.WARN]="warn",de[V.ERROR]="error",de),zl=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=new Date().toISOString(),o=Kl[t];if(o)console[o].apply(console,Lt(["["+i+"]  "+e.name+":"],n));else throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}},ya=function(){function e(t){this.name=t,this._logLevel=Bl,this._logHandler=zl,this._userLogHandler=null,Do.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in V))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel=typeof t=="string"?ga[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,V.DEBUG],t)),this._logHandler.apply(this,Lt([this,V.DEBUG],t))},e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,V.VERBOSE],t)),this._logHandler.apply(this,Lt([this,V.VERBOSE],t))},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,V.INFO],t)),this._logHandler.apply(this,Lt([this,V.INFO],t))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,V.WARN],t)),this._logHandler.apply(this,Lt([this,V.WARN],t))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Lt([this,V.ERROR],t)),this._logHandler.apply(this,Lt([this,V.ERROR],t))},e}();function Gl(e){Do.forEach(function(t){t.setLogLevel(e)})}function $l(e,t){for(var n=function(s){var u=null;t&&t.level&&(u=ga[t.level]),e===null?s.userLogHandler=null:s.userLogHandler=function(a,c){for(var h=[],l=2;l<arguments.length;l++)h[l-2]=arguments[l];var f=h.map(function(p){if(p==null)return null;if(typeof p=="string")return p;if(typeof p=="number"||typeof p=="boolean")return p.toString();if(p instanceof Error)return p.message;try{return JSON.stringify(p)}catch{return null}}).filter(function(p){return p}).join(" ");c>=(u!=null?u:a.logLevel)&&e({level:V[c].toLowerCase(),message:f,args:h,type:a.name})}},r=0,i=Do;r<i.length;r++){var o=i[r];n(o)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xt,Hl=(Xt={},Xt["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Xt["bad-app-name"]="Illegal App name: '{$appName}",Xt["duplicate-app"]="Firebase App named '{$appName}' already exists",Xt["app-deleted"]="Firebase App named '{$appName}' already deleted",Xt["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Xt["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Xt),Be=new No("app","Firebase",Hl),ma="@firebase/app",Ql="0.6.30",Wl="@firebase/analytics",Yl="@firebase/app-check",Xl="@firebase/auth",Jl="@firebase/database",Zl="@firebase/functions",tf="@firebase/installations",ef="@firebase/messaging",nf="@firebase/performance",rf="@firebase/remote-config",of="@firebase/storage",sf="@firebase/firestore",uf="firebase-wrapper";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ct,kr="[DEFAULT]",af=(ct={},ct[ma]="fire-core",ct[Wl]="fire-analytics",ct[Yl]="fire-app-check",ct[Xl]="fire-auth",ct[Jl]="fire-rtdb",ct[Zl]="fire-fn",ct[tf]="fire-iid",ct[ef]="fire-fcm",ct[nf]="fire-perf",ct[rf]="fire-rc",ct[of]="fire-gcs",ct[sf]="fire-fst",ct["fire-js"]="fire-js",ct[uf]="fire-js-all",ct);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qe=new ya("@firebase/app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _r=function(){function e(t,n,r){var i=this;this.firebase_=r,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=wl(t),this.container=new jl(n.name),this._addComponent(new ii("app",function(){return i},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(o){return i._addComponent(o)})}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var t=this;return new Promise(function(n){t.checkDestroyed_(),n()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(n){return n.delete()}))}).then(function(){t.isDeleted_=!0})},e.prototype._getService=function(t,n){var r;n===void 0&&(n=kr),this.checkDestroyed_();var i=this.container.getProvider(t);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(t,n){n===void 0&&(n=kr),this.container.getProvider(t).clearInstance(n)},e.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(n){Qe.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Be.create("app-deleted",{appName:this.name_})},e}();_r.prototype.name&&_r.prototype.options||_r.prototype.delete||console.log("dc");var cf="8.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(e){var t={},n=new Map,r={__esModule:!0,initializeApp:s,app:o,registerVersion:c,setLogLevel:Gl,onLog:h,apps:null,SDK_VERSION:cf,INTERNAL:{registerComponent:a,removeApp:i,components:n,useAsService:l}};r.default=r,Object.defineProperty(r,"apps",{get:u});function i(f){delete t[f]}function o(f){if(f=f||kr,!Ks(t,f))throw Be.create("no-app",{appName:f});return t[f]}o.App=e;function s(f,p){if(p===void 0&&(p={}),typeof p!="object"||p===null){var d=p;p={name:d}}var g=p;g.name===void 0&&(g.name=kr);var b=g.name;if(typeof b!="string"||!b)throw Be.create("bad-app-name",{appName:String(b)});if(Ks(t,b))throw Be.create("duplicate-app",{appName:b});var I=new e(f,g,r);return t[b]=I,I}function u(){return Object.keys(t).map(function(f){return t[f]})}function a(f){var p=f.name;if(n.has(p))return Qe.debug("There were multiple attempts to register component "+p+"."),f.type==="PUBLIC"?r[p]:null;if(n.set(p,f),f.type==="PUBLIC"){var d=function(N){if(N===void 0&&(N=o()),typeof N[p]!="function")throw Be.create("invalid-app-argument",{appName:p});return N[p]()};f.serviceProps!==void 0&&xn(d,f.serviceProps),r[p]=d,e.prototype[p]=function(){for(var N=[],A=0;A<arguments.length;A++)N[A]=arguments[A];var O=this._getService.bind(this,p);return O.apply(this,f.multipleInstances?N:[])}}for(var g=0,b=Object.keys(t);g<b.length;g++){var I=b[g];t[I]._addComponent(f)}return f.type==="PUBLIC"?r[p]:null}function c(f,p,d){var g,b=(g=af[f])!==null&&g!==void 0?g:f;d&&(b+="-"+d);var I=b.match(/\s|\//),N=p.match(/\s|\//);if(I||N){var A=['Unable to register library "'+b+'" with version "'+p+'":'];I&&A.push('library name "'+b+'" contains illegal characters (whitespace or "/")'),I&&N&&A.push("and"),N&&A.push('version name "'+p+'" contains illegal characters (whitespace or "/")'),Qe.warn(A.join(" "));return}a(new ii(b+"-version",function(){return{library:b,version:p}},"VERSION"))}function h(f,p){if(f!==null&&typeof f!="function")throw Be.create("invalid-log-argument");$l(f,p)}function l(f,p){if(p==="serverAuth")return null;var d=p;return d}return r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wa(){var e=hf(_r);e.INTERNAL=kn(kn({},e.INTERNAL),{createFirebaseNamespace:wa,extendNamespace:t,createSubscribe:Pl,ErrorFactory:No,deepExtend:xn});function t(n){xn(e,n)}return e}var Co=wa();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var lf=function(){function e(t){this.container=t}return e.prototype.getPlatformInfoString=function(){var t=this.container.getProviders();return t.map(function(n){if(ff(n)){var r=n.getImmediate();return r.library+"/"+r.version}else return null}).filter(function(n){return n}).join(" ")},e}();function ff(e){var t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(e,t){e.INTERNAL.registerComponent(new ii("platform-logger",function(n){return new lf(n)},"PRIVATE")),e.registerVersion(ma,Ql,t),e.registerVersion("fire-js","")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(_l()&&self.firebase!==void 0){Qe.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var zs=self.firebase.SDK_VERSION;zs&&zs.indexOf("LITE")>=0&&Qe.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var df=Co.initializeApp;Co.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return va()&&Qe.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/@rollup/plugin-node-resolve
      `),df.apply(void 0,e)};var Se=Co;pf(Se);var vf="firebase",ba="8.10.1";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Se.registerVersion(vf,ba,"app");Se.SDK_VERSION=ba;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ji=function(e,t){return Ji=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Ji(e,t)};function gf(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ji(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Ea(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var yf=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S,Ro=Ro||{},x=yf||self;function xr(){}function Zi(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function Wn(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function mf(e){return Object.prototype.hasOwnProperty.call(e,Mi)&&e[Mi]||(e[Mi]=++wf)}var Mi="closure_uid_"+(1e9*Math.random()>>>0),wf=0;function bf(e,t,n){return e.call.apply(e.bind,arguments)}function Ef(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function st(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?st=bf:st=Ef,st.apply(null,arguments)}function vr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function at(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(r,i,o){for(var s=Array(arguments.length-2),u=2;u<arguments.length;u++)s[u-2]=arguments[u];return t.prototype[i].apply(r,s)}}function ce(){this.s=this.s,this.o=this.o}var If=0;ce.prototype.s=!1;ce.prototype.na=function(){!this.s&&(this.s=!0,this.M(),If!=0)&&mf(this)};ce.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ia=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ta=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=typeof e=="string"?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function Tf(e){t:{for(var t=dp,n=e.length,r=typeof e=="string"?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break t}t=-1}return 0>t?null:typeof e=="string"?e.charAt(t):e[t]}function Gs(e){return Array.prototype.concat.apply([],arguments)}function ko(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Or(e){return/^[\s\xa0]*$/.test(e)}var $s=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function yt(e,t){return e.indexOf(t)!=-1}function Vi(e,t){return e<t?-1:e>t?1:0}var mt;t:{var Hs=x.navigator;if(Hs){var Qs=Hs.userAgent;if(Qs){mt=Qs;break t}}mt=""}function xo(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function _a(e){var t={};for(var n in e)t[n]=e[n];return t}var Ws="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sa(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<Ws.length;o++)n=Ws[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Oo(e){return Oo[" "](e),e}Oo[" "]=xr;function _f(e){var t=Nf;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}var Sf=yt(mt,"Opera"),We=yt(mt,"Trident")||yt(mt,"MSIE"),Aa=yt(mt,"Edge"),to=Aa||We,Na=yt(mt,"Gecko")&&!(yt(mt.toLowerCase(),"webkit")&&!yt(mt,"Edge"))&&!(yt(mt,"Trident")||yt(mt,"MSIE"))&&!yt(mt,"Edge"),Af=yt(mt.toLowerCase(),"webkit")&&!yt(mt,"Edge");function Da(){var e=x.document;return e?e.documentMode:void 0}var Lr;t:{var Ui="",qi=function(){var e=mt;if(Na)return/rv:([^\);]+)(\)|;)/.exec(e);if(Aa)return/Edge\/([\d\.]+)/.exec(e);if(We)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(Af)return/WebKit\/(\S+)/.exec(e);if(Sf)return/(?:Version)[ \/]?(\S+)/.exec(e)}();if(qi&&(Ui=qi?qi[1]:""),We){var ji=Da();if(ji!=null&&ji>parseFloat(Ui)){Lr=String(ji);break t}}Lr=Ui}var Nf={};function Df(){return _f(function(){for(var e=0,t=$s(String(Lr)).split("."),n=$s("9").split("."),r=Math.max(t.length,n.length),i=0;e==0&&i<r;i++){var o=t[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o[0].length==0&&s[0].length==0)break;e=Vi(o[1].length==0?0:parseInt(o[1],10),s[1].length==0?0:parseInt(s[1],10))||Vi(o[2].length==0,s[2].length==0)||Vi(o[2],s[2]),o=o[3],s=s[3]}while(e==0)}return 0<=e})}var eo;if(x.document&&We){var Ys=Da();eo=Ys||parseInt(Lr,10)||void 0}else eo=void 0;var Cf=eo,Rf=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{x.addEventListener("test",xr,t),x.removeEventListener("test",xr,t)}catch{}return e}();function pt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}pt.prototype.h=function(){this.defaultPrevented=!0};function On(e,t){if(pt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Na){t:{try{Oo(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:kf[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&On.Z.h.call(this)}}at(On,pt);var kf={2:"touch",3:"pen",4:"mouse"};On.prototype.h=function(){On.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Yn="closure_listenable_"+(1e6*Math.random()|0),xf=0;function Of(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++xf,this.ca=this.fa=!1}function oi(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function si(e){this.src=e,this.g={},this.h=0}si.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.g[o],e||(e=this.g[o]=[],this.h++);var s=ro(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):(t=new Of(t,this.src,o,!!r,i),t.fa=n,e.push(t)),t};function no(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=Ia(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(oi(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function ro(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.ca&&o.listener==t&&o.capture==!!n&&o.ia==r)return i}return-1}var Lo="closure_lm_"+(1e6*Math.random()|0),Bi={};function Ca(e,t,n,r,i){if(r&&r.once)return ka(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)Ca(e,t[o],n,r,i);return null}return n=Mo(n),e&&e[Yn]?e.N(t,n,Wn(r)?!!r.capture:!!r,i):Ra(e,t,n,!1,r,i)}function Ra(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=Wn(i)?!!i.capture:!!i,u=Fo(e);if(u||(e[Lo]=u=new si(e)),n=u.add(t,n,r,s,o),n.proxy)return n;if(r=Lf(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Rf||(i=s),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Oa(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Lf(){function e(n){return t.call(e.src,e.listener,n)}var t=Pf;return e}function ka(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)ka(e,t[o],n,r,i);return null}return n=Mo(n),e&&e[Yn]?e.O(t,n,Wn(r)?!!r.capture:!!r,i):Ra(e,t,n,!0,r,i)}function xa(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)xa(e,t[o],n,r,i);else r=Wn(r)?!!r.capture:!!r,n=Mo(n),e&&e[Yn]?(e=e.i,t=String(t).toString(),t in e.g&&(o=e.g[t],n=ro(o,n,r,i),-1<n&&(oi(o[n]),Array.prototype.splice.call(o,n,1),o.length==0&&(delete e.g[t],e.h--)))):e&&(e=Fo(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ro(t,n,r,i)),(n=-1<e?t[e]:null)&&Po(n))}function Po(e){if(typeof e!="number"&&e&&!e.ca){var t=e.src;if(t&&t[Yn])no(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Oa(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Fo(t))?(no(n,e),n.h==0&&(n.src=null,t[Lo]=null)):oi(e)}}}function Oa(e){return e in Bi?Bi[e]:Bi[e]="on"+e}function Pf(e,t){if(e.ca)e=!0;else{t=new On(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Po(e),e=n.call(r,t)}return e}function Fo(e){return e=e[Lo],e instanceof si?e:null}var Ki="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mo(e){return typeof e=="function"?e:(e[Ki]||(e[Ki]=function(t){return e.handleEvent(t)}),e[Ki])}function nt(){ce.call(this),this.i=new si(this),this.P=this,this.I=null}at(nt,ce);nt.prototype[Yn]=!0;nt.prototype.removeEventListener=function(e,t,n,r){xa(this,e,t,n,r)};function ut(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,typeof t=="string")t=new pt(t,e);else if(t instanceof pt)t.target=t.target||e;else{var i=t;t=new pt(r,e),Sa(t,i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=gr(s,r,!0,t)&&i}if(s=t.g=e,i=gr(s,r,!0,t)&&i,i=gr(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=gr(s,r,!1,t)&&i}nt.prototype.M=function(){if(nt.Z.M.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)oi(n[r]);delete e.g[t],e.h--}}this.I=null};nt.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};nt.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function gr(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.ca&&s.capture==n){var u=s.listener,a=s.ia||s.src;s.fa&&no(e.i,s),i=u.call(a,r)!==!1&&i}}return i&&!r.defaultPrevented}var Vo=x.JSON.stringify;function Ff(){var e=Pa,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Mf=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,n){var r=La.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r},e}(),La=new(function(){function e(t,n){this.i=t,this.j=n,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},e}())(function(){return new Vf},function(e){return e.reset()}),Vf=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,n){this.h=t,this.g=n,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function Uf(e){x.setTimeout(function(){throw e},0)}function Uo(e,t){io||qf(),oo||(io(),oo=!0),Pa.add(e,t)}var io;function qf(){var e=x.Promise.resolve(void 0);io=function(){e.then(jf)}}var oo=!1,Pa=new Mf;function jf(){for(var e;e=Ff();){try{e.h.call(e.g)}catch(n){Uf(n)}var t=La;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}oo=!1}function ui(e,t){nt.call(this),this.h=e||1,this.g=t||x,this.j=st(this.kb,this),this.l=Date.now()}at(ui,nt);S=ui.prototype;S.da=!1;S.S=null;S.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ut(this,"tick"),this.da&&(qo(this),this.start()))}};S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function qo(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}S.M=function(){ui.Z.M.call(this),qo(this),delete this.g};function jo(e,t,n){if(typeof e=="function")n&&(e=st(e,n));else if(e&&typeof e.handleEvent=="function")e=st(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:x.setTimeout(e,t||0)}function Fa(e){e.g=jo(function(){e.g=null,e.i&&(e.i=!1,Fa(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}var Bf=function(e){gf(t,e);function t(n,r){var i=e.call(this)||this;return i.m=n,i.j=r,i.h=null,i.i=!1,i.g=null,i}return t.prototype.l=function(n){this.h=arguments,this.g?this.i=!0:Fa(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(ce);function Ln(e){ce.call(this),this.h=e,this.g={}}at(Ln,ce);var Xs=[];function Ma(e,t,n,r){Array.isArray(n)||(n&&(Xs[0]=n.toString()),n=Xs);for(var i=0;i<n.length;i++){var o=Ca(t,n[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}}function Va(e){xo(e.g,function(t,n){this.g.hasOwnProperty(n)&&Po(t)},e),e.g={}}Ln.prototype.M=function(){Ln.Z.M.call(this),Va(this)};Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ai(){this.g=!0}ai.prototype.Aa=function(){this.g=!1};function Kf(e,t,n,r,i,o){e.info(function(){if(e.g)if(o)for(var s="",u=o.split("&"),a=0;a<u.length;a++){var c=u[a].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&l[1]=="type"?s+(h+"="+c+"&"):s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+s})}function zf(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+o+" "+s})}function Ge(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+$f(e,n)+(r?" "+r:"")})}function Gf(e,t){e.info(function(){return"TIMEOUT: "+t})}ai.prototype.info=function(){};function $f(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if(o!="noop"&&o!="stop"&&o!="close")for(var s=1;s<i.length;s++)i[s]=""}}}}return Vo(n)}catch{return t}}var xe={},Js=null;function ci(){return Js=Js||new nt}xe.Ma="serverreachability";function Ua(e){pt.call(this,xe.Ma,e)}at(Ua,pt);function Pn(e){var t=ci();ut(t,new Ua(t))}xe.STAT_EVENT="statevent";function qa(e,t){pt.call(this,xe.STAT_EVENT,e),this.stat=t}at(qa,pt);function wt(e){var t=ci();ut(t,new qa(t,e))}xe.Na="timingevent";function ja(e,t){pt.call(this,xe.Na,e),this.size=t}at(ja,pt);function Xn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){e()},t)}var hi={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Ba={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Bo(){}Bo.prototype.h=null;function Zs(e){return e.h||(e.h=e.i())}function Ka(){}var Jn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ko(){pt.call(this,"d")}at(Ko,pt);function zo(){pt.call(this,"c")}at(zo,pt);var so;function li(){}at(li,Bo);li.prototype.g=function(){return new XMLHttpRequest};li.prototype.i=function(){return{}};so=new li;function Zn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Ln(this),this.P=Hf,e=to?125:void 0,this.W=new ui(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new za}function za(){this.i=null,this.g="",this.h=!1}var Hf=45e3,uo={},Pr={};S=Zn.prototype;S.setTimeout=function(e){this.P=e};function ao(e,t,n){e.K=1,e.v=pi(Wt(t)),e.s=n,e.U=!0,Ga(e,null)}function Ga(e,t){e.F=Date.now(),tr(e),e.A=Wt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Ja(n.h,"t",r),e.C=0,n=e.l.H,e.h=new za,e.g=mc(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Bf(st(e.Ia,e,e.g),e.O)),Ma(e.V,e.g,"readystatechange",e.gb),t=e.H?_a(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Pn(),Kf(e.j,e.u,e.A,e.m,e.X,e.s)}S.gb=function(e){e=e.target;var t=this.L;t&&zt(e)==3?t.l():this.Ia(e)};S.Ia=function(e){try{if(e==this.g)t:{var t=zt(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(t!=3||to||this.g&&(this.h.h||this.g.ga()||ru(this.g)))){this.I||t!=4||n==7||(n==8||0>=r?Pn(3):Pn(2)),fi(this);var i=this.g.ba();this.N=i;e:if($a(this)){var o=ru(this.g);e="";var s=o.length,u=zt(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){ye(this),An(this);var a="";break e}this.h.i=new x.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(o[n],{stream:u&&n==s-1});o.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=i==200,zf(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Or(c)){var l=c;break e}}l=null}if(i=l)Ge(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,co(this,i);else{this.i=!1,this.o=3,wt(12),ye(this),An(this);break t}}this.U?(Ha(this,t,a),to&&this.i&&t==3&&(Ma(this.V,this.W,"tick",this.fb),this.W.start())):(Ge(this.j,this.m,a,null),co(this,a)),t==4&&ye(this),this.i&&!this.I&&(t==4?dc(this.l,this):(this.i=!1,tr(this)))}else i==400&&0<a.indexOf("Unknown SID")?(this.o=3,wt(12)):(this.o=0,wt(13)),ye(this),An(this)}}}catch{}finally{}};function $a(e){return e.g?e.u=="GET"&&e.K!=2&&e.l.Ba:!1}function Ha(e,t,n){for(var r=!0,i;!e.I&&e.C<n.length;)if(i=Qf(e,n),i==Pr){t==4&&(e.o=4,wt(14),r=!1),Ge(e.j,e.m,null,"[Incomplete Response]");break}else if(i==uo){e.o=4,wt(15),Ge(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else Ge(e.j,e.m,i,null),co(e,i);$a(e)&&i!=Pr&&i!=uo&&(e.h.g="",e.C=0),t!=4||n.length!=0||e.h.h||(e.o=1,wt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,t=e.l,t.g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Zo(t),t.L=!0,wt(11))):(Ge(e.j,e.m,n,"[Invalid Chunked Response]"),ye(e),An(e))}S.fb=function(){if(this.g){var e=zt(this.g),t=this.g.ga();this.C<t.length&&(fi(this),Ha(this,e,t),this.i&&e!=4&&tr(this))}};function Qf(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?Pr:(n=Number(t.substring(n,r)),isNaN(n)?uo:(r+=1,r+n>t.length?Pr:(t=t.substr(r,n),e.C=r+n,t)))}S.cancel=function(){this.I=!0,ye(this)};function tr(e){e.Y=Date.now()+e.P,Qa(e,e.P)}function Qa(e,t){if(e.B!=null)throw Error("WatchDog timer not null");e.B=Xn(st(e.eb,e),t)}function fi(e){e.B&&(x.clearTimeout(e.B),e.B=null)}S.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(Gf(this.j,this.A),this.K!=2&&(Pn(),wt(17)),ye(this),this.o=2,An(this)):Qa(this,this.Y-e)};function An(e){e.l.G==0||e.I||dc(e.l,e)}function ye(e){fi(e);var t=e.L;t&&typeof t.na=="function"&&t.na(),e.L=null,qo(e.W),Va(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function co(e,t){try{var n=e.l;if(n.G!=0&&(n.g==e||ho(n.i,e))){if(n.I=e.N,!e.J&&ho(n.i,e)&&n.G==3){try{var r=n.Ca.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)Ur(n),gi(n);else break t;Jo(n),wt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&n.A==0&&!n.v&&(n.v=Xn(st(n.ab,n),6e3));if(1>=ec(n.i)&&n.ka){try{n.ka()}catch{}n.ka=void 0}}else me(n,11)}else if((e.J||n.g==e)&&Ur(n),!Or(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var o=i[t];if(n.U=o[0],o=o[1],n.G==2)if(o[0]=="c"){n.J=o[1],n.la=o[2];var s=o[3];s!=null&&(n.ma=s,n.h.info("VER="+n.ma));var u=o[4];u!=null&&(n.za=u,n.h.info("SVER="+n.za));var a=o[5];a!=null&&typeof a=="number"&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(yt(h,"spdy")||yt(h,"quic")||yt(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(Ho(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,z(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),r=n;var p=e;if(r.oa=yc(r,r.H?r.la:null,r.W),p.J){nc(r.i,p);var d=p,g=r.K;g&&d.setTimeout(g),d.B&&(fi(d),tr(d)),r.g=p}else fc(r);0<n.l.length&&yi(n)}else o[0]!="stop"&&o[0]!="close"||me(n,7);else n.G==3&&(o[0]=="stop"||o[0]=="close"?o[0]=="stop"?me(n,7):Xo(n):o[0]!="noop"&&n.j&&n.j.wa(o),n.A=0)}}Pn(4)}catch{}}function Wf(e){if(e.R&&typeof e.R=="function")return e.R();if(typeof e=="string")return e.split("");if(Zi(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Go(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(Zi(e)||typeof e=="string")Ta(e,t,void 0);else{if(e.T&&typeof e.T=="function")var n=e.T();else if(e.R&&typeof e.R=="function")n=void 0;else if(Zi(e)||typeof e=="string"){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Wf(e),i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function pn(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof pn)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}S=pn.prototype;S.R=function(){$o(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e};S.T=function(){return $o(this),this.g.concat()};function $o(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Ae(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)r=e.g[t],Ae(i,r)||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}S.get=function(e,t){return Ae(this.h,e)?this.h[e]:t};S.set=function(e,t){Ae(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t};S.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function Ae(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Wa=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yf(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ne(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Ne){this.g=t!==void 0?t:e.g,Fr(this,e.j),this.s=e.s,Mr(this,e.i),Vr(this,e.m),this.l=e.l,t=e.h;var n=new Fn;n.i=t.i,t.g&&(n.g=new pn(t.g),n.h=t.h),tu(this,n),this.o=e.o}else e&&(n=String(e).match(Wa))?(this.g=!!t,Fr(this,n[1]||"",!0),this.s=Nn(n[2]||""),Mr(this,n[3]||"",!0),Vr(this,n[4]),this.l=Nn(n[5]||"",!0),tu(this,n[6]||"",!0),this.o=Nn(n[7]||"")):(this.g=!!t,this.h=new Fn(null,this.g))}Ne.prototype.toString=function(){var e=[],t=this.j;t&&e.push(_n(t,eu,!0),":");var n=this.i;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(_n(t,eu,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&e.push("/"),e.push(_n(n,n.charAt(0)=="/"?ep:tp,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",_n(n,rp)),e.join("")};function Wt(e){return new Ne(e)}function Fr(e,t,n){e.j=n?Nn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Mr(e,t,n){e.i=n?Nn(t,!0):t}function Vr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tu(e,t,n){t instanceof Fn?(e.h=t,ip(e.h,e.g)):(n||(t=_n(t,np)),e.h=new Fn(t,e.g))}function z(e,t,n){e.h.set(t,n)}function pi(e){return z(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Xf(e){return e instanceof Ne?Wt(e):new Ne(e,void 0)}function Jf(e,t,n,r){var i=new Ne(null,void 0);return e&&Fr(i,e),t&&Mr(i,t),n&&Vr(i,n),r&&(i.l=r),i}function Nn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function _n(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Zf),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Zf(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var eu=/[#\/\?@]/g,tp=/[#\?:]/g,ep=/[#\?]/g,np=/[#\?@]/g,rp=/#/g;function Fn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function he(e){e.g||(e.g=new pn,e.h=0,e.i&&Yf(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}S=Fn.prototype;S.add=function(e,t){he(this),this.i=null,e=dn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function Ya(e,t){he(e),t=dn(e,t),Ae(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,e=e.g,Ae(e.h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&$o(e)))}function Xa(e,t){return he(e),t=dn(e,t),Ae(e.g.h,t)}S.forEach=function(e,t){he(this),this.g.forEach(function(n,r){Ta(n,function(i){e.call(t,i,r,this)},this)},this)};S.T=function(){he(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};S.R=function(e){he(this);var t=[];if(typeof e=="string")Xa(this,e)&&(t=Gs(t,this.g.get(dn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Gs(t,e[n])}return t};S.set=function(e,t){return he(this),this.i=null,e=dn(this,e),Xa(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};S.get=function(e,t){return e?(e=this.R(e),0<e.length?String(e[0]):t):t};function Ja(e,t,n){Ya(e,t),0<n.length&&(e.i=null,e.g.set(dn(e,t),ko(n)),e.h+=n.length)}S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;r[o]!==""&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.i=e.join("&")};function dn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ip(e,t){t&&!e.j&&(he(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Ya(this,r),Ja(this,i,n))},e)),e.j=t}var op=function(){function e(t,n){this.h=t,this.g=n}return e}();function Za(e){this.l=e||sp,x.PerformanceNavigationTiming?(e=x.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(x.g&&x.g.Ea&&x.g.Ea()&&x.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sp=10;function tc(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function ec(e){return e.h?1:e.g?e.g.size:0}function ho(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function Ho(e,t){e.g?e.g.add(t):e.h=t}function nc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Za.prototype.cancel=function(){var e,t;if(this.i=rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){try{for(var n=Ea(this.g.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}};function rc(e){var t,n;if(e.h!=null)return e.i.concat(e.h.D);if(e.g!=null&&e.g.size!==0){var r=e.i;try{for(var i=Ea(e.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return ko(e.i)}function Qo(){}Qo.prototype.stringify=function(e){return x.JSON.stringify(e,void 0)};Qo.prototype.parse=function(e){return x.JSON.parse(e,void 0)};function up(){this.g=new Qo}function ap(e,t,n){var r=n||"";try{Go(e,function(i,o){var s=i;Wn(i)&&(s=Vo(i)),t.push(r+o+"="+encodeURIComponent(s))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function cp(e,t){var n=new ai;if(x.Image){var r=new Image;r.onload=vr(yr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=vr(yr,n,r,"TestLoadImage: error",!1,t),r.onabort=vr(yr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=vr(yr,n,r,"TestLoadImage: timeout",!1,t),x.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function yr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}function er(e){this.l=e.$b||null,this.j=e.ib||!1}at(er,Bo);er.prototype.g=function(){return new di(this.l,this.j)};er.prototype.i=function(e){return function(){return e}}({});function di(e,t){nt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Wo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}at(di,nt);var Wo=0;S=di.prototype;S.open=function(e,t){if(this.readyState!=Wo)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Mn(this)};S.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||x).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))};S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,nr(this)),this.readyState=Wo};S.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Mn(this)),this.g&&(this.readyState=3,Mn(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof x.ReadableStream!="undefined"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ic(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))};function ic(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}S.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?nr(this):Mn(this),this.readyState==3&&ic(this)}};S.Ua=function(e){this.g&&(this.response=this.responseText=e,nr(this))};S.Ta=function(e){this.g&&(this.response=e,nr(this))};S.ha=function(){this.g&&nr(this)};function nr(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Mn(e)}S.setRequestHeader=function(e,t){this.v.append(e,t)};S.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};S.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function Mn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(di.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var hp=x.JSON.parse;function J(e){nt.call(this),this.headers=new pn,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=oc,this.K=this.L=!1}at(J,nt);var oc="",lp=/^https?$/i,fp=["POST","PUT"];S=J.prototype;S.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():so.g(),this.C=this.u?Zs(this.u):Zs(so),this.g.onreadystatechange=st(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(o){nu(this,o);return}e=n||"";var i=new pn(this.headers);r&&Go(r,function(o,s){i.set(s,o)}),r=Tf(i.T()),n=x.FormData&&e instanceof x.FormData,!(0<=Ia(fp,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,s){this.g.setRequestHeader(s,o)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ac(this),0<this.B&&((this.K=pp(this.g))?(this.g.timeout=this.B,this.g.ontimeout=st(this.pa,this)):this.A=jo(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(o){nu(this,o)}};function pp(e){return We&&Df()&&typeof e.timeout=="number"&&e.ontimeout!==void 0}function dp(e){return e.toLowerCase()=="content-type"}S.pa=function(){typeof Ro!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ut(this,"timeout"),this.abort(8))};function nu(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,sc(e),vi(e)}function sc(e){e.D||(e.D=!0,ut(e,"complete"),ut(e,"error"))}S.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ut(this,"complete"),ut(this,"abort"),vi(this))};S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vi(this,!0)),J.Z.M.call(this)};S.Fa=function(){this.s||(this.F||this.v||this.l?uc(this):this.cb())};S.cb=function(){uc(this)};function uc(e){if(e.h&&typeof Ro!="undefined"&&(!e.C[1]||zt(e)!=4||e.ba()!=2)){if(e.v&&zt(e)==4)jo(e.Fa,0,e);else if(ut(e,"readystatechange"),zt(e)==4){e.h=!1;try{var t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=t===0){var o=String(e.H).match(Wa)[1]||null;if(!o&&x.self&&x.self.location){var s=x.self.location.protocol;o=s.substr(0,s.length-1)}i=!lp.test(o?o.toLowerCase():"")}r=i}if(r)ut(e,"complete"),ut(e,"success");else{e.m=6;try{var u=2<zt(e)?e.g.statusText:""}catch{u=""}e.j=u+" ["+e.ba()+"]",sc(e)}}finally{vi(e)}}}}function vi(e,t){if(e.g){ac(e);var n=e.g,r=e.C[0]?xr:null;e.g=null,e.C=null,t||ut(e,"ready");try{n.onreadystatechange=r}catch{}}}function ac(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(x.clearTimeout(e.A),e.A=null)}function zt(e){return e.g?e.g.readyState:0}S.ba=function(){try{return 2<zt(this)?this.g.status:-1}catch{return-1}};S.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};S.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),hp(t)}};function ru(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case oc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}S.Da=function(){return this.m};S.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function vp(e){var t="";return xo(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function Yo(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=vp(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):z(e,t,n))}function In(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function cc(e){this.za=0,this.l=[],this.h=new ai,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=In("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=In("baseRetryDelayMs",5e3,e),this.$a=In("retryDelaySeedMs",1e4,e),this.Ya=In("forwardChannelMaxRetries",2,e),this.ra=In("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Za(e&&e.concurrentRequestLimit),this.Ca=new up,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||e.Xb!==!1}S=cc.prototype;S.ma=8;S.G=1;function Xo(e){if(hc(e),e.G==3){var t=e.V++,n=Wt(e.F);z(n,"SID",e.J),z(n,"RID",t),z(n,"TYPE","terminate"),rr(e,n),t=new Zn(e,e.h,t,void 0),t.K=2,t.v=pi(Wt(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(t.v.toString(),"")),!n&&x.Image&&(new Image().src=t.v,n=!0),n||(t.g=mc(t.l,null),t.g.ea(t.v)),t.F=Date.now(),tr(t)}gc(e)}S.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch{}};function gi(e){e.g&&(Zo(e),e.g.cancel(),e.g=null)}function hc(e){gi(e),e.u&&(x.clearTimeout(e.u),e.u=null),Ur(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&x.clearTimeout(e.m),e.m=null)}function zi(e,t){e.l.push(new op(e.Za++,t)),e.G==3&&yi(e)}function yi(e){tc(e.i)||e.m||(e.m=!0,Uo(e.Ha,e),e.C=0)}function gp(e,t){return ec(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.l=t.D.concat(e.l),!0):e.G==1||e.G==2||e.C>=(e.Xa?0:e.Ya)?!1:(e.m=Xn(st(e.Ha,e,t),vc(e,e.C)),e.C++,!0)}S.Ha=function(e){if(this.m)if(this.m=null,this.G==1){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Zn(this,this.h,e,void 0),n=this.s;if(this.P&&(n?(n=_a(n),Sa(n,this.P)):n=this.P),this.o===null&&(t.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){e:{var o=this.l[i];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(r+=o,4096<r){r=i;break t}if(r===4096||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=lc(this,t,r),i=Wt(this.F),z(i,"RID",e),z(i,"CVER",22),this.D&&z(i,"X-HTTP-Session-Id",this.D),rr(this,i),this.o&&n&&Yo(i,this.o,n),Ho(this.i,t),this.Ra&&z(i,"TYPE","init"),this.ja?(z(i,"$req",r),z(i,"SID","null"),t.$=!0,ao(t,i,null)):ao(t,i,r),this.G=2}}else this.G==3&&(e?iu(this,e):this.l.length==0||tc(this.i)||iu(this))};function iu(e,t){var n;t?n=t.m:n=e.V++;var r=Wt(e.F);z(r,"SID",e.J),z(r,"RID",n),z(r,"AID",e.U),rr(e,r),e.o&&e.s&&Yo(r,e.o,e.s),n=new Zn(e,e.h,n,e.C+1),e.o===null&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=lc(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Ho(e.i,n),ao(n,r,t)}function rr(e,t){e.j&&Go({},function(n,r){z(t,r,n)})}function lc(e,t,n){n=Math.min(e.l.length,n);var r=e.j?st(e.j.Oa,e.j,e):null;t:for(var i=e.l,o=-1;;){var s=["count="+n];o==-1?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].h,h=i[a].g;if(c-=o,0>c)o=Math.max(0,i[a].h-100),u=!1;else try{ap(h,s,"req"+c+"_")}catch{r&&r(h)}}if(u){r=s.join("&");break t}}return e=e.l.splice(0,n),t.D=e,r}function fc(e){e.g||e.u||(e.Y=1,Uo(e.Ga,e),e.A=0)}function Jo(e){return e.g||e.u||3<=e.A?!1:(e.Y++,e.u=Xn(st(e.Ga,e),vc(e,e.A)),e.A++,!0)}S.Ga=function(){if(this.u=null,pc(this),this.$&&!(this.L||this.g==null||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Xn(st(this.bb,this),e)}};S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,wt(10),gi(this),pc(this))};function Zo(e){e.B!=null&&(x.clearTimeout(e.B),e.B=null)}function pc(e){e.g=new Zn(e,e.h,"rpc",e.Y),e.o===null&&(e.g.H=e.s),e.g.O=0;var t=Wt(e.oa);z(t,"RID","rpc"),z(t,"SID",e.J),z(t,"CI",e.N?"0":"1"),z(t,"AID",e.U),rr(e,t),z(t,"TYPE","xmlhttp"),e.o&&e.s&&Yo(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=pi(Wt(t)),n.s=null,n.U=!0,Ga(n,e)}S.ab=function(){this.v!=null&&(this.v=null,gi(this),Jo(this),wt(19))};function Ur(e){e.v!=null&&(x.clearTimeout(e.v),e.v=null)}function dc(e,t){var n=null;if(e.g==t){Ur(e),Zo(e),e.g=null;var r=2}else if(ho(e.i,t))n=t.D,nc(e.i,t),r=1;else return;if(e.I=t.N,e.G!=0){if(t.i)if(r==1){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;r=ci(),ut(r,new ja(r,n)),yi(e)}else fc(e);else if(i=t.o,i==3||i==0&&0<e.I||!(r==1&&gp(e,t)||r==2&&Jo(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:me(e,5);break;case 4:me(e,10);break;case 3:me(e,6);break;default:me(e,2)}}}function vc(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function me(e,t){if(e.h.info("Error code "+t),t==2){var n=null;e.j&&(n=null);var r=st(e.jb,e);n||(n=new Ne("//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||Fr(n,"https"),pi(n)),cp(n.toString(),r)}else wt(2);e.G=0,e.j&&e.j.va(t),gc(e),hc(e)}S.jb=function(e){e?(this.h.info("Successfully pinged google.com"),wt(2)):(this.h.info("Failed to ping google.com"),wt(1))};function gc(e){e.G=0,e.I=-1,e.j&&((rc(e.i).length!=0||e.l.length!=0)&&(e.i.i.length=0,ko(e.l),e.l.length=0),e.j.ua())}function yc(e,t,n){var r=Xf(n);if(r.i!="")t&&Mr(r,t+"."+r.i),Vr(r,r.m);else{var i=x.location;r=Jf(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&xo(e.aa,function(o,s){z(r,s,o)}),t=e.D,n=e.sa,t&&n&&z(r,t,n),z(r,"VER",e.ma),rr(e,r),r}function mc(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=n&&e.Ba&&!e.qa?new J(new er({ib:!0})):new J(e.qa),t.L=e.H,t}function wc(){}S=wc.prototype;S.xa=function(){};S.wa=function(){};S.va=function(){};S.ua=function(){};S.Oa=function(){};function qr(){if(We&&!(10<=Number(Cf)))throw Error("Environmental error: no available transport.")}qr.prototype.g=function(e,t){return new Ot(e,t)};function Ot(e,t){nt.call(this),this.g=new cc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Or(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Or(t)&&(this.g.D=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new vn(this)}at(Ot,nt);Ot.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Uo(st(e.hb,e,t))),wt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=yc(e,null,e.W),yi(e)};Ot.prototype.close=function(){Xo(this.g)};Ot.prototype.u=function(e){if(typeof e=="string"){var t={};t.__data__=e,zi(this.g,t)}else this.v?(t={},t.__data__=Vo(e),zi(this.g,t)):zi(this.g,e)};Ot.prototype.M=function(){this.g.j=null,delete this.j,Xo(this.g),delete this.g,Ot.Z.M.call(this)};function bc(e){Ko.call(this);var t=e.__sm__;if(t){t:{for(var n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}at(bc,Ko);function Ec(){zo.call(this),this.status=1}at(Ec,zo);function vn(e){this.g=e}at(vn,wc);vn.prototype.xa=function(){ut(this.g,"a")};vn.prototype.wa=function(e){ut(this.g,new bc(e))};vn.prototype.va=function(e){ut(this.g,new Ec)};vn.prototype.ua=function(){ut(this.g,"b")};qr.prototype.createWebChannel=qr.prototype.g;Ot.prototype.send=Ot.prototype.u;Ot.prototype.open=Ot.prototype.m;Ot.prototype.close=Ot.prototype.close;hi.NO_ERROR=0;hi.TIMEOUT=8;hi.HTTP_ERROR=6;Ba.COMPLETE="complete";Ka.EventType=Jn;Jn.OPEN="a";Jn.CLOSE="b";Jn.ERROR="c";Jn.MESSAGE="d";nt.prototype.listen=nt.prototype.N;J.prototype.listenOnce=J.prototype.O;J.prototype.getLastError=J.prototype.La;J.prototype.getLastErrorCode=J.prototype.Da;J.prototype.getStatus=J.prototype.ba;J.prototype.getResponseJson=J.prototype.Qa;J.prototype.getResponseText=J.prototype.ga;J.prototype.send=J.prototype.ea;var yp=function(){return new qr},mp=function(){return ci()},Gi=hi,wp=Ba,bp=xe,ou={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ep=er,mr=Ka,Ip=J;/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rt=function(){function e(t,n){var r=this;this.previousValue=t,n&&(n.sequenceNumberHandler=function(i){return r.t(i)},this.i=function(i){return n.writeSequenceNumber(i)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();Rt.o=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=function(e){function t(n,r){var i=this;return(i=e.call(this,r)||this).code=n,i.message=r,i.name="FirebaseError",i.toString=function(){return i.name+": [code="+i.code+"]: "+i.message},i}return R(t,e),t}(Error),Pt=new ya("@firebase/firestore");function lo(){return Pt.logLevel}function T(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=V.DEBUG){var r=t.map(ts);Pt.debug.apply(Pt,H(["Firestore (8.10.1): "+e],r))}}function Y(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=V.ERROR){var r=t.map(ts);Pt.error.apply(Pt,H(["Firestore (8.10.1): "+e],r))}}function jr(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Pt.logLevel<=V.WARN){var r=t.map(ts);Pt.warn.apply(Pt,H(["Firestore (8.10.1): "+e],r))}}function ts(e){if(typeof e=="string")return e;try{return t=e,JSON.stringify(t)}catch{return e}var t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(e){e===void 0&&(e="Unexpected state");var t="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+e;throw Y(t),new Error(t)}function k(e,t){e||D()}function _(e,t){return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tp(e){var t=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ic=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";r.length<20;)for(var i=Tp(40),o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=t.charAt(i[o]%t.length));return r},e}();function P(e,t){return e<t?-1:e>t?1:0}function Ye(e,t,n){return e.length===t.length&&e.every(function(r,i){return n(r,t[i])})}function Tc(e){return e+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var It=function(){function e(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new w(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new w(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new w(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?P(this.nanoseconds,t.nanoseconds):P(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),L=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new It(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Oe(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _c(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sc=function(){function e(t,n,r){n===void 0?n=0:n>t.length&&D(),r===void 0?r=t.length-n:r>t.length-n&&D(),this.segments=t,this.offset=n,this.len=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return e.comparator(this,t)===0},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(r){n.push(r)}):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return this.length===0},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.forEach=function(t){for(var n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,n){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0},e}(),U=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];if(u.indexOf("//")>=0)throw new w(v.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");i.push.apply(i,u.split("/").filter(function(a){return a.length>0}))}return new t(i)},t.emptyPath=function(){return new t([])},t}(Sc),_p=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Vt=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.isValidIdentifier=function(n){return _p.test(n)},t.prototype.canonicalString=function(){return this.toArray().map(function(n){return n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(n)||(n="`"+n+"`"),n}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return this.length===1&&this.get(0)==="__name__"},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(n){for(var r=[],i="",o=0,s=function(){if(i.length===0)throw new w(v.INVALID_ARGUMENT,"Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");r.push(i),i=""},u=!1;o<n.length;){var a=n[o];if(a==="\\"){if(o+1===n.length)throw new w(v.INVALID_ARGUMENT,"Path has trailing escape character: "+n);var c=n[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=c,o+=2}else a==="`"?(u=!u,o++):a!=="."||u?(i+=a,o++):(s(),o++)}if(s(),u)throw new w(v.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new t(r)},t.emptyPath=function(){return new t([])},t}(Sc),Xe=function(){function e(t){this.fields=t,t.sort(Vt.comparator)}return e.prototype.covers=function(t){for(var n=0,r=this.fields;n<r.length;n++)if(r[n].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return Ye(this.fields,t.fields,function(n,r){return n.isEqual(r)})},e}(),Tt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(n){for(var r="",i=0;i<n.length;++i)r+=String.fromCharCode(n[i]);return r}(t))},e.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},e.prototype.toUint8Array=function(){return function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return P(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();Tt.EMPTY_BYTE_STRING=new Tt("");var Sp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ue(e){if(k(!!e),typeof e=="string"){var t=0,n=Sp.exec(e);if(k(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:W(e.seconds),nanos:W(e.nanos)}}function W(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Je(e){return typeof e=="string"?Tt.fromBase64String(e):Tt.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(e){var t,n;return((n=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Ac(e){var t=e.mapValue.fields.__previous_value__;return es(t)?Ac(t):t}function Vn(e){var t=ue(e.mapValue.fields.__local_write_time__.timestampValue);return new It(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(e){return e==null}function Br(e){return e===0&&1/e==-1/0}function Nc(e){return typeof e=="number"&&Number.isInteger(e)&&!Br(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var C=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(U.fromString(t))},e.fromName=function(t){return new e(U.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return t!==null&&U.comparator(this.path,t.path)===0},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,n){return U.comparator(t.path,n.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new U(t.slice()))},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function De(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?es(e)?4:10:D()}function Bt(e,t){var n=De(e);if(n!==De(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Vn(e).isEqual(Vn(t));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;var o=ue(r.timestampValue),s=ue(i.timestampValue);return o.seconds===s.seconds&&o.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(r,i){return Je(r.bytesValue).isEqual(Je(i.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(r,i){return W(r.geoPointValue.latitude)===W(i.geoPointValue.latitude)&&W(r.geoPointValue.longitude)===W(i.geoPointValue.longitude)}(e,t);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return W(r.integerValue)===W(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){var o=W(r.doubleValue),s=W(i.doubleValue);return o===s?Br(o)===Br(s):isNaN(o)&&isNaN(s)}return!1}(e,t);case 9:return Ye(e.arrayValue.values||[],t.arrayValue.values||[],Bt);case 10:return function(r,i){var o=r.mapValue.fields||{},s=i.mapValue.fields||{};if(su(o)!==su(s))return!1;for(var u in o)if(o.hasOwnProperty(u)&&(s[u]===void 0||!Bt(o[u],s[u])))return!1;return!0}(e,t);default:return D()}}function Un(e,t){return(e.values||[]).find(function(n){return Bt(n,t)})!==void 0}function Ze(e,t){var n=De(e),r=De(t);if(n!==r)return P(n,r);switch(n){case 0:return 0;case 1:return P(e.booleanValue,t.booleanValue);case 2:return function(i,o){var s=W(i.integerValue||i.doubleValue),u=W(o.integerValue||o.doubleValue);return s<u?-1:s>u?1:s===u?0:isNaN(s)?isNaN(u)?0:-1:1}(e,t);case 3:return uu(e.timestampValue,t.timestampValue);case 4:return uu(Vn(e),Vn(t));case 5:return P(e.stringValue,t.stringValue);case 6:return function(i,o){var s=Je(i),u=Je(o);return s.compareTo(u)}(e.bytesValue,t.bytesValue);case 7:return function(i,o){for(var s=i.split("/"),u=o.split("/"),a=0;a<s.length&&a<u.length;a++){var c=P(s[a],u[a]);if(c!==0)return c}return P(s.length,u.length)}(e.referenceValue,t.referenceValue);case 8:return function(i,o){var s=P(W(i.latitude),W(o.latitude));return s!==0?s:P(W(i.longitude),W(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(i,o){for(var s=i.values||[],u=o.values||[],a=0;a<s.length&&a<u.length;++a){var c=Ze(s[a],u[a]);if(c)return c}return P(s.length,u.length)}(e.arrayValue,t.arrayValue);case 10:return function(i,o){var s=i.fields||{},u=Object.keys(s),a=o.fields||{},c=Object.keys(a);u.sort(),c.sort();for(var h=0;h<u.length&&h<c.length;++h){var l=P(u[h],c[h]);if(l!==0)return l;var f=Ze(s[u[h]],a[c[h]]);if(f!==0)return f}return P(u.length,c.length)}(e.mapValue,t.mapValue);default:throw D()}}function uu(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return P(e,t);var n=ue(e),r=ue(t),i=P(n.seconds,r.seconds);return i!==0?i:P(n.nanos,r.nanos)}function ns(e){return fo(e)}function fo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){var i=ue(r);return"time("+i.seconds+","+i.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Je(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,C.fromName(n).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(r){for(var i="[",o=!0,s=0,u=r.values||[];s<u.length;s++)o?o=!1:i+=",",i+=fo(u[s]);return i+"]"}(e.arrayValue):"mapValue"in e?function(r){for(var i="{",o=!0,s=0,u=Object.keys(r.fields||{}).sort();s<u.length;s++){var a=u[s];o?o=!1:i+=",",i+=a+":"+fo(r.fields[a])}return i+"}"}(e.mapValue):D();var t,n}function Kr(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function po(e){return!!e&&"integerValue"in e}function rs(e){return!!e&&"arrayValue"in e}function au(e){return!!e&&"nullValue"in e}function cu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Sr(e){return!!e&&"mapValue"in e}function Dn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Oe(e.mapValue.fields,function(i,o){return t.mapValue.fields[i]=Dn(o)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Dn(e.arrayValue.values[r]);return n}return Object.assign({},e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ct=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var n=this.value,r=0;r<t.length-1;++r)if(!Sr(n=(n.mapValue.fields||{})[t.get(r)]))return null;return(n=(n.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Dn(n)},e.prototype.setAll=function(t){var n=this,r=Vt.emptyPath(),i={},o=[];t.forEach(function(u,a){if(!r.isImmediateParentOf(a)){var c=n.getFieldsMap(r);n.applyChanges(c,i,o),i={},o=[],r=a.popLast()}u?i[a.lastSegment()]=Dn(u):o.push(a.lastSegment())});var s=this.getFieldsMap(r);this.applyChanges(s,i,o)},e.prototype.delete=function(t){var n=this.field(t.popLast());Sr(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return Bt(this.value,t.value)},e.prototype.getFieldsMap=function(t){var n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(var r=0;r<t.length;++r){var i=n.mapValue.fields[t.get(r)];Sr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields},e.prototype.applyChanges=function(t,n,r){Oe(n,function(u,a){return t[u]=a});for(var i=0,o=r;i<o.length;i++){var s=o[i];delete t[s]}},e.prototype.clone=function(){return new e(Dn(this.value))},e}();function Dc(e){var t=[];return Oe(e.fields,function(n,r){var i=new Vt([n]);if(Sr(r)){var o=Dc(r.mapValue).fields;if(o.length===0)t.push(i);else for(var s=0,u=o;s<u.length;s++){var a=u[s];t.push(i.child(a))}}else t.push(i)}),new Xe(t)}var dt=function(){function e(t,n,r,i,o){this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=o}return e.newInvalidDocument=function(t){return new e(t,0,L.min(),Ct.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,Ct.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,Ct.empty(),2)},e.prototype.convertToFoundDocument=function(t,n){return this.version=t,this.documentType=1,this.data=n,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ct.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ct.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return this.documentState===1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return this.documentState===2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return this.documentType!==0},e.prototype.isFoundDocument=function(){return this.documentType===1},e.prototype.isNoDocument=function(){return this.documentType===2},e.prototype.isUnknownDocument=function(){return this.documentType===3},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Ap=function(e,t,n,r,i,o,s){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(e,t,n,r,i,o,s){return t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),new Ap(e,t,n,r,i,o,s)}function ir(e){var t=_(e);if(t.h===null){var n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(r){return function(i){return i.field.canonicalString()+i.op.toString()+ns(i.value)}(r)}).join(","),n+="|ob:",n+=t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+i.dir}(r)}).join(","),Le(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=Gr(t.startAt)),t.endAt&&(n+="|ub:",n+=Gr(t.endAt)),t.h=n}return t.h}function mi(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Lp(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],o=t.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Bt(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!fu(e.startAt,t.startAt)&&fu(e.endAt,t.endAt)}function zr(e){return C.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var kt=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).field=n,o.op=r,o.value=i,o}return R(t,e),t.create=function(n,r,i){return n.isKeyField()?r==="in"||r==="not-in"?this.l(n,r,i):new Np(n,r,i):r==="array-contains"?new Rp(n,i):r==="in"?new kp(n,i):r==="not-in"?new xp(n,i):r==="array-contains-any"?new Op(n,i):new t(n,r,i)},t.l=function(n,r,i){return r==="in"?new Dp(n,i):new Cp(n,i)},t.prototype.matches=function(n){var r=n.data.field(this.field);return this.op==="!="?r!==null&&this.m(Ze(r,this.value)):r!==null&&De(this.value)===De(r)&&this.m(Ze(r,this.value))},t.prototype.m=function(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return D()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),Np=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,i)||this).key=C.fromName(i.referenceValue),o}return R(t,e),t.prototype.matches=function(n){var r=C.comparator(n.key,this.key);return this.m(r)},t}(kt),Dp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"in",r)||this).keys=Cc("in",r),i}return R(t,e),t.prototype.matches=function(n){return this.keys.some(function(r){return r.isEqual(n.key)})},t}(kt),Cp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"not-in",r)||this).keys=Cc("not-in",r),i}return R(t,e),t.prototype.matches=function(n){return!this.keys.some(function(r){return r.isEqual(n.key)})},t}(kt);function Cc(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(function(r){return C.fromName(r.referenceValue)})}var Rp=function(e){function t(n,r){return e.call(this,n,"array-contains",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return rs(r)&&Un(r.arrayValue,this.value)},t}(kt),kp=function(e){function t(n,r){return e.call(this,n,"in",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return r!==null&&Un(this.value.arrayValue,r)},t}(kt),xp=function(e){function t(n,r){return e.call(this,n,"not-in",r)||this}return R(t,e),t.prototype.matches=function(n){if(Un(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=n.data.field(this.field);return r!==null&&!Un(this.value.arrayValue,r)},t}(kt),Op=function(e){function t(n,r){return e.call(this,n,"array-contains-any",r)||this}return R(t,e),t.prototype.matches=function(n){var r=this,i=n.data.field(this.field);return!(!rs(i)||!i.arrayValue.values)&&i.arrayValue.values.some(function(o){return Un(r.value.arrayValue,o)})},t}(kt),qn=function(e,t){this.position=e,this.before=t};function Gr(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return ns(t)}).join(",")}var He=function(e,t){t===void 0&&(t="asc"),this.field=e,this.dir=t};function Lp(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function lu(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?C.comparator(C.fromName(s.referenceValue),n.key):Ze(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return e.before?r<=0:r<0}function fu(e,t){if(e===null)return t===null;if(t===null||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Bt(e.position[n],t.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Yt=function(e,t,n,r,i,o,s,u){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o="F"),s===void 0&&(s=null),u===void 0&&(u=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this.p=null,this.T=null,this.startAt,this.endAt};function Rc(e,t,n,r,i,o,s,u){return new Yt(e,t,n,r,i,o,s,u)}function or(e){return new Yt(e)}function Ar(e){return!Le(e.limit)&&e.limitType==="F"}function $r(e){return!Le(e.limit)&&e.limitType==="L"}function is(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function os(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function ss(e){return e.collectionGroup!==null}function tn(e){var t=_(e);if(t.p===null){t.p=[];var n=os(t),r=is(t);if(n!==null&&r===null)n.isKeyField()||t.p.push(new He(n)),t.p.push(new He(Vt.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var u=s[o];t.p.push(u),u.field.isKeyField()&&(i=!0)}if(!i){var a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new He(Vt.keyField(),a))}}}return t.p}function Kt(e){var t=_(e);if(!t.T)if(t.limitType==="F")t.T=hu(t.path,t.collectionGroup,tn(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=tn(t);r<i.length;r++){var o=i[r],s=o.dir==="desc"?"asc":"desc";n.push(new He(o.field,s))}var u=t.endAt?new qn(t.endAt.position,!t.endAt.before):null,a=t.startAt?new qn(t.startAt.position,!t.startAt.before):null;t.T=hu(t.path,t.collectionGroup,n,t.filters,t.limit,u,a)}return t.T}function kc(e,t,n){return new Yt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sr(e,t){return mi(Kt(e),Kt(t))&&e.limitType===t.limitType}function xc(e){return ir(Kt(e))+"|lt:"+e.limitType}function vo(e){return"Query(target="+function(t){var n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: ["+t.filters.map(function(r){return(i=r).field.canonicalString()+" "+i.op+" "+ns(i.value);var i}).join(", ")+"]"),Le(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: ["+t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+" ("+i.dir+")"}(r)}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+Gr(t.startAt)),t.endAt&&(n+=", endAt: "+Gr(t.endAt)),"Target("+n+")"}(Kt(e))+"; limitType="+e.limitType+")"}function ur(e,t){return t.isFoundDocument()&&function(n,r){var i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):C.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(e,t)&&function(n,r){for(var i=0,o=n.explicitOrderBy;i<o.length;i++){var s=o[i];if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1}return!0}(e,t)&&function(n,r){for(var i=0,o=n.filters;i<o.length;i++)if(!o[i].matches(r))return!1;return!0}(e,t)&&function(n,r){return!(n.startAt&&!lu(n.startAt,tn(n),r))&&(!n.endAt||!lu(n.endAt,tn(n),r))}(e,t)}function Oc(e){return function(t,n){for(var r=!1,i=0,o=tn(e);i<o.length;i++){var s=o[i],u=Pp(s,t,n);if(u!==0)return u;r=r||s.field.isKeyField()}return 0}}function Pp(e,t,n){var r=e.field.isKeyField()?C.comparator(t.key,n.key):function(i,o,s){var u=o.data.field(i),a=s.data.field(i);return u!==null&&a!==null?Ze(u,a):D()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return D()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lc(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Br(t)?"-0":t}}function Pc(e){return{integerValue:""+e}}function Fc(e,t){return Nc(t)?Pc(t):Lc(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wi=function(){this._=void 0};function Fp(e,t,n){return e instanceof en?function(r,i){var o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,t):e instanceof Ce?Vc(e,t):e instanceof Re?Uc(e,t):function(r,i){var o=Mc(r,i),s=pu(o)+pu(r.A);return po(o)&&po(r.A)?Pc(s):Lc(r.R,s)}(e,t)}function Mp(e,t,n){return e instanceof Ce?Vc(e,t):e instanceof Re?Uc(e,t):n}function Mc(e,t){return e instanceof nn?po(n=t)||function(r){return!!r&&"doubleValue"in r}(n)?t:{integerValue:0}:null;var n}var en=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t}(wi),Ce=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(wi);function Vc(e,t){for(var n=qc(t),r=function(s){n.some(function(u){return Bt(u,s)})||n.push(s)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Re=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(wi);function Uc(e,t){for(var n=qc(t),r=function(s){n=n.filter(function(u){return!Bt(u,s)})},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var nn=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).R=n,i.A=r,i}return R(t,e),t}(wi);function pu(e){return W(e.integerValue||e.doubleValue)}function qc(e){return rs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ar=function(e,t){this.field=e,this.transform=t},Vp=function(e,t){this.version=e,this.transformResults=t},ft=function(){function e(t,n){this.updateTime=t,this.exists=n}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function Nr(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var bi=function(){};function Up(e,t,n){e instanceof cr?function(r,i,o){var s=r.value.clone(),u=gu(r.fieldTransforms,i,o.transformResults);s.setAll(u),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()}(e,t,n):e instanceof le?function(r,i,o){if(Nr(r.precondition,i)){var s=gu(r.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(jc(r)),u.setAll(s),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}else i.convertToUnknownDocument(o.version)}(e,t,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function go(e,t,n){e instanceof cr?function(r,i,o){if(Nr(r.precondition,i)){var s=r.value.clone(),u=yu(r.fieldTransforms,o,i);s.setAll(u),i.convertToFoundDocument(vu(i),s).setHasLocalMutations()}}(e,t,n):e instanceof le?function(r,i,o){if(Nr(r.precondition,i)){var s=yu(r.fieldTransforms,o,i),u=i.data;u.setAll(jc(r)),u.setAll(s),i.convertToFoundDocument(vu(i),u).setHasLocalMutations()}}(e,t,n):function(r,i){Nr(r.precondition,i)&&i.convertToNoDocument(L.min())}(e,t)}function qp(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),u=Mc(o.transform,s||null);u!=null&&(n==null&&(n=Ct.empty()),n.set(o.field,u))}return n||null}function du(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&Ye(n,r,function(i,o){return function(s,u){return s.field.isEqual(u.field)&&function(a,c){return a instanceof Ce&&c instanceof Ce||a instanceof Re&&c instanceof Re?Ye(a.elements,c.elements,Bt):a instanceof nn&&c instanceof nn?Bt(a.A,c.A):a instanceof en&&c instanceof en}(s.transform,u.transform)}(i,o)})}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function vu(e){return e.isFoundDocument()?e.version:L.min()}var cr=function(e){function t(n,r,i,o){o===void 0&&(o=[]);var s=this;return(s=e.call(this)||this).key=n,s.value=r,s.precondition=i,s.fieldTransforms=o,s.type=0,s}return R(t,e),t}(bi),le=function(e){function t(n,r,i,o,s){s===void 0&&(s=[]);var u=this;return(u=e.call(this)||this).key=n,u.data=r,u.fieldMask=i,u.precondition=o,u.fieldTransforms=s,u.type=1,u}return R(t,e),t}(bi);function jc(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function gu(e,t,n){var r=new Map;k(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,u=t.data.field(o.field);r.set(o.field,Mp(s,u,n[i]))}return r}function yu(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],u=s.transform,a=n.data.field(s.field);r.set(s.field,Fp(u,a,t))}return r}var Q,M,hr=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return R(t,e),t}(bi),us=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return R(t,e),t}(bi),jp=function(e){this.count=e};function Bc(e){switch(e){case v.OK:return D();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return D()}}function Kc(e){if(e===void 0)return Y("GRPC error has no .code"),v.UNKNOWN;switch(e){case Q.OK:return v.OK;case Q.CANCELLED:return v.CANCELLED;case Q.UNKNOWN:return v.UNKNOWN;case Q.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case Q.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case Q.INTERNAL:return v.INTERNAL;case Q.UNAVAILABLE:return v.UNAVAILABLE;case Q.UNAUTHENTICATED:return v.UNAUTHENTICATED;case Q.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case Q.NOT_FOUND:return v.NOT_FOUND;case Q.ALREADY_EXISTS:return v.ALREADY_EXISTS;case Q.PERMISSION_DENIED:return v.PERMISSION_DENIED;case Q.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case Q.ABORTED:return v.ABORTED;case Q.OUT_OF_RANGE:return v.OUT_OF_RANGE;case Q.UNIMPLEMENTED:return v.UNIMPLEMENTED;case Q.DATA_LOSS:return v.DATA_LOSS;default:return D()}}(M=Q||(Q={}))[M.OK=0]="OK",M[M.CANCELLED=1]="CANCELLED",M[M.UNKNOWN=2]="UNKNOWN",M[M.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",M[M.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",M[M.NOT_FOUND=5]="NOT_FOUND",M[M.ALREADY_EXISTS=6]="ALREADY_EXISTS",M[M.PERMISSION_DENIED=7]="PERMISSION_DENIED",M[M.UNAUTHENTICATED=16]="UNAUTHENTICATED",M[M.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",M[M.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",M[M.ABORTED=10]="ABORTED",M[M.OUT_OF_RANGE=11]="OUT_OF_RANGE",M[M.UNIMPLEMENTED=12]="UNIMPLEMENTED",M[M.INTERNAL=13]="INTERNAL",M[M.UNAVAILABLE=14]="UNAVAILABLE",M[M.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vt=function(){function e(t,n){this.comparator=t,this.root=n||ee.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ee.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ee.BLACK,null,null))},e.prototype.get=function(t){for(var n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null},e.prototype.indexOf=function(t){for(var n=0,r=this.root;!r.isEmpty();){var i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(n,r){return t(n,r),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(n,r){return t.push(n+":"+r),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new wr(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new wr(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new wr(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new wr(this.root,t,this.comparator,!0)},e}(),wr=function(){function e(t,n,r,i){this.isReverse=i,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),ee=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=r!=null?r:e.RED,this.left=i!=null?i:e.EMPTY,this.right=o!=null?o:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(t!=null?t:this.key,n!=null?n:this.value,r!=null?r:this.color,i!=null?i:this.left,o!=null?o:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,n,r){var i=this,o=r(t,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(t,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();var t=this.left.check();if(t!==this.right.check())throw D();return t+(this.isRed()?0:1)},e}();ee.EMPTY=null,ee.RED=!0,ee.BLACK=!1,ee.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw D()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,n,r,i,o){return this},e.prototype.insert=function(t,n,r){return new ee(t,n)},e.prototype.remove=function(t,n){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt=function(){function e(t){this.comparator=t,this.data=new vt(this.comparator)}return e.prototype.has=function(t){return this.data.get(t)!==null},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.forEachInRange=function(t,n){for(var r=this.data.getIteratorFrom(t[0]);r.hasNext();){var i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}},e.prototype.forEachWhile=function(t,n){var r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null},e.prototype.getIterator=function(){return new mu(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new mu(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var n=this;return n.size<t.size&&(n=t,t=this),t.forEach(function(r){n=n.add(r)}),n},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(n){t.push(n)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(n){return t.push(n)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e}(),mu=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),Bp=new vt(C.comparator);function Ft(){return Bp}var Kp=new vt(C.comparator);function yo(){return Kp}var zp=new vt(C.comparator);function Gp(){return zp}var $p=new tt(C.comparator);function B(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=$p,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Hp=new tt(P);function Ei(){return Hp}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var as=function(){function e(t,n,r,i,o){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,cs.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(L.min(),r,Ei(),Ft(),B())},e}(),cs=function(){function e(t,n,r,i,o){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(Tt.EMPTY_BYTE_STRING,n,B(),B(),B())},e}(),Dr=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},zc=function(e,t){this.targetId=e,this.V=t},Gc=function(e,t,n,r){n===void 0&&(n=Tt.EMPTY_BYTE_STRING),r===void 0&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},wu=function(){function e(){this.S=0,this.D=Eu(),this.C=Tt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return this.S!==0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=B(),n=B(),r=B();return this.D.forEach(function(i,o){switch(o){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:D()}}),new cs(this.C,this.N,t,n,r)},e.prototype.L=function(){this.k=!1,this.D=Eu()},e.prototype.B=function(t,n){this.k=!0,this.D=this.D.insert(t,n)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),Qp=function(){function e(t){this.W=t,this.G=new Map,this.H=Ft(),this.J=bu(),this.Y=new tt(P)}return e.prototype.X=function(t){for(var n=0,r=t.v;n<r.length;n++){var i=r[n];t.P&&t.P.isFoundDocument()?this.Z(i,t.P):this.tt(i,t.key,t.P)}for(var o=0,s=t.removedTargetIds;o<s.length;o++)i=s[o],this.tt(i,t.key,t.P)},e.prototype.et=function(t){var n=this;this.forEachTarget(t,function(r){var i=n.nt(r);switch(t.state){case 0:n.st(r)&&i.O(t.resumeToken);break;case 1:i.K(),i.F||i.L(),i.O(t.resumeToken);break;case 2:i.K(),i.F||n.removeTarget(r);break;case 3:n.st(r)&&(i.j(),i.O(t.resumeToken));break;case 4:n.st(r)&&(n.it(r),i.O(t.resumeToken));break;default:D()}})},e.prototype.forEachTarget=function(t,n){var r=this;t.targetIds.length>0?t.targetIds.forEach(n):this.G.forEach(function(i,o){r.st(o)&&n(o)})},e.prototype.rt=function(t){var n=t.targetId,r=t.V.count,i=this.ot(n);if(i){var o=i.target;if(zr(o))if(r===0){var s=new C(o.path);this.tt(n,s,dt.newNoDocument(s,L.min()))}else k(r===1);else this.ct(n)!==r&&(this.it(n),this.Y=this.Y.add(n))}},e.prototype.ut=function(t){var n=this,r=new Map;this.G.forEach(function(s,u){var a=n.ot(u);if(a){if(s.current&&zr(a.target)){var c=new C(a.target.path);n.H.get(c)!==null||n.at(u,c)||n.tt(u,c,dt.newNoDocument(c,t))}s.$&&(r.set(u,s.M()),s.L())}});var i=B();this.J.forEach(function(s,u){var a=!0;u.forEachWhile(function(c){var h=n.ot(c);return!h||h.purpose===2||(a=!1,!1)}),a&&(i=i.add(s))});var o=new as(t,r,this.Y,this.H,i);return this.H=Ft(),this.J=bu(),this.Y=new tt(P),o},e.prototype.Z=function(t,n){if(this.st(t)){var r=this.at(t,n.key)?2:0;this.nt(t).B(n.key,r),this.H=this.H.insert(n.key,n),this.J=this.J.insert(n.key,this.ht(n.key).add(t))}},e.prototype.tt=function(t,n,r){if(this.st(t)){var i=this.nt(t);this.at(t,n)?i.B(n,1):i.q(n),this.J=this.J.insert(n,this.ht(n).delete(t)),r&&(this.H=this.H.insert(n,r))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var n=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var n=this.G.get(t);return n||(n=new wu,this.G.set(t,n)),n},e.prototype.ht=function(t){var n=this.J.get(t);return n||(n=new tt(P),this.J=this.J.insert(t,n)),n},e.prototype.st=function(t){var n=this.ot(t)!==null;return n||T("WatchChangeAggregator","Detected inactive target",t),n},e.prototype.ot=function(t){var n=this.G.get(t);return n&&n.F?null:this.W.lt(t)},e.prototype.it=function(t){var n=this;this.G.set(t,new wu),this.W.getRemoteKeysForTarget(t).forEach(function(r){n.tt(t,r,null)})},e.prototype.at=function(t,n){return this.W.getRemoteKeysForTarget(t).has(n)},e}();function bu(){return new vt(C.comparator)}function Eu(){return new vt(C.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wp={asc:"ASCENDING",desc:"DESCENDING"},Yp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xp=function(e,t){this.databaseId=e,this.I=t};function jn(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function $c(e,t){return e.I?t.toBase64():t.toUint8Array()}function Jp(e,t){return jn(e,t.toTimestamp())}function bt(e){return k(!!e),L.fromTimestamp(function(t){var n=ue(t);return new It(n.seconds,n.nanos)}(e))}function hs(e,t){return function(n){return new U(["projects",n.projectId,"databases",n.database])}(e).child("documents").child(t).canonicalString()}function Hc(e){var t=U.fromString(e);return k(th(t)),t}function Bn(e,t){return hs(e.databaseId,t.path)}function $t(e,t){var n=Hc(t);if(n.get(1)!==e.databaseId.projectId)throw new w(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new w(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new C(Wc(n))}function mo(e,t){return hs(e.databaseId,t)}function Qc(e){var t=Hc(e);return t.length===4?U.emptyPath():Wc(t)}function Kn(e){return new U(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Wc(e){return k(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function Iu(e,t,n){return{name:Bn(e,t),fields:n.value.mapValue.fields}}function Zp(e,t,n){var r=$t(e,t.name),i=bt(t.updateTime),o=new Ct({mapValue:{fields:t.fields}}),s=dt.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Hr(e,t){var n;if(t instanceof cr)n={update:Iu(e,t.key,t.value)};else if(t instanceof hr)n={delete:Bn(e,t.key)};else if(t instanceof le)n={update:Iu(e,t.key,t.data),updateMask:id(t.fieldMask)};else{if(!(t instanceof us))return D();n={verify:Bn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(r){return function(i,o){var s=o.transform;if(s instanceof en)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Ce)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Re)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof nn)return{fieldPath:o.field.canonicalString(),increment:s.A};throw D()}(0,r)})),t.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:Jp(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:D()}(e,t.precondition)),n}function Tu(e,t){var n=t.currentDocument?function(c){return c.updateTime!==void 0?ft.updateTime(bt(c.updateTime)):c.exists!==void 0?ft.exists(c.exists):ft.none()}(t.currentDocument):ft.none(),r=t.updateTransforms?t.updateTransforms.map(function(c){return function(h,l){var f=null;if("setToServerValue"in l)k(l.setToServerValue==="REQUEST_TIME"),f=new en;else if("appendMissingElements"in l){var p=l.appendMissingElements.values||[];f=new Ce(p)}else if("removeAllFromArray"in l){var d=l.removeAllFromArray.values||[];f=new Re(d)}else"increment"in l?f=new nn(h,l.increment):D();var g=Vt.fromServerFormat(l.fieldPath);return new ar(g,f)}(e,c)}):[];if(t.update){t.update.name;var i=$t(e,t.update.name),o=new Ct({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=function(c){var h=c.fieldPaths||[];return new Xe(h.map(function(l){return Vt.fromServerFormat(l)}))}(t.updateMask);return new le(i,o,s,n,r)}return new cr(i,o,n,r)}if(t.delete){var u=$t(e,t.delete);return new hr(u,n)}if(t.verify){var a=$t(e,t.verify);return new us(a,n)}return D()}function Yc(e,t){return{documents:[mo(e,t.path)]}}function Xc(e,t){var n={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(n.parent=mo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=mo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(u){if(u.length!==0){var a=u.map(function(c){return function(h){if(h.op==="=="){if(cu(h.value))return{unaryFilter:{field:qe(h.field),op:"IS_NAN"}};if(au(h.value))return{unaryFilter:{field:qe(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(cu(h.value))return{unaryFilter:{field:qe(h.field),op:"IS_NOT_NAN"}};if(au(h.value))return{unaryFilter:{field:qe(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qe(h.field),op:ed(h.op),value:h.value}}}(c)});return a.length===1?a[0]:{compositeFilter:{op:"AND",filters:a}}}}(t.filters);i&&(n.structuredQuery.where=i);var o=function(u){if(u.length!==0)return u.map(function(a){return function(c){return{field:qe(c.field),direction:td(c.dir)}}(a)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(u,a){return u.I||Le(a)?a:{value:a}}(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=_u(t.startAt)),t.endAt&&(n.structuredQuery.endAt=_u(t.endAt)),n}function Jc(e){var t=Qc(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){k(r===1);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=Zc(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(l){return function(f){return new He($e(f.field),function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(f.direction))}(l)}));var a=null;n.limit&&(a=function(l){var f;return Le(f=typeof l=="object"?l.value:l)?null:f}(n.limit));var c=null;n.startAt&&(c=Su(n.startAt));var h=null;return n.endAt&&(h=Su(n.endAt)),Rc(t,i,u,s,a,"F",c,h)}function Zc(e){return e?e.unaryFilter!==void 0?[rd(e)]:e.fieldFilter!==void 0?[nd(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map(function(t){return Zc(t)}).reduce(function(t,n){return t.concat(n)}):D():[]}function _u(e){return{before:e.before,values:e.position}}function Su(e){var t=!!e.before,n=e.values||[];return new qn(n,t)}function td(e){return Wp[e]}function ed(e){return Yp[e]}function qe(e){return{fieldPath:e.canonicalString()}}function $e(e){return Vt.fromServerFormat(e.fieldPath)}function nd(e){return kt.create($e(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return D()}}(e.fieldFilter.op),e.fieldFilter.value)}function rd(e){switch(e.unaryFilter.op){case"IS_NAN":var t=$e(e.unaryFilter.field);return kt.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=$e(e.unaryFilter.field);return kt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=$e(e.unaryFilter.field);return kt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=$e(e.unaryFilter.field);return kt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return D()}}function id(e){var t=[];return e.fields.forEach(function(n){return t.push(n.canonicalString())}),{fieldPaths:t}}function th(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mt(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=Au(t)),t=od(e.get(n),t);return Au(t)}function od(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Au(e){return e+""}function Gt(e){var t=e.length;if(k(t>=2),t===2)return k(e.charAt(0)===""&&e.charAt(1)===""),U.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("",o);switch((s<0||s>n)&&D(),e.charAt(s+1)){case"":var u=e.substring(o,s),a=void 0;i.length===0?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=e.substring(o,s),i+="\0";break;case"":i+=e.substring(o,s+1);break;default:D()}o=s+2}return new U(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sd=function(e,t){this.seconds=e,this.nanoseconds=t},At=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};At.store="owner",At.key="owner";var oe=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};oe.store="mutationQueues",oe.keyPath="userId";var K=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};K.store="mutations",K.keyPath="batchId",K.userMutationsIndex="userMutationsIndex",K.userMutationsKeyPath=["userId","batchId"];var ht=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,n){return[t,Mt(n)]},e.key=function(t,n,r){return[t,Mt(n),r]},e}();ht.store="documentMutations",ht.PLACEHOLDER=new ht;var ud=function(e,t){this.path=e,this.readTime=t},ad=function(e,t){this.path=e,this.version=t},$=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};$.store="remoteDocuments",$.readTimeIndex="readTimeIndex",$.readTimeIndexPath="readTime",$.collectionReadTimeIndex="collectionReadTimeIndex",$.collectionReadTimeIndexPath=["parentPath","readTime"];var qt=function(e){this.byteSize=e};qt.store="remoteDocumentGlobal",qt.key="remoteDocumentGlobalKey";var Et=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Et.store="targets",Et.keyPath="targetId",Et.queryTargetsIndexName="queryTargetsIndex",Et.queryTargetsKeyPath=["canonicalId","targetId"];var ot=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};ot.store="targetDocuments",ot.keyPath=["targetId","path"],ot.documentTargetsIndex="documentTargetsIndex",ot.documentTargetsKeyPath=["path","targetId"];var Nt=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Nt.key="targetGlobalKey",Nt.store="targetGlobal";var Ee=function(e,t){this.collectionId=e,this.parent=t};Ee.store="collectionParents",Ee.keyPath=["collectionId","parent"];var Ht=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};Ht.store="clientMetadata",Ht.keyPath="clientId";var rn=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};rn.store="bundles",rn.keyPath="bundleId";var on=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};on.store="namedQueries",on.keyPath="name";var cd=H(H([],H(H([],H(H([],H(H([],[oe.store,K.store,ht.store,$.store,Et.store,At.store,Nt.store,ot.store]),[Ht.store])),[qt.store])),[Ee.store])),[rn.store,on.store]),eh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nh=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),_t=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},E=function(){function e(t){var n=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(r){n.isDone=!0,n.result=r,n.nextCallback&&n.nextCallback(r)},function(r){n.isDone=!0,n.error=r,n.catchCallback&&n.catchCallback(r)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(i,o){r.nextCallback=function(s){r.wrapSuccess(t,s).next(i,o)},r.catchCallback=function(s){r.wrapFailure(n,s).next(i,o)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(n,r){t.next(n,r)})},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(r){return e.reject(r)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)},e.resolve=function(t){return new e(function(n,r){n(t)})},e.reject=function(t){return new e(function(n,r){r(t)})},e.waitFor=function(t){return new e(function(n,r){var i=0,o=0,s=!1;t.forEach(function(u){++i,u.next(function(){++o,s&&o===i&&n()},function(a){return r(a)})}),s=!0,o===i&&n()})},e.or=function(t){for(var n=e.resolve(!1),r=function(s){n=n.next(function(u){return u?e.resolve(u):s()})},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(t,n){var r=this,i=[];return t.forEach(function(o,s){i.push(n.call(r,o,s))}),this.waitFor(i)},e}(),rh=function(){function e(t,n){var r=this;this.action=t,this.transaction=n,this.aborted=!1,this.ft=new _t,this.transaction.oncomplete=function(){r.ft.resolve()},this.transaction.onabort=function(){n.error?r.ft.reject(new Cn(t,n.error)):r.ft.resolve()},this.transaction.onerror=function(i){var o=ls(i.target.error);r.ft.reject(new Cn(t,o))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(o){throw new Cn(n,o)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var n=this.transaction.objectStore(t);return new ld(n)},e}(),sn=function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,e._t(_e())===12.2&&Y("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return T("SimpleDb","Removing database:",t),ge(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if(typeof indexedDB=="undefined")return!1;if(e.gt())return!0;var t=_e(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var t;return typeof process!="undefined"&&((t=process.env)===null||t===void 0?void 0:t.Tt)==="YES"},e.It=function(t,n){return t.store(n)},e._t=function(t){var n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)},e.Et=function(t){var n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)},e.prototype.At=function(t){return m(this,void 0,void 0,function(){var n,r=this;return y(this,function(i){switch(i.label){case 0:return this.db?[3,2]:(T("SimpleDb","Opening database:",this.name),n=this,[4,new Promise(function(o,s){var u=indexedDB.open(r.name,r.version);u.onsuccess=function(a){var c=a.target.result;o(c)},u.onblocked=function(){s(new Cn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},u.onerror=function(a){var c=a.target.error;c.name==="VersionError"?s(new w(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s(new Cn(t,c))},u.onupgradeneeded=function(a){T("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',a.oldVersion);var c=a.target.result;r.wt.Rt(c,u.transaction,a.oldVersion,r.version).next(function(){T("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:n.db=i.sent(),i.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(o){return r.bt(o)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(n){return t(n)})},e.prototype.runTransaction=function(t,n,r,i){return m(this,void 0,void 0,function(){var o,s,u,a,c;return y(this,function(h){switch(h.label){case 0:o=n==="readonly",s=0,u=function(){var l,f,p,d,g;return y(this,function(b){switch(b.label){case 0:++s,b.label=1;case 1:return b.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=b.sent(),l=rh.open(a.db,t,o?"readonly":"readwrite",r),f=i(l).catch(function(I){return l.abort(I),E.reject(I)}).toPromise(),p={},f.catch(function(){}),[4,l.dt];case 3:return[2,(p.value=(b.sent(),f),p)];case 4:return d=b.sent(),g=d.name!=="FirebaseError"&&s<3,T("SimpleDb","Transaction failed with error:",d.message,"Retrying:",g),a.close(),g?[3,5]:[2,{value:Promise.reject(d)}];case 5:return[2]}})},a=this,h.label=1;case 1:return[5,u()];case 2:if(typeof(c=h.sent())=="object")return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),hd=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return ge(this.Pt.delete())},e}(),Cn=function(e){function t(n,r){var i=this;return(i=e.call(this,v.UNAVAILABLE,"IndexedDB transaction '"+n+"' failed: "+r)||this).name="IndexedDbTransactionError",i}return R(t,e),t}(w);function Pe(e){return e.name==="IndexedDbTransactionError"}var ld=function(){function e(t){this.store=t}return e.prototype.put=function(t,n){var r;return n!==void 0?(T("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),ge(r)},e.prototype.add=function(t){return T("SimpleDb","ADD",this.store.name,t,t),ge(this.store.add(t))},e.prototype.get=function(t){var n=this;return ge(this.store.get(t)).next(function(r){return r===void 0&&(r=null),T("SimpleDb","GET",n.store.name,t,r),r})},e.prototype.delete=function(t){return T("SimpleDb","DELETE",this.store.name,t),ge(this.store.delete(t))},e.prototype.count=function(){return T("SimpleDb","COUNT",this.store.name),ge(this.store.count())},e.prototype.Nt=function(t,n){var r=this.cursor(this.options(t,n)),i=[];return this.xt(r,function(o,s){i.push(s)}).next(function(){return i})},e.prototype.kt=function(t,n){T("SimpleDb","DELETE ALL",this.store.name);var r=this.options(t,n);r.Ft=!1;var i=this.cursor(r);return this.xt(i,function(o,s,u){return u.delete()})},e.prototype.$t=function(t,n){var r;n?r=t:(r={},n=t);var i=this.cursor(r);return this.xt(i,n)},e.prototype.Ot=function(t){var n=this.cursor({});return new E(function(r,i){n.onerror=function(o){var s=ls(o.target.error);i(s)},n.onsuccess=function(o){var s=o.target.result;s?t(s.primaryKey,s.value).next(function(u){u?s.continue():r()}):r()}})},e.prototype.xt=function(t,n){var r=[];return new E(function(i,o){t.onerror=function(s){o(s.target.error)},t.onsuccess=function(s){var u=s.target.result;if(u){var a=new hd(u),c=n(u.primaryKey,u.value,a);if(c instanceof E){var h=c.catch(function(l){return a.done(),E.reject(l)});r.push(h)}a.isDone?i():a.Dt===null?u.continue():u.continue(a.Dt)}else i()}}).next(function(){return E.waitFor(r)})},e.prototype.options=function(t,n){var r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}},e.prototype.cursor=function(t){var n="next";if(t.reverse&&(n="prev"),t.index){var r=this.store.index(t.index);return t.Ft?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)},e}();function ge(e){return new E(function(t,n){e.onsuccess=function(r){var i=r.target.result;t(i)},e.onerror=function(r){var i=ls(r.target.error);n(i)}})}var Nu=!1;function ls(e){var t=sn._t(_e());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new w("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Nu||(Nu=!0,setTimeout(function(){throw r},0)),r}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Du=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Mt=n,i.currentSequenceNumber=r,i}return R(t,e),t}(nh);function St(e,t){var n=_(e);return sn.It(n.Mt,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fs=function(){function e(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return e.prototype.applyToRemoteDocument=function(t,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t.key)&&Up(o,t,r[i])}},e.prototype.applyToLocalView=function(t){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t.key)&&go(s,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t.key)&&go(s,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var n=this;this.mutations.forEach(function(r){var i=t.get(r.key),o=i;n.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(L.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,n){return t.add(n.key)},B())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ye(this.mutations,t.mutations,function(n,r){return du(n,r)})&&Ye(this.baseMutations,t.baseMutations,function(n,r){return du(n,r)})},e}(),fd=function(){function e(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return e.from=function(t,n,r){k(t.mutations.length===r.length);for(var i=Gp(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e}(),Ii=function(){function e(t,n,r,i,o,s,u){o===void 0&&(o=L.min()),s===void 0&&(s=L.min()),u===void 0&&(u=Tt.EMPTY_BYTE_STRING),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),ih=function(e){this.Lt=e};function wo(e,t){if(t.document)return Zp(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=C.fromSegments(t.noDocument.path),r=an(t.noDocument.readTime),i=dt.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=C.fromSegments(t.unknownDocument.path);return r=an(t.unknownDocument.version),dt.newUnknownDocument(o,r)}return D()}function Cu(e,t,n){var r=ps(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=function(l,f){return{name:Bn(l,f.key),fields:f.data.value.mapValue.fields,updateTime:jn(l,f.version.toTimestamp())}}(e.Lt,t),s=t.hasCommittedMutations;return new $(null,null,o,s,r,i)}if(t.isNoDocument()){var u=t.key.path.toArray(),a=un(t.version);return s=t.hasCommittedMutations,new $(null,new ud(u,a),null,s,r,i)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),h=un(t.version);return new $(new ad(c,h),null,null,!0,r,i)}return D()}function ps(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function oh(e){var t=new It(e[0],e[1]);return L.fromTimestamp(t)}function un(e){var t=e.toTimestamp();return new sd(t.seconds,t.nanoseconds)}function an(e){var t=new It(e.seconds,e.nanoseconds);return L.fromTimestamp(t)}function Ke(e,t){for(var n=(t.baseMutations||[]).map(function(a){return Tu(e.Lt,a)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){var o=t.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var s=t.mutations.map(function(a){return Tu(e.Lt,a)}),u=It.fromMillis(t.localWriteTimeMs);return new fs(t.batchId,u,n,s)}function Sn(e){var t,n,r=an(e.readTime),i=e.lastLimboFreeSnapshotVersion!==void 0?an(e.lastLimboFreeSnapshotVersion):L.min();return e.query.documents!==void 0?(k((n=e.query).documents.length===1),t=Kt(or(Qc(n.documents[0])))):t=function(o){return Kt(Jc(o))}(e.query),new Ii(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Tt.fromBase64String(e.resumeToken))}function sh(e,t){var n,r=un(t.snapshotVersion),i=un(t.lastLimboFreeSnapshotVersion);n=zr(t.target)?Yc(e.Lt,t.target):Xc(e.Lt,t.target);var o=t.resumeToken.toBase64();return new Et(t.targetId,ir(t.target),r,o,t.sequenceNumber,i,n)}function uh(e){var t=Jc({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?kc(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pd=function(){function e(){}return e.prototype.getBundleMetadata=function(t,n){return Ru(t).get(n).next(function(r){if(r)return{id:(i=r).bundleId,createTime:an(i.createTime),version:i.version};var i})},e.prototype.saveBundleMetadata=function(t,n){return Ru(t).put({bundleId:(r=n).id,createTime:un(bt(r.createTime)),version:r.version});var r},e.prototype.getNamedQuery=function(t,n){return ku(t).get(n).next(function(r){if(r)return{name:(i=r).name,query:uh(i.bundledQuery),readTime:an(i.readTime)};var i})},e.prototype.saveNamedQuery=function(t,n){return ku(t).put(function(r){return{name:r.name,readTime:un(bt(r.readTime)),bundledQuery:r.bundledQuery}}(n))},e}();function Ru(e){return St(e,rn.store)}function ku(e){return St(e,on.store)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dd=function(){function e(){this.Bt=new ds}return e.prototype.addToCollectionParentIndex=function(t,n){return this.Bt.add(n),E.resolve()},e.prototype.getCollectionParents=function(t,n){return E.resolve(this.Bt.getEntries(n))},e}(),ds=function(){function e(){this.index={}}return e.prototype.add=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new tt(U.comparator),o=!i.has(r);return this.index[n]=i.add(r),o},e.prototype.has=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)},e.prototype.getEntries=function(t){return(this.index[t]||new tt(U.comparator)).toArray()},e}(),vd=function(){function e(){this.qt=new ds}return e.prototype.addToCollectionParentIndex=function(t,n){var r=this;if(!this.qt.has(n)){var i=n.lastSegment(),o=n.popLast();t.addOnCommittedListener(function(){r.qt.add(n)});var s={collectionId:i,parent:Mt(o)};return xu(t).put(s)}return E.resolve()},e.prototype.getCollectionParents=function(t,n){var r=[],i=IDBKeyRange.bound([n,""],[Tc(n),""],!1,!0);return xu(t).Nt(i).next(function(o){for(var s=0,u=o;s<u.length;s++){var a=u[s];if(a.collectionId!==n)break;r.push(Gt(a.parent))}return r})},e}();function xu(e){return St(e,Ee.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ou={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ut=function(){function e(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(e,t,n){var r=e.store(K.store),i=e.store(ht.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.$t({range:s},function(d,g,b){return u++,b.delete()});o.push(a.next(function(){k(u===1)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=ht.key(t,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return E.waitFor(o).next(function(){return c})}function Qr(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw D();t=e.noDocument}return JSON.stringify(t).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ut.DEFAULT_COLLECTION_PERCENTILE=10,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ut.DEFAULT=new Ut(41943040,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ut.DISABLED=new Ut(-1,0,0);var gd=function(){function e(t,n,r,i){this.userId=t,this.R=n,this.Ut=r,this.referenceDelegate=i,this.Kt={}}return e.Qt=function(t,n,r,i){return k(t.uid!==""),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(t){var n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jt(t).$t({index:K.userMutationsIndex,range:r},function(i,o,s){n=!1,s.done()}).next(function(){return n})},e.prototype.addMutationBatch=function(t,n,r,i){var o=this,s=ze(t),u=Jt(t);return u.add({}).next(function(a){k(typeof a=="number");for(var c=new fs(a,n,r,i),h=function(I,N,A){var O=A.baseMutations.map(function(j){return Hr(I.Lt,j)}),F=A.mutations.map(function(j){return Hr(I.Lt,j)});return new K(N,A.batchId,A.localWriteTime.toMillis(),O,F)}(o.R,o.userId,c),l=[],f=new tt(function(I,N){return P(I.canonicalString(),N.canonicalString())}),p=0,d=i;p<d.length;p++){var g=d[p],b=ht.key(o.userId,g.key.path,a);f=f.add(g.key.path.popLast()),l.push(u.put(h)),l.push(s.put(b,ht.PLACEHOLDER))}return f.forEach(function(I){l.push(o.Ut.addToCollectionParentIndex(t,I))}),t.addOnCommittedListener(function(){o.Kt[a]=c.keys()}),E.waitFor(l).next(function(){return c})})},e.prototype.lookupMutationBatch=function(t,n){var r=this;return Jt(t).get(n).next(function(i){return i?(k(i.userId===r.userId),Ke(r.R,i)):null})},e.prototype.jt=function(t,n){var r=this;return this.Kt[n]?E.resolve(this.Kt[n]):this.lookupMutationBatch(t,n).next(function(i){if(i){var o=i.keys();return r.Kt[n]=o,o}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=this,i=n+1,o=IDBKeyRange.lowerBound([this.userId,i]),s=null;return Jt(t).$t({index:K.userMutationsIndex,range:o},function(u,a,c){a.userId===r.userId&&(k(a.batchId>=i),s=Ke(r.R,a)),c.done()}).next(function(){return s})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Jt(t).$t({index:K.userMutationsIndex,range:n,reverse:!0},function(i,o,s){r=o.batchId,s.done()}).next(function(){return r})},e.prototype.getAllMutationBatches=function(t){var n=this,r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jt(t).Nt(K.userMutationsIndex,r).next(function(i){return i.map(function(o){return Ke(n.R,o)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=ht.prefixForPath(this.userId,n.path),o=IDBKeyRange.lowerBound(i),s=[];return ze(t).$t({range:o},function(u,a,c){var h=u[0],l=u[1],f=u[2],p=Gt(l);if(h===r.userId&&n.path.isEqual(p))return Jt(t).get(f).next(function(d){if(!d)throw D();k(d.userId===r.userId),s.push(Ke(r.R,d))});c.done()}).next(function(){return s})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(P),o=[];return n.forEach(function(s){var u=ht.prefixForPath(r.userId,s.path),a=IDBKeyRange.lowerBound(u),c=ze(t).$t({range:a},function(h,l,f){var p=h[0],d=h[1],g=h[2],b=Gt(d);p===r.userId&&s.path.isEqual(b)?i=i.add(g):f.done()});o.push(c)}),E.waitFor(o).next(function(){return r.Wt(t,i)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=this,i=n.path,o=i.length+1,s=ht.prefixForPath(this.userId,i),u=IDBKeyRange.lowerBound(s),a=new tt(P);return ze(t).$t({range:u},function(c,h,l){var f=c[0],p=c[1],d=c[2],g=Gt(p);f===r.userId&&i.isPrefixOf(g)?g.length===o&&(a=a.add(d)):l.done()}).next(function(){return r.Wt(t,a)})},e.prototype.Wt=function(t,n){var r=this,i=[],o=[];return n.forEach(function(s){o.push(Jt(t).get(s).next(function(u){if(u===null)throw D();k(u.userId===r.userId),i.push(Ke(r.R,u))}))}),E.waitFor(o).next(function(){return i})},e.prototype.removeMutationBatch=function(t,n){var r=this;return ah(t.Mt,this.userId,n).next(function(i){return t.addOnCommittedListener(function(){r.Gt(n.batchId)}),E.forEach(i,function(o){return r.referenceDelegate.markPotentiallyOrphaned(t,o)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var n=this;return this.checkEmpty(t).next(function(r){if(!r)return E.resolve();var i=IDBKeyRange.lowerBound(ht.prefixForUser(n.userId)),o=[];return ze(t).$t({range:i},function(s,u,a){if(s[0]===n.userId){var c=Gt(s[1]);o.push(c)}else a.done()}).next(function(){k(o.length===0)})})},e.prototype.containsKey=function(t,n){return ch(t,this.userId,n)},e.prototype.zt=function(t){var n=this;return hh(t).get(this.userId).next(function(r){return r||new oe(n.userId,-1,"")})},e}();function ch(e,t,n){var r=ht.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return ze(e).$t({range:o,Ft:!0},function(u,a,c){var h=u[0],l=u[1];u[2],h===t&&l===i&&(s=!0),c.done()}).next(function(){return s})}function Jt(e){return St(e,K.store)}function ze(e){return St(e,ht.store)}function hh(e){return St(e,oe.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wr=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),yd=function(){function e(t,n){this.referenceDelegate=t,this.R=n}return e.prototype.allocateTargetId=function(t){var n=this;return this.Xt(t).next(function(r){var i=new Wr(r.highestTargetId);return r.highestTargetId=i.next(),n.Zt(t,r).next(function(){return r.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(n){return L.fromTimestamp(new It(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(n){return n.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.Xt(t).next(function(o){return o.highestListenSequenceNumber=n,r&&(o.lastRemoteSnapshotVersion=r.toTimestamp()),n>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=n),i.Zt(t,o)})},e.prototype.addTargetData=function(t,n){var r=this;return this.te(t,n).next(function(){return r.Xt(t).next(function(i){return i.targetCount+=1,r.ee(n,i),r.Zt(t,i)})})},e.prototype.updateTargetData=function(t,n){return this.te(t,n)},e.prototype.removeTargetData=function(t,n){var r=this;return this.removeMatchingKeysForTargetId(t,n.targetId).next(function(){return je(t).delete(n.targetId)}).next(function(){return r.Xt(t)}).next(function(i){return k(i.targetCount>0),i.targetCount-=1,r.Zt(t,i)})},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return je(t).$t(function(u,a){var c=Sn(a);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(o++,s.push(i.removeTargetData(t,c)))}).next(function(){return E.waitFor(s)}).next(function(){return o})},e.prototype.forEachTarget=function(t,n){return je(t).$t(function(r,i){var o=Sn(i);n(o)})},e.prototype.Xt=function(t){return Lu(t).get(Nt.key).next(function(n){return k(n!==null),n})},e.prototype.Zt=function(t,n){return Lu(t).put(Nt.key,n)},e.prototype.te=function(t,n){return je(t).put(sh(this.R,n))},e.prototype.ee=function(t,n){var r=!1;return t.targetId>n.highestTargetId&&(n.highestTargetId=t.targetId,r=!0),t.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t.sequenceNumber,r=!0),r},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(n){return n.targetCount})},e.prototype.getTargetData=function(t,n){var r=ir(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return je(t).$t({range:i,index:Et.queryTargetsIndexName},function(s,u,a){var c=Sn(u);mi(n,c.target)&&(o=c,a.done())}).next(function(){return o})},e.prototype.addMatchingKeys=function(t,n,r){var i=this,o=[],s=ne(t);return n.forEach(function(u){var a=Mt(u.path);o.push(s.put(new ot(r,a))),o.push(i.referenceDelegate.addReference(t,r,u))}),E.waitFor(o)},e.prototype.removeMatchingKeys=function(t,n,r){var i=this,o=ne(t);return E.forEach(n,function(s){var u=Mt(s.path);return E.waitFor([o.delete([r,u]),i.referenceDelegate.removeReference(t,r,s)])})},e.prototype.removeMatchingKeysForTargetId=function(t,n){var r=ne(t),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=IDBKeyRange.bound([n],[n+1],!1,!0),i=ne(t),o=B();return i.$t({range:r,Ft:!0},function(s,u,a){var c=Gt(s[1]),h=new C(c);o=o.add(h)}).next(function(){return o})},e.prototype.containsKey=function(t,n){var r=Mt(n.path),i=IDBKeyRange.bound([r],[Tc(r)],!1,!0),o=0;return ne(t).$t({index:ot.documentTargetsIndex,Ft:!0,range:i},function(s,u,a){var c=s[0];s[1],c!==0&&(o++,a.done())}).next(function(){return o>0})},e.prototype.lt=function(t,n){return je(t).get(n).next(function(r){return r?Sn(r):null})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function je(e){return St(e,Et.store)}function Lu(e){return St(e,Nt.store)}function ne(e){return St(e,ot.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fe(e){return m(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==v.FAILED_PRECONDITION||e.message!==eh)throw e;return T("LocalStore","Unexpectedly lost primary lease"),[2]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=P(n,i);return s===0?P(r,o):s}var md=function(){function e(t){this.ne=t,this.buffer=new tt(Pu),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var n=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(n);else{var r=this.buffer.last();Pu(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),wd=function(){function e(t,n){this.garbageCollector=t,this.asyncQueue=n,this.oe=!1,this.ce=null}return e.prototype.start=function(t){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return this.ce!==null},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;T("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,function(){return m(n,void 0,void 0,function(){var i;return y(this,function(o){switch(o.label){case 0:this.ce=null,this.oe=!0,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return o.sent(),[3,7];case 3:return Pe(i=o.sent())?(T("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i),[3,6]):[3,4];case 4:return[4,Fe(i)];case 5:o.sent(),o.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return o.sent(),[2]}})})})},e}(),bd=function(){function e(t,n){this.ae=t,this.params=n}return e.prototype.calculateTargetCount=function(t,n){return this.ae.he(t).next(function(r){return Math.floor(n/100*r)})},e.prototype.nthSequenceNumber=function(t,n){var r=this;if(n===0)return E.resolve(Rt.o);var i=new md(n);return this.ae.forEachTarget(t,function(o){return i.re(o.sequenceNumber)}).next(function(){return r.ae.le(t,function(o){return i.re(o)})}).next(function(){return i.maxValue})},e.prototype.removeTargets=function(t,n,r){return this.ae.removeTargets(t,n,r)},e.prototype.removeOrphanedDocuments=function(t,n){return this.ae.removeOrphanedDocuments(t,n)},e.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===-1?(T("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(Ou)):this.getCacheSize(t).next(function(i){return i<r.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector","Garbage collection skipped; Cache size "+i+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Ou):r.fe(t,n)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,n){var r,i,o,s,u,a,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(f){return f>h.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+f),i=h.params.maximumSequenceNumbersToCollect):i=f,s=Date.now(),h.nthSequenceNumber(t,i)}).next(function(f){return r=f,u=Date.now(),h.removeTargets(t,r,n)}).next(function(f){return o=f,a=Date.now(),h.removeOrphanedDocuments(t,r)}).next(function(f){return c=Date.now(),lo()<=V.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in `+(s-l)+`ms
	Determined least recently used `+i+" in "+(u-s)+`ms
	Removed `+o+" targets in "+(a-u)+`ms
	Removed `+f+" documents in "+(c-a)+`ms
Total Duration: `+(c-l)+"ms"),E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:f})})},e}(),Ed=function(){function e(t,n){this.db=t,this.garbageCollector=function(r,i){return new bd(r,i)}(this,n)}return e.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(r){return n.next(function(i){return r+i})})},e.prototype.de=function(t){var n=0;return this.le(t,function(r){n++}).next(function(){return n})},e.prototype.forEachTarget=function(t,n){return this.db.getTargetCache().forEachTarget(t,n)},e.prototype.le=function(t,n){return this.we(t,function(r,i){return n(i)})},e.prototype.addReference=function(t,n,r){return br(t,r)},e.prototype.removeReference=function(t,n,r){return br(t,r)},e.prototype.removeTargets=function(t,n,r){return this.db.getTargetCache().removeTargets(t,n,r)},e.prototype.markPotentiallyOrphaned=function(t,n){return br(t,n)},e.prototype._e=function(t,n){return function(r,i){var o=!1;return hh(r).Ot(function(s){return ch(r,s,i).next(function(u){return u&&(o=!0),E.resolve(!u)})}).next(function(){return o})}(t,n)},e.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[],s=0;return this.we(t,function(u,a){if(a<=n){var c=r._e(t,u).next(function(h){if(!h)return s++,i.getEntry(t,u).next(function(){return i.removeEntry(u),ne(t).delete([0,Mt(u.path)])})});o.push(c)}}).next(function(){return E.waitFor(o)}).next(function(){return i.apply(t)}).next(function(){return s})},e.prototype.removeTarget=function(t,n){var r=n.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)},e.prototype.updateLimboDocument=function(t,n){return br(t,n)},e.prototype.we=function(t,n){var r,i=ne(t),o=Rt.o;return i.$t({index:ot.documentTargetsIndex},function(s,u){var a=s[0];s[1];var c=u.path,h=u.sequenceNumber;a===0?(o!==Rt.o&&n(new C(Gt(r)),o),o=h,r=c):o=Rt.o}).next(function(){o!==Rt.o&&n(new C(Gt(r)),o)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function br(e,t){return ne(e).put(function(n,r){return new ot(0,Mt(n.path),r)}(t,e.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var gn=function(){function e(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return e.prototype.get=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0)for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];if(this.equalsFn(u,t))return a}},e.prototype.has=function(t){return this.get(t)!==void 0},e.prototype.set=function(t,n){var r=this.mapKeyFn(t),i=this.inner[r];if(i!==void 0){for(var o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,n]);i.push([t,n])}else this.inner[r]=[[t,n]]},e.prototype.delete=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),!0;return!1},e.prototype.forEach=function(t){Oe(this.inner,function(n,r){for(var i=0,o=r;i<o.length;i++){var s=o[i],u=s[0],a=s[1];t(u,a)}})},e.prototype.isEmpty=function(){return _c(this.inner)},e}(),lh=function(){function e(){this.changes=new gn(function(t){return t.toString()},function(t,n){return t.isEqual(n)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var n=this.changes.get(t);return n?n.readTime:L.min()},e.prototype.addEntry=function(t,n){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:n})},e.prototype.removeEntry=function(t,n){n===void 0&&(n=null),this.assertNotApplied(),this.changes.set(t,{document:dt.newInvalidDocument(t),readTime:n})},e.prototype.getEntry=function(t,n){this.assertNotApplied();var r=this.changes.get(n);return r!==void 0?E.resolve(r.document):this.getFromCache(t,n)},e.prototype.getEntries=function(t,n){return this.getAllFromCache(t,n)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),Id=function(){function e(t,n){this.R=t,this.Ut=n}return e.prototype.addEntry=function(t,n,r){return te(t).put(Er(n),r)},e.prototype.removeEntry=function(t,n){var r=te(t),i=Er(n);return r.delete(i)},e.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.me(t,i)})},e.prototype.getEntry=function(t,n){var r=this;return te(t).get(Er(n)).next(function(i){return r.ye(n,i)})},e.prototype.ge=function(t,n){var r=this;return te(t).get(Er(n)).next(function(i){return{document:r.ye(n,i),size:Qr(i)}})},e.prototype.getEntries=function(t,n){var r=this,i=Ft();return this.pe(t,n,function(o,s){var u=r.ye(o,s);i=i.insert(o,u)}).next(function(){return i})},e.prototype.Ee=function(t,n){var r=this,i=Ft(),o=new vt(C.comparator);return this.pe(t,n,function(s,u){var a=r.ye(s,u);i=i.insert(s,a),o=o.insert(s,Qr(u))}).next(function(){return{documents:i,Te:o}})},e.prototype.pe=function(t,n,r){if(n.isEmpty())return E.resolve();var i=IDBKeyRange.bound(n.first().path.toArray(),n.last().path.toArray()),o=n.getIterator(),s=o.getNext();return te(t).$t({range:i},function(u,a,c){for(var h=C.fromSegments(u);s&&C.comparator(s,h)<0;)r(s,null),s=o.getNext();s&&s.isEqual(h)&&(r(s,a),s=o.hasNext()?o.getNext():null),s?c.Ct(s.path.toArray()):c.done()}).next(function(){for(;s;)r(s,null),s=o.hasNext()?o.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){var i=this,o=Ft(),s=n.path.length+1,u={};if(r.isEqual(L.min())){var a=n.path.toArray();u.range=IDBKeyRange.lowerBound(a)}else{var c=n.path.toArray(),h=ps(r);u.range=IDBKeyRange.lowerBound([c,h],!0),u.index=$.collectionReadTimeIndex}return te(t).$t(u,function(l,f,p){if(l.length===s){var d=wo(i.R,f);n.path.isPrefixOf(d.key.path)?ur(n,d)&&(o=o.insert(d.key,d)):p.done()}}).next(function(){return o})},e.prototype.newChangeBuffer=function(t){return new Td(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(n){return n.byteSize})},e.prototype.getMetadata=function(t){return Fu(t).get(qt.key).next(function(n){return k(!!n),n})},e.prototype.me=function(t,n){return Fu(t).put(qt.key,n)},e.prototype.ye=function(t,n){if(n){var r=wo(this.R,n);if(!r.isNoDocument()||!r.version.isEqual(L.min()))return r}return dt.newInvalidDocument(t)},e}(),Td=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Ie=n,i.trackRemovals=r,i.Ae=new gn(function(o){return o.toString()},function(o,s){return o.isEqual(s)}),i}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[],o=0,s=new tt(function(u,a){return P(u.canonicalString(),a.canonicalString())});return this.changes.forEach(function(u,a){var c=r.Ae.get(u);if(a.document.isValidDocument()){var h=Cu(r.Ie.R,a.document,r.getReadTime(u));s=s.add(u.path.popLast());var l=Qr(h);o+=l-c,i.push(r.Ie.addEntry(n,u,h))}else if(o-=c,r.trackRemovals){var f=Cu(r.Ie.R,dt.newNoDocument(u,L.min()),r.getReadTime(u));i.push(r.Ie.addEntry(n,u,f))}else i.push(r.Ie.removeEntry(n,u))}),s.forEach(function(u){i.push(r.Ie.Ut.addToCollectionParentIndex(n,u))}),i.push(this.Ie.updateMetadata(n,o)),E.waitFor(i)},t.prototype.getFromCache=function(n,r){var i=this;return this.Ie.ge(n,r).next(function(o){return i.Ae.set(r,o.size),o.document})},t.prototype.getAllFromCache=function(n,r){var i=this;return this.Ie.Ee(n,r).next(function(o){var s=o.documents;return o.Te.forEach(function(u,a){i.Ae.set(u,a)}),s})},t}(lh);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(e){return St(e,qt.store)}function te(e){return St(e,$.store)}function Er(e){return e.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _d=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,n,r,i){var o=this;k(r<i&&r>=0&&i<=11);var s=new rh("createOrUpgrade",n);r<1&&i>=1&&(function(a){a.createObjectStore(At.store)}(t),function(a){a.createObjectStore(oe.store,{keyPath:oe.keyPath}),a.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0}),a.createObjectStore(ht.store)}(t),Mu(t),function(a){a.createObjectStore($.store)}(t));var u=E.resolve();return r<3&&i>=3&&(r!==0&&(function(a){a.deleteObjectStore(ot.store),a.deleteObjectStore(Et.store),a.deleteObjectStore(Nt.store)}(t),Mu(t)),u=u.next(function(){return function(a){var c=a.store(Nt.store),h=new Nt(0,0,L.min().toTimestamp(),0);return c.put(Nt.key,h)}(s)})),r<4&&i>=4&&(r!==0&&(u=u.next(function(){return function(a,c){return c.store(K.store).Nt().next(function(h){a.deleteObjectStore(K.store),a.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0});var l=c.store(K.store),f=h.map(function(p){return l.put(p)});return E.waitFor(f)})}(t,s)})),u=u.next(function(){(function(a){a.createObjectStore(Ht.store,{keyPath:Ht.keyPath})})(t)})),r<5&&i>=5&&(u=u.next(function(){return o.Re(s)})),r<6&&i>=6&&(u=u.next(function(){return function(a){a.createObjectStore(qt.store)}(t),o.be(s)})),r<7&&i>=7&&(u=u.next(function(){return o.ve(s)})),r<8&&i>=8&&(u=u.next(function(){return o.Pe(t,s)})),r<9&&i>=9&&(u=u.next(function(){(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(t),function(a){var c=a.objectStore($.store);c.createIndex($.readTimeIndex,$.readTimeIndexPath,{unique:!1}),c.createIndex($.collectionReadTimeIndex,$.collectionReadTimeIndexPath,{unique:!1})}(n)})),r<10&&i>=10&&(u=u.next(function(){return o.Ve(s)})),r<11&&i>=11&&(u=u.next(function(){(function(a){a.createObjectStore(rn.store,{keyPath:rn.keyPath})})(t),function(a){a.createObjectStore(on.store,{keyPath:on.keyPath})}(t)})),u},e.prototype.be=function(t){var n=0;return t.store($.store).$t(function(r,i){n+=Qr(i)}).next(function(){var r=new qt(n);return t.store(qt.store).put(qt.key,r)})},e.prototype.Re=function(t){var n=this,r=t.store(oe.store),i=t.store(K.store);return r.Nt().next(function(o){return E.forEach(o,function(s){var u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.Nt(K.userMutationsIndex,u).next(function(a){return E.forEach(a,function(c){k(c.userId===s.userId);var h=Ke(n.R,c);return ah(t,s.userId,h).next(function(){})})})})})},e.prototype.ve=function(t){var n=t.store(ot.store),r=t.store($.store);return t.store(Nt.store).get(Nt.key).next(function(i){var o=[];return r.$t(function(s,u){var a=new U(s),c=function(h){return[0,Mt(h)]}(a);o.push(n.get(c).next(function(h){return h?E.resolve():function(l){return n.put(new ot(0,Mt(l),i.highestListenSequenceNumber))}(a)}))}).next(function(){return E.waitFor(o)})})},e.prototype.Pe=function(t,n){t.createObjectStore(Ee.store,{keyPath:Ee.keyPath});var r=n.store(Ee.store),i=new ds,o=function(s){if(i.add(s)){var u=s.lastSegment(),a=s.popLast();return r.put({collectionId:u,parent:Mt(a)})}};return n.store($.store).$t({Ft:!0},function(s,u){var a=new U(s);return o(a.popLast())}).next(function(){return n.store(ht.store).$t({Ft:!0},function(s,u){s[0];var a=s[1];s[2];var c=Gt(a);return o(c.popLast())})})},e.prototype.Ve=function(t){var n=this,r=t.store(Et.store);return r.$t(function(i,o){var s=Sn(o),u=sh(n.R,s);return r.put(u)})},e}();function Mu(e){e.createObjectStore(ot.store,{keyPath:ot.keyPath}).createIndex(ot.documentTargetsIndex,ot.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Et.store,{keyPath:Et.keyPath}).createIndex(Et.queryTargetsIndexName,Et.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Nt.store)}var $i="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Sd=function(){function e(t,n,r,i,o,s,u,a,c,h){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=u,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(l){return Promise.resolve()},!e.yt())throw new w(v.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ed(this,i),this.Le=n+"main",this.R=new ih(a),this.Be=new sn(this.Le,11,new _d(this.R)),this.qe=new yd(this.referenceDelegate,this.R),this.Ut=new vd,this.Ue=function(l,f){return new Id(l,f)}(this.R,this.Ut),this.Ke=new pd,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,h===!1&&Y("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new w(v.FAILED_PRECONDITION,$i);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(n){return t.qe.getHighestSequenceNumber(n)})}).then(function(n){t.Ne=new Rt(n,t.De)}).then(function(){t.xe=!0}).catch(function(n){return t.Be&&t.Be.close(),Promise.reject(n)})},e.prototype.He=function(t){var n=this;return this.Me=function(r){return m(n,void 0,void 0,function(){return y(this,function(i){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return m(n,void 0,void 0,function(){return y(this,function(i){switch(i.label){case 0:return r.newVersion===null?[4,t()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return m(n,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(n){return Ir(n).put(new Ht(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(n).next(function(r){r||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(n)}).next(function(r){return t.isPrimary&&!r?t.Xe(n).next(function(){return!1}):!!r&&t.Ze(n).next(function(){return!0})})}).catch(function(n){if(Pe(n))return T("IndexedDbPersistence","Failed to extend owner lease: ",n),t.isPrimary;if(!t.allowTabSynchronization)throw n;return T("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1}).then(function(n){t.isPrimary!==n&&t.Se.enqueueRetryable(function(){return t.Me(n)}),t.isPrimary=n})},e.prototype.Je=function(t){var n=this;return Tn(t).get(At.key).next(function(r){return E.resolve(n.tn(r))})},e.prototype.en=function(t){return Ir(t).delete(this.clientId)},e.prototype.nn=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o=this;return y(this,function(s){switch(s.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(u){var a=St(u,Ht.store);return a.Nt().next(function(c){var h=o.rn(c,18e5),l=c.filter(function(f){return h.indexOf(f)===-1});return E.forEach(l,function(f){return a.delete(f.clientId)}).next(function(){return l})})}).catch(function(){return[]})]);case 1:if(t=s.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));s.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var n=this;return this.Ce?E.resolve(!0):Tn(t).get(At.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)){if(n.tn(r)&&n.networkEnabled)return!0;if(!n.tn(r)){if(!r.allowTabSynchronization)throw new w(v.FAILED_PRECONDITION,$i);return!1}}return!(!n.networkEnabled||!n.inForeground)||Ir(t).Nt().next(function(i){return n.rn(i,5e3).find(function(o){if(n.clientId!==o.clientId){var s=!n.networkEnabled&&o.networkEnabled,u=!n.inForeground&&o.inForeground,a=n.networkEnabled===o.networkEnabled;if(s||u&&a)return!0}return!1})===void 0})}).next(function(r){return n.isPrimary!==r&&T("IndexedDbPersistence","Client "+(r?"is":"is not")+" eligible for a primary lease."),r})},e.prototype.shutdown=function(){return m(this,void 0,void 0,function(){var t=this;return y(this,function(n){switch(n.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[At.store,Ht.store],function(r){var i=new Du(r,Rt.o);return t.Xe(i).next(function(){return t.en(i)})})];case 1:return n.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,n){var r=this;return t.filter(function(i){return r.sn(i.updateTimeMs,n)&&!r.cn(i.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(n){return Ir(n).Nt().next(function(r){return t.rn(r,18e5).map(function(i){return i.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return gd.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;T("IndexedDbPersistence","Starting transaction:",t);var o,s=n==="readonly"?"readonly":"readwrite";return this.Be.runTransaction(t,s,cd,function(u){return o=new Du(u,i.Ne?i.Ne.next():Rt.o),n==="readwrite-primary"?i.Je(o).next(function(a){return!!a||i.Ye(o)}).next(function(a){if(!a)throw Y("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new w(v.FAILED_PRECONDITION,eh);return r(o)}).next(function(a){return i.Ze(o).next(function(){return a})}):i.dn(o).next(function(){return r(o)})}).then(function(u){return o.raiseOnCommittedEvent(),u})},e.prototype.dn=function(t){var n=this;return Tn(t).get(At.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)&&!n.tn(r)&&!(n.Ce||n.allowTabSynchronization&&r.allowTabSynchronization))throw new w(v.FAILED_PRECONDITION,$i)})},e.prototype.Ze=function(t){var n=new At(this.clientId,this.allowTabSynchronization,Date.now());return Tn(t).put(At.key,n)},e.yt=function(){return sn.yt()},e.prototype.Xe=function(t){var n=this,r=Tn(t);return r.get(At.key).next(function(i){return n.tn(i)?(T("IndexedDbPersistence","Releasing primary lease."),r.delete(At.key)):E.resolve()})},e.prototype.sn=function(t,n){var r=Date.now();return!(t<r-n||t>r&&(Y("Detected an update time that is in the future: "+t+" > "+r),1))},e.prototype.We=function(){var t=this;this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground=t.document.visibilityState==="visible",t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground=this.document.visibilityState==="visible")},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,n=this;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ke=function(){n.un(),Rl()&&navigator.appVersion.match("Version/14")&&n.Se.enterRestrictedMode(!0),n.Se.enqueueAndForget(function(){return n.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var n;try{var r=((n=this.Qe)===null||n===void 0?void 0:n.getItem(this.on(t)))!==null;return T("IndexedDbPersistence","Client '"+t+"' "+(r?"is":"is not")+" zombied in LocalStorage"),r}catch(i){return Y("IndexedDbPersistence","Failed to get zombied client id.",i),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Y("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch{}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function Tn(e){return St(e,At.store)}function Ir(e){return St(e,Ht.store)}function vs(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var fh=function(){function e(t,n,r){this.Ue=t,this._n=n,this.Ut=r}return e.prototype.mn=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(i){return r.yn(t,n,i)})},e.prototype.yn=function(t,n,r){return this.Ue.getEntry(t,n).next(function(i){for(var o=0,s=r;o<s.length;o++)s[o].applyToLocalView(i);return i})},e.prototype.gn=function(t,n){t.forEach(function(r,i){for(var o=0,s=n;o<s.length;o++)s[o].applyToLocalView(i)})},e.prototype.pn=function(t,n){var r=this;return this.Ue.getEntries(t,n).next(function(i){return r.En(t,i).next(function(){return i})})},e.prototype.En=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,n).next(function(i){return r.gn(n,i)})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){return function(i){return C.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.Tn(t,n.path):ss(n)?this.In(t,n,r):this.An(t,n,r)},e.prototype.Tn=function(t,n){return this.mn(t,new C(n)).next(function(r){var i=yo();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})},e.prototype.In=function(t,n,r){var i=this,o=n.collectionGroup,s=yo();return this.Ut.getCollectionParents(t,o).next(function(u){return E.forEach(u,function(a){var c=function(h,l){return new Yt(l,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,a.child(o));return i.An(t,c,r).next(function(h){h.forEach(function(l,f){s=s.insert(l,f)})})}).next(function(){return s})})},e.prototype.An=function(t,n,r){var i,o,s=this;return this.Ue.getDocumentsMatchingQuery(t,n,r).next(function(u){return i=u,s._n.getAllMutationBatchesAffectingQuery(t,n)}).next(function(u){return o=u,s.Rn(t,o,i).next(function(a){i=a;for(var c=0,h=o;c<h.length;c++)for(var l=h[c],f=0,p=l.mutations;f<p.length;f++){var d=p[f],g=d.key,b=i.get(g);b==null&&(b=dt.newInvalidDocument(g),i=i.insert(g,b)),go(d,b,l.localWriteTime),b.isFoundDocument()||(i=i.remove(g))}})}).next(function(){return i.forEach(function(u,a){ur(n,a)||(i=i.remove(u))}),i})},e.prototype.Rn=function(t,n,r){for(var i=B(),o=0,s=n;o<s.length;o++)for(var u=0,a=s[o].mutations;u<a.length;u++){var c=a[u];c instanceof le&&r.get(c.key)===null&&(i=i.add(c.key))}var h=r;return this.Ue.getEntries(t,i).next(function(l){return l.forEach(function(f,p){p.isFoundDocument()&&(h=h.insert(f,p))}),h})},e}(),Ad=function(){function e(t,n,r,i){this.targetId=t,this.fromCache=n,this.bn=r,this.vn=i}return e.Pn=function(t,n){for(var r=B(),i=B(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new e(t,n.fromCache,r,i)},e}(),ph=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}(n)||r.isEqual(L.min())?this.Dn(t,n):this.Sn.pn(t,i).next(function(s){var u=o.Cn(n,s);return(Ar(n)||$r(n))&&o.Nn(n.limitType,u,i,r)?o.Dn(t,n):(lo()<=V.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vo(n)),o.Sn.getDocumentsMatchingQuery(t,n,r).next(function(a){return u.forEach(function(c){a=a.insert(c.key,c)}),a}))})},e.prototype.Cn=function(t,n){var r=new tt(Oc(t));return n.forEach(function(i,o){ur(t,o)&&(r=r.add(o))}),r},e.prototype.Nn=function(t,n,r,i){if(r.size!==n.size)return!0;var o=t==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)},e.prototype.Dn=function(t,n){return lo()<=V.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",vo(n)),this.Sn.getDocumentsMatchingQuery(t,n,L.min())},e}(),Nd=function(){function e(t,n,r,i){this.persistence=t,this.xn=n,this.R=i,this.kn=new vt(P),this.Fn=new gn(function(o){return ir(o)},mi),this.$n=L.min(),this._n=t.getMutationQueue(r),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new fh(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(r){return t.collect(r,n.kn)})},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(e,t,n,r){return new Nd(e,t,n,r)}function vh(e,t){return m(this,void 0,void 0,function(){var n,r,i,o;return y(this,function(s){switch(s.label){case 0:return n=_(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(u){var a;return n._n.getAllMutationBatches(u).next(function(c){return a=c,r=n.persistence.getMutationQueue(t),i=new fh(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(u)}).next(function(c){for(var h=[],l=[],f=B(),p=0,d=a;p<d.length;p++){var g=d[p];h.push(g.batchId);for(var b=0,I=g.mutations;b<I.length;b++){var N=I[b];f=f.add(N.key)}}for(var A=0,O=c;A<O.length;A++){var F=O[A];l.push(F.batchId);for(var j=0,rt=F.mutations;j<rt.length;j++){var Li=rt[j];f=f.add(Li.key)}}return i.pn(u,f).next(function(En){return{Ln:En,removedBatchIds:h,addedBatchIds:l}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Dd(e,t){var n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(r){var i=t.batch.keys(),o=n.On.newChangeBuffer({trackRemovals:!0});return function(s,u,a,c){var h=a.batch,l=h.keys(),f=E.resolve();return l.forEach(function(p){f=f.next(function(){return c.getEntry(u,p)}).next(function(d){var g=a.docVersions.get(p);k(g!==null),d.version.compareTo(g)<0&&(h.applyToRemoteDocument(d,a),d.isValidDocument()&&c.addEntry(d,a.commitVersion))})}),f.next(function(){return s._n.removeMutationBatch(u,h)})}(n,r,t,o).next(function(){return o.apply(r)}).next(function(){return n._n.performConsistencyCheck(r)}).next(function(){return n.Mn.pn(r,i)})})}function gh(e){var t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(n){return t.qe.getLastRemoteSnapshotVersion(n)})}function Cd(e,t){var n=_(e),r=t.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var s=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var u=[];t.targetChanges.forEach(function(h,l){var f=i.get(l);if(f){u.push(n.qe.removeMatchingKeys(o,h.removedDocuments,l).next(function(){return n.qe.addMatchingKeys(o,h.addedDocuments,l)}));var p=h.resumeToken;if(p.approximateByteSize()>0){var d=f.withResumeToken(p,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(l,d),function(g,b,I){return k(b.resumeToken.approximateByteSize()>0),g.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8||I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(f,d,h)&&u.push(n.qe.updateTargetData(o,d))}}});var a=Ft();if(t.documentUpdates.forEach(function(h,l){t.resolvedLimboDocuments.has(h)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(o,h))}),u.push(Rd(o,s,t.documentUpdates,r,void 0).next(function(h){a=h})),!r.isEqual(L.min())){var c=n.qe.getLastRemoteSnapshotVersion(o).next(function(h){return n.qe.setTargetsMetadata(o,o.currentSequenceNumber,r)});u.push(c)}return E.waitFor(u).next(function(){return s.apply(o)}).next(function(){return n.Mn.En(o,a)}).next(function(){return a})}).then(function(o){return n.kn=i,o})}function Rd(e,t,n,r,i){var o=B();return n.forEach(function(s){return o=o.add(s)}),t.getEntries(e,o).next(function(s){var u=Ft();return n.forEach(function(a,c){var h=s.get(a),l=(i==null?void 0:i.get(a))||r;c.isNoDocument()&&c.version.isEqual(L.min())?(t.removeEntry(a,l),u=u.insert(a,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c,l),u=u.insert(a,c)):T("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version)}),u})}function kd(e,t){var n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(r){return t===void 0&&(t=-1),n._n.getNextMutationBatchAfterBatchId(r,t)})}function Yr(e,t){var n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",function(r){var i;return n.qe.getTargetData(r,t).next(function(o){return o?(i=o,E.resolve(i)):n.qe.allocateTargetId(r).next(function(s){return i=new Ii(t,s,0,r.currentSequenceNumber),n.qe.addTargetData(r,i).next(function(){return i})})})}).then(function(r){var i=n.kn.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.kn=n.kn.insert(r.targetId,r),n.Fn.set(t,r.targetId)),r})}function cn(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return y(this,function(u){switch(u.label){case 0:r=_(e),i=r.kn.get(t),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(a){return r.persistence.referenceDelegate.removeTarget(a,i)})];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!Pe(s=u.sent()))throw s;return T("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.kn=r.kn.remove(t),r.Fn.delete(i.target),[2]}})})}function Xr(e,t,n){var r=_(e),i=L.min(),o=B();return r.persistence.runTransaction("Execute query","readonly",function(s){return function(u,a,c){var h=_(u),l=h.Fn.get(c);return l!==void 0?E.resolve(h.kn.get(l)):h.qe.getTargetData(a,c)}(r,s,Kt(t)).next(function(u){if(u)return i=u.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(s,u.targetId).next(function(a){o=a})}).next(function(){return r.xn.getDocumentsMatchingQuery(s,t,n?i:L.min(),n?o:B())}).next(function(u){return{documents:u,Bn:o}})})}function yh(e,t){var n=_(e),r=_(n.qe),i=n.kn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(o){return r.lt(o,t).next(function(s){return s?s.target:null})})}function mh(e){var t=_(e);return t.persistence.runTransaction("Get new document changes","readonly",function(n){return function(r,i,o){var s=_(r),u=Ft(),a=ps(o),c=te(i),h=IDBKeyRange.lowerBound(a,!0);return c.$t({index:$.readTimeIndex,range:h},function(l,f){var p=wo(s.R,f);u=u.insert(p.key,p),a=f.readTime}).next(function(){return{wn:u,readTime:oh(a)}})}(t.On,n,t.$n)}).then(function(n){var r=n.wn,i=n.readTime;return t.$n=i,r})}function xd(e){return m(this,void 0,void 0,function(){var t;return y(this,function(n){return[2,(t=_(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(r){return function(i){var o=te(i),s=L.min();return o.$t({index:$.readTimeIndex,reverse:!0},function(u,a,c){a.readTime&&(s=oh(a.readTime)),c.done()}).next(function(){return s})}(r)}).then(function(r){t.$n=r})]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Od=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,n){return E.resolve(this.Qn.get(n))},e.prototype.saveBundleMetadata=function(t,n){var r;return this.Qn.set(n.id,{id:(r=n).id,version:r.version,createTime:bt(r.createTime)}),E.resolve()},e.prototype.getNamedQuery=function(t,n){return E.resolve(this.jn.get(n))},e.prototype.saveNamedQuery=function(t,n){return this.jn.set(n.name,function(r){return{name:r.name,query:uh(r.bundledQuery),readTime:bt(r.readTime)}}(n)),E.resolve()},e}(),gs=function(){function e(){this.Wn=new tt(et.Gn),this.zn=new tt(et.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,n){var r=new et(t,n);this.Wn=this.Wn.add(r),this.zn=this.zn.add(r)},e.prototype.Jn=function(t,n){var r=this;t.forEach(function(i){return r.addReference(i,n)})},e.prototype.removeReference=function(t,n){this.Yn(new et(t,n))},e.prototype.Xn=function(t,n){var r=this;t.forEach(function(i){return r.removeReference(i,n)})},e.prototype.Zn=function(t){var n=this,r=new C(new U([])),i=new et(r,t),o=new et(r,t+1),s=[];return this.zn.forEachInRange([i,o],function(u){n.Yn(u),s.push(u.key)}),s},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(n){return t.Yn(n)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var n=new C(new U([])),r=new et(n,t),i=new et(n,t+1),o=B();return this.zn.forEachInRange([r,i],function(s){o=o.add(s.key)}),o},e.prototype.containsKey=function(t){var n=new et(t,0),r=this.Wn.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)},e}(),et=function(){function e(t,n){this.key=t,this.ns=n}return e.Gn=function(t,n){return C.comparator(t.key,n.key)||P(t.ns,n.ns)},e.Hn=function(t,n){return P(t.ns,n.ns)||C.comparator(t.key,n.key)},e}(),Ld=function(){function e(t,n){this.Ut=t,this.referenceDelegate=n,this._n=[],this.ss=1,this.rs=new tt(et.Gn)}return e.prototype.checkEmpty=function(t){return E.resolve(this._n.length===0)},e.prototype.addMutationBatch=function(t,n,r,i){var o=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var s=new fs(o,n,r,i);this._n.push(s);for(var u=0,a=i;u<a.length;u++){var c=a[u];this.rs=this.rs.add(new et(c.key,o)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return E.resolve(s)},e.prototype.lookupMutationBatch=function(t,n){return E.resolve(this.os(n))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=n+1,i=this.cs(r),o=i<0?0:i;return E.resolve(this._n.length>o?this._n[o]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return E.resolve(this._n.length===0?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return E.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=new et(n,0),o=new et(n,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([i,o],function(u){var a=r.os(u.ns);s.push(a)}),E.resolve(s)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(P);return n.forEach(function(o){var s=new et(o,0),u=new et(o,Number.POSITIVE_INFINITY);r.rs.forEachInRange([s,u],function(a){i=i.add(a.ns)})}),E.resolve(this.us(i))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=n.path,i=r.length+1,o=r;C.isDocumentKey(o)||(o=o.child(""));var s=new et(new C(o),0),u=new tt(P);return this.rs.forEachWhile(function(a){var c=a.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(u=u.add(a.ns)),!0)},s),E.resolve(this.us(u))},e.prototype.us=function(t){var n=this,r=[];return t.forEach(function(i){var o=n.os(i);o!==null&&r.push(o)}),r},e.prototype.removeMutationBatch=function(t,n){var r=this;k(this.hs(n.batchId,"removed")===0),this._n.shift();var i=this.rs;return E.forEach(n.mutations,function(o){var s=new et(o.key,n.batchId);return i=i.delete(s),r.referenceDelegate.markPotentiallyOrphaned(t,o.key)}).next(function(){r.rs=i})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,n){var r=new et(n,0),i=this.rs.firstAfterOrEqual(r);return E.resolve(n.isEqual(i&&i.key))},e.prototype.performConsistencyCheck=function(t){return this._n.length,E.resolve()},e.prototype.hs=function(t,n){return this.cs(t)},e.prototype.cs=function(t){return this._n.length===0?0:t-this._n[0].batchId},e.prototype.os=function(t){var n=this.cs(t);return n<0||n>=this._n.length?null:this._n[n]},e}(),Pd=function(){function e(t,n){this.Ut=t,this.ls=n,this.docs=new vt(C.comparator),this.size=0}return e.prototype.addEntry=function(t,n,r){var i=n.key,o=this.docs.get(i),s=o?o.size:0,u=this.ls(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:u,readTime:r}),this.size+=u-s,this.Ut.addToCollectionParentIndex(t,i.path.popLast())},e.prototype.removeEntry=function(t){var n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)},e.prototype.getEntry=function(t,n){var r=this.docs.get(n);return E.resolve(r?r.document.clone():dt.newInvalidDocument(n))},e.prototype.getEntries=function(t,n){var r=this,i=Ft();return n.forEach(function(o){var s=r.docs.get(o);i=i.insert(o,s?s.document.clone():dt.newInvalidDocument(o))}),E.resolve(i)},e.prototype.getDocumentsMatchingQuery=function(t,n,r){for(var i=Ft(),o=new C(n.path.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var u=s.getNext(),a=u.key,c=u.value,h=c.document,l=c.readTime;if(!n.path.isPrefixOf(a.path))break;l.compareTo(r)<=0||ur(n,h)&&(i=i.insert(h.key,h.clone()))}return E.resolve(i)},e.prototype.fs=function(t,n){return E.forEach(this.docs,function(r){return n(r)})},e.prototype.newChangeBuffer=function(t){return new Fd(this)},e.prototype.getSize=function(t){return E.resolve(this.size)},e}(),Fd=function(e){function t(n){var r=this;return(r=e.call(this)||this).Ie=n,r}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(o,s){s.document.isValidDocument()?i.push(r.Ie.addEntry(n,s.document,r.getReadTime(o))):r.Ie.removeEntry(o)}),E.waitFor(i)},t.prototype.getFromCache=function(n,r){return this.Ie.getEntry(n,r)},t.prototype.getAllFromCache=function(n,r){return this.Ie.getEntries(n,r)},t}(lh),Md=function(){function e(t){this.persistence=t,this.ds=new gn(function(n){return ir(n)},mi),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.ws=0,this._s=new gs,this.targetCount=0,this.ys=Wr.Jt()}return e.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(r,i){return n(i)}),E.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return E.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return E.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),E.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ws&&(this.ws=n),E.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var n=t.targetId;n>this.highestTargetId&&(this.ys=new Wr(n),this.highestTargetId=n),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,n){return this.te(n),this.targetCount+=1,E.resolve()},e.prototype.updateTargetData=function(t,n){return this.te(n),E.resolve()},e.prototype.removeTargetData=function(t,n){return this.ds.delete(n.target),this._s.Zn(n.targetId),this.targetCount-=1,E.resolve()},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return this.ds.forEach(function(u,a){a.sequenceNumber<=n&&r.get(a.targetId)===null&&(i.ds.delete(u),s.push(i.removeMatchingKeysForTargetId(t,a.targetId)),o++)}),E.waitFor(s).next(function(){return o})},e.prototype.getTargetCount=function(t){return E.resolve(this.targetCount)},e.prototype.getTargetData=function(t,n){var r=this.ds.get(n)||null;return E.resolve(r)},e.prototype.addMatchingKeys=function(t,n,r){return this._s.Jn(n,r),E.resolve()},e.prototype.removeMatchingKeys=function(t,n,r){this._s.Xn(n,r);var i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(function(s){o.push(i.markPotentiallyOrphaned(t,s))}),E.waitFor(o)},e.prototype.removeMatchingKeysForTargetId=function(t,n){return this._s.Zn(n),E.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=this._s.es(n);return E.resolve(r)},e.prototype.containsKey=function(t,n){return E.resolve(this._s.containsKey(n))},e}(),Vd=function(){function e(t,n){var r=this;this.gs={},this.Ne=new Rt(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Md(this),this.Ut=new dd,this.Ue=function(i,o){return new Pd(i,function(s){return r.referenceDelegate.ps(s)})}(this.Ut),this.R=new ih(n),this.Ke=new Od(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var n=this.gs[t.toKey()];return n||(n=new Ld(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=n),n},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;T("MemoryPersistence","Starting transaction:",t);var o=new Ud(this.Ne.next());return this.referenceDelegate.Es(),r(o).next(function(s){return i.referenceDelegate.Ts(o).next(function(){return s})}).toPromise().then(function(s){return o.raiseOnCommittedEvent(),s})},e.prototype.Is=function(t,n){return E.or(Object.values(this.gs).map(function(r){return function(){return r.containsKey(t,n)}}))},e}(),Ud=function(e){function t(n){var r=this;return(r=e.call(this)||this).currentSequenceNumber=n,r}return R(t,e),t}(nh),qd=function(){function e(t){this.persistence=t,this.As=new gs,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw D()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,n,r){return this.As.addReference(r,n),this.vs.delete(r.toString()),E.resolve()},e.prototype.removeReference=function(t,n,r){return this.As.removeReference(r,n),this.vs.add(r.toString()),E.resolve()},e.prototype.markPotentiallyOrphaned=function(t,n){return this.vs.add(n.toString()),E.resolve()},e.prototype.removeTarget=function(t,n){var r=this;this.As.Zn(n.targetId).forEach(function(o){return r.vs.add(o.toString())});var i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,n.targetId).next(function(o){o.forEach(function(s){return r.vs.add(s.toString())})}).next(function(){return i.removeTargetData(t,n)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.vs,function(i){var o=C.fromPath(i);return n.Ps(t,o).next(function(s){s||r.removeEntry(o)})}).next(function(){return n.Rs=null,r.apply(t)})},e.prototype.updateLimboDocument=function(t,n){var r=this;return this.Ps(t,n).next(function(i){i?r.vs.delete(n.toString()):r.vs.add(n.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,n){var r=this;return E.or([function(){return E.resolve(r.As.containsKey(n))},function(){return r.persistence.getTargetCache().containsKey(t,n)},function(){return r.persistence.Is(t,n)}])},e}(),it=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return this.uid!=null},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(e,t){return"firestore_clients_"+e+"_"+t}function Uu(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function Hi(e,t){return"firestore_targets_"+e+"_"+t}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");var qu=function(){function e(t,n,r,i){this.user=t,this.batchId=n,this.state=r,this.error=i}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s=typeof o=="object"&&["pending","acknowledged","rejected"].indexOf(o.state)!==-1&&(o.error===void 0||typeof o.error=="object");return s&&o.error&&(s=typeof o.error.message=="string"&&typeof o.error.code=="string")&&(i=new w(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(Y("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Qi=function(){function e(t,n,r){this.targetId=t,this.state=n,this.error=r}return e.Vs=function(t,n){var r,i=JSON.parse(n),o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(r=new w(i.error.code,i.error.message)),o?new e(t,i.state,r):(Y("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),ju=function(){function e(t,n){this.clientId=t,this.activeTargetIds=n}return e.Vs=function(t,n){for(var r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=Ei(),s=0;i&&s<r.activeTargetIds.length;++s)i=Nc(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(Y("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e}(),jd=function(){function e(t,n){this.clientId=t,this.onlineState=n}return e.Vs=function(t){var n=JSON.parse(t);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new e(n.clientId,n.onlineState):(Y("SharedClientState","Failed to parse online state: "+t),null)},e}(),bo=function(){function e(){this.activeTargetIds=Ei()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),Wi=function(){function e(t,n,r,i,o){this.window=t,this.Se=n,this.persistenceKey=r,this.Ns=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new vt(P),this.started=!1,this.$s=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Os=Vu(this.persistenceKey,this.Ns),this.Ms=function(u){return"firestore_sequence_number_"+u}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new bo),this.Ls=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.Us=function(u){return"firestore_online_state_"+u}(this.persistenceKey),this.Ks=function(u){return"firestore_bundle_loaded_"+u}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o,s,u,a,c,h,l,f=this;return y(this,function(p){switch(p.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=p.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(Vu(this.persistenceKey,i)))&&(s=ju.Vs(i,o))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(u=this.storage.getItem(this.Us))&&(a=this.js(u))&&this.Ws(a),c=0,h=this.$s;c<h.length;c++)l=h[c],this.ks(l);return this.$s=[],this.window.addEventListener("pagehide",function(){return f.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var n=!1;return this.Fs.forEach(function(r,i){i.activeTargetIds.has(t)&&(n=!0)}),n},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,n,r){this.zs(t,n,r),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var n="not-current";if(this.isActiveQueryTarget(t)){var r=this.storage.getItem(Hi(this.persistenceKey,t));if(r){var i=Qi.Vs(t,r);i&&(n=i.state)}}return this.Js.Ds(t),this.Qs(),n},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(Hi(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,n,r){this.Ys(t,n,r)},e.prototype.handleUserChange=function(t,n,r){var i=this;n.forEach(function(o){i.Hs(o)}),this.currentUser=t,r.forEach(function(o){i.addPendingMutation(o)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var n=this.storage.getItem(t);return T("SharedClientState","READ",t,n),n},e.prototype.setItem=function(t,n){T("SharedClientState","SET",t,n),this.storage.setItem(t,n)},e.prototype.removeItem=function(t){T("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(T("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Os)return void Y("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return m(n,void 0,void 0,function(){var i,o,s,u,a,c;return y(this,function(h){if(this.started){if(r.key!==null){if(this.Ls.test(r.key)){if(r.newValue==null)return i=this.ti(r.key),[2,this.ei(i,null)];if(o=this.ni(r.key,r.newValue))return[2,this.ei(o.clientId,o)]}else if(this.Bs.test(r.key)){if(r.newValue!==null&&(s=this.si(r.key,r.newValue)))return[2,this.ii(s)]}else if(this.qs.test(r.key)){if(r.newValue!==null&&(u=this.ri(r.key,r.newValue)))return[2,this.oi(u)]}else if(r.key===this.Us){if(r.newValue!==null&&(a=this.js(r.newValue)))return[2,this.Ws(a)]}else if(r.key===this.Ms)(c=function(l){var f=Rt.o;if(l!=null)try{var p=JSON.parse(l);k(typeof p=="number"),f=p}catch(d){Y("SharedClientState","Failed to read sequence number from WebStorage",d)}return f}(r.newValue))!==Rt.o&&this.sequenceNumberHandler(c);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}}else this.$s.push(r);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,n,r){var i=new qu(this.currentUser,t,n,r),o=Uu(this.persistenceKey,this.currentUser,t);this.setItem(o,i.Ss())},e.prototype.Hs=function(t){var n=Uu(this.persistenceKey,this.currentUser,t);this.removeItem(n)},e.prototype.Xs=function(t){var n={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(n))},e.prototype.Ys=function(t,n,r){var i=Hi(this.persistenceKey,t),o=new Qi(t,n,r);this.setItem(i,o.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var n=this.Ls.exec(t);return n?n[1]:null},e.prototype.ni=function(t,n){var r=this.ti(t);return ju.Vs(r,n)},e.prototype.si=function(t,n){var r=this.Bs.exec(t),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return qu.Vs(new it(o),i,n)},e.prototype.ri=function(t,n){var r=this.qs.exec(t),i=Number(r[1]);return Qi.Vs(i,n)},e.prototype.js=function(t){return jd.Vs(t)},e.prototype.ii=function(t){return m(this,void 0,void 0,function(){return y(this,function(n){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(T("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,n){var r=this,i=n?this.Fs.insert(t,n):this.Fs.remove(t),o=this.Gs(this.Fs),s=this.Gs(i),u=[],a=[];return s.forEach(function(c){o.has(c)||u.push(c)}),o.forEach(function(c){s.has(c)||a.push(c)}),this.syncEngine.hi(u,a).then(function(){r.Fs=i})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var n=Ei();return t.forEach(function(r,i){n=n.unionWith(i.activeTargetIds)}),n},e}(),wh=function(){function e(){this.li=new bo,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,n,r){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,n,r){this.fi[t]=n},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new bo,Promise.resolve()},e.prototype.handleUserChange=function(t,n,r){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),Bd=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),Bu=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(0)},e.prototype.yi=function(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(1)},e.yt=function(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0},e}(),Kd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},zd=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),Gd=function(e){function t(n){var r=this;return(r=e.call(this,n)||this).forceLongPolling=n.forceLongPolling,r.autoDetectLongPolling=n.autoDetectLongPolling,r.useFetchStreams=n.useFetchStreams,r}return R(t,e),t.prototype.Fi=function(n,r,i,o){return new Promise(function(s,u){var a=new Ip;a.listenOnce(wp.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Gi.NO_ERROR:var h=a.getResponseJson();T("Connection","XHR received:",JSON.stringify(h)),s(h);break;case Gi.TIMEOUT:T("Connection",'RPC "'+n+'" timed out'),u(new w(v.DEADLINE_EXCEEDED,"Request time out"));break;case Gi.HTTP_ERROR:var l=a.getStatus();if(T("Connection",'RPC "'+n+'" failed with status:',l,"response text:",a.getResponseText()),l>0){var f=a.getResponseJson().error;if(f&&f.status&&f.message){var p=function(d){var g=d.toLowerCase().replace(/_/g,"-");return Object.values(v).indexOf(g)>=0?g:v.UNKNOWN}(f.status);u(new w(p,f.message))}else u(new w(v.UNKNOWN,"Server responded with status "+a.getStatus()))}else u(new w(v.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{T("Connection",'RPC "'+n+'" completed.')}});var c=JSON.stringify(o);a.send(r,"POST",c,i,15)})},t.prototype.Oi=function(n,r){var i=[this.Di,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=yp(),s=mp(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new Ep({})),this.ki(u.initMessageHeaders,r),Tl()||Al()||Nl()||Dl()||Cl()||Sl()||(u.httpHeadersOverwriteParam="$httpHeaders");var a=i.join("");T("Connection","Creating WebChannel: "+a,u);var c=o.createWebChannel(a,u),h=!1,l=!1,f=new zd({Ei:function(d){l?T("Connection","Not sending because WebChannel is closed:",d):(h||(T("Connection","Opening WebChannel transport."),c.open(),h=!0),T("Connection","WebChannel sending:",d),c.send(d))},Ti:function(){return c.close()}}),p=function(d,g,b){d.listen(g,function(I){try{b(I)}catch(N){setTimeout(function(){throw N},0)}})};return p(c,mr.EventType.OPEN,function(){l||T("Connection","WebChannel transport opened.")}),p(c,mr.EventType.CLOSE,function(){l||(l=!0,T("Connection","WebChannel transport closed"),f.Vi())}),p(c,mr.EventType.ERROR,function(d){l||(l=!0,jr("Connection","WebChannel transport errored:",d),f.Vi(new w(v.UNAVAILABLE,"The operation could not be completed")))}),p(c,mr.EventType.MESSAGE,function(d){var g;if(!l){var b=d.data[0];k(!!b);var I=b,N=I.error||((g=I[0])===null||g===void 0?void 0:g.error);if(N){T("Connection","WebChannel received error:",N);var A=N.status,O=function(j){var rt=Q[j];if(rt!==void 0)return Kc(rt)}(A),F=N.message;O===void 0&&(O=v.INTERNAL,F="Unknown error status: "+A+" with message "+N.message),l=!0,f.Vi(new w(O,F)),c.close()}else T("Connection","WebChannel received:",b),f.Si(b)}}),p(s,bp.STAT_EVENT,function(d){d.stat===ou.PROXY?T("Connection","Detected buffering proxy"):d.stat===ou.NOPROXY&&T("Connection","Detected no buffering proxy")}),setTimeout(function(){f.Pi()},0),f},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Di=n+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,n,r,i){var o=this.xi(t,n);T("RestConnection","Sending: ",o,r);var s={};return this.ki(s,i),this.Fi(t,o,s,r).then(function(u){return T("RestConnection","Received: ",u),u},function(u){throw jr("RestConnection",t+" failed with error: ",u,"url: ",o,"request:",r),u})},e.prototype.$i=function(t,n,r,i){return this.Ni(t,n,r,i)},e.prototype.ki=function(t,n){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(var r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(t[r]=n.authHeaders[r])},e.prototype.xi=function(t,n){var r=Kd[t];return this.Di+"/v1/"+n+":"+r},e}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bh(){return typeof window!="undefined"?window:null}function Cr(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ti(e){return new Xp(e,!0)}var ys=function(){function e(t,n,r,i,o){r===void 0&&(r=1e3),i===void 0&&(i=1.5),o===void 0&&(o=6e4),this.Se=t,this.timerId=n,this.Mi=r,this.Li=i,this.Bi=o,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var n=this;this.cancel();var r=Math.floor(this.qi+this.Wi()),i=Math.max(0,Date.now()-this.Ki),o=Math.max(0,r-i);o>0&&T("ExponentialBackoff","Backing off for "+o+" ms (base delay: "+this.qi+" ms, delay with jitter: "+r+" ms, last attempt: "+i+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,o,function(){return n.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){this.Ui!==null&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){this.Ui!==null&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),Eh=function(){function e(t,n,r,i,o,s){this.Se=t,this.zi=r,this.Hi=i,this.Ji=o,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new ys(t,n)}return e.prototype.tr=function(){return this.state===1||this.state===2||this.state===4},e.prototype.er=function(){return this.state===2},e.prototype.start=function(){this.state!==3?this.auth():this.nr()},e.prototype.stop=function(){return m(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&this.Xi===null&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return m(this,void 0,void 0,function(){return y(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,n){return m(this,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,t!==3?this.Zi.reset():n&&n.code===v.RESOURCE_EXHAUSTED?(Y(n.toString()),Y("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===v.UNAUTHENTICATED&&this.Ji.invalidateToken(),this.stream!==null&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return r.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var n=this.hr(this.Yi),r=this.Yi;this.Ji.getToken().then(function(i){t.Yi===r&&t.lr(i)},function(i){n(function(){var o=new w(v.UNKNOWN,"Fetching auth token failed: "+i.message);return t.dr(o)})})},e.prototype.lr=function(t){var n=this,r=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){r(function(){return n.state=2,n.listener.Ii()})}),this.stream.Ri(function(i){r(function(){return n.dr(i)})}),this.stream.onMessage(function(i){r(function(){return n.onMessage(i)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return m(t,void 0,void 0,function(){return y(this,function(n){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return T("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var n=this;return function(r){n.Se.enqueueAndForget(function(){return n.Yi===t?r():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),$d=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"listen_stream_connection_backoff","listen_stream_idle",r,i,s)||this).R=o,u}return R(t,e),t.prototype.wr=function(n){return this.Hi.Oi("Listen",n)},t.prototype.onMessage=function(n){this.Zi.reset();var r=function(o,s){var u;if("targetChange"in s){s.targetChange;var a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:D()}(s.targetChange.targetChangeType||"NO_CHANGE"),c=s.targetChange.targetIds||[],h=function(b,I){return b.I?(k(I===void 0||typeof I=="string"),Tt.fromBase64String(I||"")):(k(I===void 0||I instanceof Uint8Array),Tt.fromUint8Array(I||new Uint8Array))}(o,s.targetChange.resumeToken),l=(f=s.targetChange.cause)&&function(b){var I=b.code===void 0?v.UNKNOWN:Kc(b.code);return new w(I,b.message||"")}(f);u=new Gc(a,c,h,l||null)}else if("documentChange"in s){s.documentChange,(a=s.documentChange).document,a.document.name,a.document.updateTime,c=$t(o,a.document.name),h=bt(a.document.updateTime);var f=new Ct({mapValue:{fields:a.document.fields}}),p=(l=dt.newFoundDocument(c,h,f),a.targetIds||[]),d=a.removedTargetIds||[];u=new Dr(p,d,l.key,l)}else if("documentDelete"in s)s.documentDelete,(a=s.documentDelete).document,c=$t(o,a.document),h=a.readTime?bt(a.readTime):L.min(),f=dt.newNoDocument(c,h),l=a.removedTargetIds||[],u=new Dr([],l,f.key,f);else if("documentRemove"in s)s.documentRemove,(a=s.documentRemove).document,c=$t(o,a.document),h=a.removedTargetIds||[],u=new Dr([],h,c,null);else{if(!("filter"in s))return D();s.filter;var g=s.filter;g.targetId,a=g.count||0,c=new jp(a),h=g.targetId,u=new zc(h,c)}return u}(this.R,n),i=function(o){if(!("targetChange"in o))return L.min();var s=o.targetChange;return s.targetIds&&s.targetIds.length?L.min():s.readTime?bt(s.readTime):L.min()}(n);return this.listener._r(r,i)},t.prototype.mr=function(n){var r={};r.database=Kn(this.R),r.addTarget=function(o,s){var u,a=s.target;return(u=zr(a)?{documents:Yc(o,a)}:{query:Xc(o,a)}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=$c(o,s.resumeToken):s.snapshotVersion.compareTo(L.min())>0&&(u.readTime=jn(o,s.snapshotVersion.toTimestamp())),u}(this.R,n);var i=function(o,s){var u=function(a,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return D()}}(0,s.purpose);return u==null?null:{"goog-listen-tags":u}}(this.R,n);i&&(r.labels=i),this.cr(r)},t.prototype.yr=function(n){var r={};r.database=Kn(this.R),r.removeTarget=n,this.cr(r)},t}(Eh),Hd=function(e){function t(n,r,i,o,s){var u=this;return(u=e.call(this,n,"write_stream_connection_backoff","write_stream_idle",r,i,s)||this).R=o,u.gr=!1,u}return R(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(n){return this.Hi.Oi("Write",n)},t.prototype.onMessage=function(n){if(k(!!n.streamToken),this.lastStreamToken=n.streamToken,this.gr){this.Zi.reset();var r=function(o,s){return o&&o.length>0?(k(s!==void 0),o.map(function(u){return function(a,c){var h=a.updateTime?bt(a.updateTime):bt(c);return h.isEqual(L.min())&&(h=bt(c)),new Vp(h,a.transformResults||[])}(u,s)})):[]}(n.writeResults,n.commitTime),i=bt(n.commitTime);return this.listener.Tr(i,r)}return k(!n.writeResults||n.writeResults.length===0),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var n={};n.database=Kn(this.R),this.cr(n)},t.prototype.Er=function(n){var r=this,i={streamToken:this.lastStreamToken,writes:n.map(function(o){return Hr(r.R,o)})};this.cr(i)},t}(Eh),Qd=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).credentials=n,o.Hi=r,o.R=i,o.Rr=!1,o}return R(t,e),t.prototype.br=function(){if(this.Rr)throw new w(v.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.Ni(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(v.UNKNOWN,s.toString())})},t.prototype.$i=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.$i(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(v.UNKNOWN,s.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),Wd=function(){function e(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;this.vr===0&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){this.state==="Online"?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,t==="Online"&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var n="Could not reach Cloud Firestore backend. "+t+`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Y(n),this.Vr=!1):T("OnlineStateTracker",n)},e.prototype.kr=function(){this.Pr!==null&&(this.Pr.cancel(),this.Pr=null)},e}(),Yd=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(s){n.enqueueAndForget(function(){return m(o,void 0,void 0,function(){return y(this,function(u){switch(u.label){case 0:return fe(this)?(T("RemoteStore","Restarting streams for network reachability change."),[4,function(a){return m(this,void 0,void 0,function(){var c;return y(this,function(h){switch(h.label){case 0:return(c=_(a)).Or.add(4),[4,yn(c)];case 1:return h.sent(),c.Br.set("Unknown"),c.Or.delete(4),[4,lr(c)];case 2:return h.sent(),[2]}})})}(this)]):[3,2];case 1:u.sent(),u.label=2;case 2:return[2]}})})})}),this.Br=new Wd(n,r)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(e){return m(this,void 0,void 0,function(){var t,n;return y(this,function(r){switch(r.label){case 0:if(!fe(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function yn(e){return m(this,void 0,void 0,function(){var t,n;return y(this,function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function _i(e,t){var n=_(e);n.$r.has(t.targetId)||(n.$r.set(t.targetId,t),bs(n)?ws(n):wn(n).er()&&ms(n,t))}function zn(e,t){var n=_(e),r=wn(n);n.$r.delete(t),r.er()&&Ih(n,t),n.$r.size===0&&(r.er()?r.ir():fe(n)&&n.Br.set("Unknown"))}function ms(e,t){e.qr.U(t.targetId),wn(e).mr(t)}function Ih(e,t){e.qr.U(t),wn(e).yr(t)}function ws(e){e.qr=new Qp({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),wn(e).start(),e.Br.Sr()}function bs(e){return fe(e)&&!wn(e).tr()&&e.$r.size>0}function fe(e){return _(e).Or.size===0}function Th(e){e.qr=void 0}function Xd(e){return m(this,void 0,void 0,function(){return y(this,function(t){return e.$r.forEach(function(n,r){ms(e,n)}),[2]})})}function Jd(e,t){return m(this,void 0,void 0,function(){return y(this,function(n){return Th(e),bs(e)?(e.Br.Nr(t),ws(e)):e.Br.set("Unknown"),[2]})})}function Zd(e,t,n){return m(this,void 0,void 0,function(){var r,i,o;return y(this,function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof Gc&&t.state===2&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(u,a){return m(this,void 0,void 0,function(){var c,h,l,f;return y(this,function(p){switch(p.label){case 0:c=a.cause,h=0,l=a.targetIds,p.label=1;case 1:return h<l.length?(f=l[h],u.$r.has(f)?[4,u.remoteSyncer.rejectListen(f,c)]:[3,3]):[3,5];case 2:p.sent(),u.$r.delete(f),u.qr.removeTarget(f),p.label=3;case 3:p.label=4;case 4:return h++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),T("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,Jr(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Dr?e.qr.X(t):t instanceof zc?e.qr.rt(t):e.qr.et(t),n.isEqual(L.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,gh(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(u,a){var c=u.qr.ut(a);return c.targetChanges.forEach(function(h,l){if(h.resumeToken.approximateByteSize()>0){var f=u.$r.get(l);f&&u.$r.set(l,f.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach(function(h){var l=u.$r.get(h);if(l){u.$r.set(h,l.withResumeToken(Tt.EMPTY_BYTE_STRING,l.snapshotVersion)),Ih(u,h);var f=new Ii(l.target,h,1,l.sequenceNumber);ms(u,f)}}),u.remoteSyncer.applyRemoteEvent(c)}(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return T("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Jr(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Jr(e,t,n){return m(this,void 0,void 0,function(){var r=this;return y(this,function(i){switch(i.label){case 0:if(!Pe(t))throw t;return e.Or.add(1),[4,yn(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return gh(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return y(this,function(o){switch(o.label){case 0:return T("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return o.sent(),e.Or.delete(1),[4,lr(e)];case 2:return o.sent(),[2]}})})}),[2]}})})}function _h(e,t){return t().catch(function(n){return Jr(e,n,t)})}function mn(e){return m(this,void 0,void 0,function(){var t,n,r,i,o;return y(this,function(s){switch(s.label){case 0:t=_(e),n=ae(t),r=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(u){return fe(u)&&u.Fr.length<10}(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,kd(t.localStore,r)];case 3:return(i=s.sent())===null?(t.Fr.length===0&&n.ir(),[3,7]):(r=i.batchId,function(u,a){u.Fr.push(a);var c=ae(u);c.er()&&c.pr&&c.Er(a.mutations)}(t,i),[3,6]);case 4:return o=s.sent(),[4,Jr(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Sh(t)&&Ah(t),[2]}})})}function Sh(e){return fe(e)&&!ae(e).tr()&&e.Fr.length>0}function Ah(e){ae(e).start()}function tv(e){return m(this,void 0,void 0,function(){return y(this,function(t){return ae(e).Ar(),[2]})})}function ev(e){return m(this,void 0,void 0,function(){var t,n,r,i;return y(this,function(o){for(t=ae(e),n=0,r=e.Fr;n<r.length;n++)i=r[n],t.Er(i.mutations);return[2]})})}function nv(e,t,n){return m(this,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return r=e.Fr.shift(),i=fd.from(r,t,n),[4,_h(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,mn(e)];case 2:return o.sent(),[2]}})})}function rv(e,t){return m(this,void 0,void 0,function(){return y(this,function(n){switch(n.label){case 0:return t&&ae(e).pr?[4,function(r,i){return m(this,void 0,void 0,function(){var o,s;return y(this,function(u){switch(u.label){case 0:return Bc(s=i.code)&&s!==v.ABORTED?(o=r.Fr.shift(),ae(r).sr(),[4,_h(r,function(){return r.remoteSyncer.rejectFailedWrite(o.batchId,i)})]):[3,3];case 1:return u.sent(),[4,mn(r)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Sh(e)&&Ah(e),[2]}})})}function Eo(e,t){return m(this,void 0,void 0,function(){var n;return y(this,function(r){switch(r.label){case 0:return n=_(e),t?(n.Or.delete(2),[4,lr(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.Or.add(2),[4,yn(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function wn(e){var t=this;return e.Ur||(e.Ur=function(n,r,i){var o=_(n);return o.br(),new $d(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Xd.bind(null,e),Ri:Jd.bind(null,e),_r:Zd.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return n?(e.Ur.sr(),bs(e)?ws(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:r.sent(),Th(e),r.label=3;case 3:return[2]}})})})),e.Ur}function ae(e){var t=this;return e.Kr||(e.Kr=function(n,r,i){var o=_(n);return o.br(),new Hd(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:tv.bind(null,e),Ri:rv.bind(null,e),Ir:ev.bind(null,e),Tr:nv.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return n?(e.Kr.sr(),[4,mn(e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:r.sent(),e.Fr.length>0&&(T("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),r.label=4;case 4:return[2]}})})})),e.Kr}var iv=function(){function e(t,n,r,i,o){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new _t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(s){})}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(t){var n=this;this.timerHandle=setTimeout(function(){return n.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(v.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return t.timerHandle!==null?(t.clearTimeout(),t.op().then(function(n){return t.deferred.resolve(n)})):Promise.resolve()})},e.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function bn(e,t){if(Y("AsyncQueue",t+": "+e),Pe(e))return new w(v.UNAVAILABLE,t+": "+e);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nh=function(){function e(t){this.comparator=t?function(n,r){return t(n,r)||C.comparator(n.key,r.key)}:function(n,r){return C.comparator(n.key,r.key)},this.keyedMap=yo(),this.sortedSet=new vt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return this.keyedMap.get(t)!=null},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.add=function(t){var n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))},e.prototype.delete=function(t){var n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(n){t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e}(),Ku=function(){function e(){this.Qr=new vt(C.comparator)}return e.prototype.track=function(t){var n=t.doc.key,r=this.Qr.get(n);r?t.type!==0&&r.type===3?this.Qr=this.Qr.insert(n,t):t.type===3&&r.type!==1?this.Qr=this.Qr.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Qr=this.Qr.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Qr=this.Qr.remove(n):t.type===1&&r.type===2?this.Qr=this.Qr.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):D():this.Qr=this.Qr.insert(n,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(n,r){t.push(r)}),t},e}(),Zr=function(){function e(t,n,r,i,o,s,u,a){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=a}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach(function(s){o.push({type:0,doc:s})}),new e(t,n,Nh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&sr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0},e}(),ov=function(){this.Wr=void 0,this.listeners=[]},sv=function(){this.queries=new gn(function(e){return xc(e)},sr),this.onlineState="Unknown",this.Gr=new Set};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a;return y(this,function(c){switch(c.label){case 0:if(n=_(e),r=t.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new ov),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return u=c.sent(),a=bn(u,"Initialization of query '"+vo(t.query)+"' failed"),[2,void t.onError(a)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&Ts(n),[2]}})})}function Is(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return y(this,function(u){return n=_(e),r=t.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=o.listeners.length===0),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function uv(e,t){for(var n=_(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],u=s.query,a=n.queries.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);a.Wr=s}}r&&Ts(n)}function av(e,t,n){var r=_(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function Ts(e){e.Gr.forEach(function(t){t.next()})}var _s=function(){function e(t,n,r){this.query=t,this.Jr=n,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=r||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var n=[],r=0,i=t.docChanges;r<i.length;r++){var o=i[r];o.type!==3&&n.push(o)}t=new Zr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var s=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),s=!0):this.eo(t,this.onlineState)&&(this.no(t),s=!0),this.Xr=t,s},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var n=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),n=!0),n},e.prototype.eo=function(t,n){if(!t.fromCache)return!0;var r=n!=="Offline";return!(this.options.so&&r||t.docs.isEmpty()&&n!=="Offline")},e.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var n=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0},e.prototype.no=function(t){t=Zr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dh=function(e){this.key=e},Ch=function(e){this.key=e},Rh=function(){function e(t,n){this.query=t,this.uo=n,this.ao=null,this.current=!1,this.ho=B(),this.mutatedKeys=B(),this.lo=Oc(t),this.fo=new Nh(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,n){var r=this,i=n?n.mo:new Ku,o=n?n.fo:this.fo,s=n?n.mutatedKeys:this.mutatedKeys,u=o,a=!1,c=Ar(this.query)&&o.size===this.query.limit?o.last():null,h=$r(this.query)&&o.size===this.query.limit?o.first():null;if(t.inorderTraversal(function(f,p){var d=o.get(f),g=ur(r.query,p)?p:null,b=!!d&&r.mutatedKeys.has(d.key),I=!!g&&(g.hasLocalMutations||r.mutatedKeys.has(g.key)&&g.hasCommittedMutations),N=!1;d&&g?d.data.isEqual(g.data)?b!==I&&(i.track({type:3,doc:g}),N=!0):r.yo(d,g)||(i.track({type:2,doc:g}),N=!0,(c&&r.lo(g,c)>0||h&&r.lo(g,h)<0)&&(a=!0)):!d&&g?(i.track({type:0,doc:g}),N=!0):d&&!g&&(i.track({type:1,doc:d}),N=!0,(c||h)&&(a=!0)),N&&(g?(u=u.add(g),s=I?s.add(f):s.delete(f)):(u=u.delete(f),s=s.delete(f)))}),Ar(this.query)||$r(this.query))for(;u.size>this.query.limit;){var l=Ar(this.query)?u.last():u.first();u=u.delete(l.key),s=s.delete(l.key),i.track({type:1,doc:l})}return{fo:u,mo:i,Nn:a,mutatedKeys:s}},e.prototype.yo=function(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations},e.prototype.applyChanges=function(t,n,r){var i=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var s=t.mo.jr();s.sort(function(h,l){return function(f,p){var d=function(g){switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return d(f)-d(p)}(h.type,l.type)||i.lo(h.doc,l.doc)}),this.po(r);var u=n?this.Eo():[],a=this.ho.size===0&&this.current?1:0,c=a!==this.ao;return this.ao=a,s.length!==0||c?{snapshot:new Zr(this.query,t.fo,o,s,t.mutatedKeys,a===0,c,!1),To:u}:{To:u}},e.prototype.zr=function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Ku,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var n=this;t&&(t.addedDocuments.forEach(function(r){return n.uo=n.uo.add(r)}),t.modifiedDocuments.forEach(function(r){}),t.removedDocuments.forEach(function(r){return n.uo=n.uo.delete(r)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var n=this.ho;this.ho=B(),this.fo.forEach(function(i){t.Io(i.key)&&(t.ho=t.ho.add(i.key))});var r=[];return n.forEach(function(i){t.ho.has(i)||r.push(new Ch(i))}),this.ho.forEach(function(i){n.has(i)||r.push(new Dh(i))}),r},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=B();var n=this._o(t.documents);return this.applyChanges(n,!0)},e.prototype.Ro=function(){return Zr.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,this.ao===0)},e}(),cv=function(e,t,n){this.query=e,this.targetId=t,this.view=n},hv=function(e){this.key=e,this.bo=!1},lv=function(){function e(t,n,r,i,o,s){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.vo={},this.Po=new gn(function(u){return xc(u)},sr),this.Vo=new Map,this.So=new Set,this.Do=new vt(C.comparator),this.Co=new Map,this.No=new gs,this.xo={},this.ko=new Map,this.Fo=Wr.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.$o===!0},enumerable:!1,configurable:!0}),e}();function fv(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u;return y(this,function(a){switch(a.label){case 0:return n=Cs(e),(o=n.Po.get(t))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Yr(n.localStore,Kt(t))];case 2:return s=a.sent(),u=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,Ss(n,t,r,u==="current")];case 3:i=a.sent(),n.isPrimaryClient&&_i(n.remoteStore,s),a.label=4;case 4:return[2,i]}})})}function Ss(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,u,a,c;return y(this,function(h){switch(h.label){case 0:return e.Oo=function(l,f,p){return function(d,g,b,I){return m(this,void 0,void 0,function(){var N,A,O;return y(this,function(F){switch(F.label){case 0:return N=g.view._o(b),N.Nn?[4,Xr(d.localStore,g.query,!1).then(function(j){var rt=j.documents;return g.view._o(rt,N)})]:[3,2];case 1:N=F.sent(),F.label=2;case 2:return A=I&&I.targetChanges.get(g.targetId),O=g.view.applyChanges(N,d.isPrimaryClient,A),[2,(Io(d,g.targetId,O.To),O.snapshot)]}})})}(e,l,f,p)},[4,Xr(e.localStore,t,!0)];case 1:return i=h.sent(),o=new Rh(t,i.Bn),s=o._o(i.documents),u=cs.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline"),a=o.applyChanges(s,e.isPrimaryClient,u),Io(e,n,a.To),c=new cv(t,n,o),[2,(e.Po.set(t,c),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),a.snapshot)]}})})}function pv(e,t){return m(this,void 0,void 0,function(){var n,r,i;return y(this,function(o){switch(o.label){case 0:return n=_(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(s){return!sr(s,t)})),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,cn(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),zn(n.remoteStore,r.targetId),hn(n,r.targetId)}).catch(Fe)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return hn(n,r.targetId),[4,cn(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function dv(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return y(this,function(u){switch(u.label){case 0:r=Rs(e),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(a,c){var h,l=_(a),f=It.now(),p=c.reduce(function(d,g){return d.add(g.key)},B());return l.persistence.runTransaction("Locally write mutations","readwrite",function(d){return l.Mn.pn(d,p).next(function(g){h=g;for(var b=[],I=0,N=c;I<N.length;I++){var A=N[I],O=qp(A,h.get(A.key));O!=null&&b.push(new le(A.key,O,Dc(O.value.mapValue),ft.exists(!0)))}return l._n.addMutationBatch(d,f,b,c)})}).then(function(d){return d.applyToLocalDocumentSet(h),{batchId:d.batchId,changes:h}})}(r.localStore,t)];case 2:return i=u.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(a,c,h){var l=a.xo[a.currentUser.toKey()];l||(l=new vt(P)),l=l.insert(c,h),a.xo[a.currentUser.toKey()]=l}(r,i.batchId,n),[4,pe(r,i.changes)];case 3:return u.sent(),[4,mn(r.remoteStore)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=bn(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function kh(e,t){return m(this,void 0,void 0,function(){var n,r;return y(this,function(i){switch(i.label){case 0:n=_(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Cd(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach(function(o,s){var u=n.Co.get(s);u&&(k(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?u.bo=!0:o.modifiedDocuments.size>0?k(u.bo):o.removedDocuments.size>0&&(k(u.bo),u.bo=!1))}),[4,pe(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,Fe(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function zu(e,t,n){var r=_(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){var i=[];r.Po.forEach(function(o,s){var u=s.view.zr(t);u.snapshot&&i.push(u.snapshot)}),function(o,s){var u=_(o);u.onlineState=s;var a=!1;u.queries.forEach(function(c,h){for(var l=0,f=h.listeners;l<f.length;l++)f[l].zr(s)&&(a=!0)}),a&&Ts(u)}(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function vv(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a;return y(this,function(c){switch(c.label){case 0:return(r=_(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new vt(C.comparator)).insert(o,dt.newNoDocument(o,L.min())),u=B().add(o),a=new as(L.min(),new Map,new tt(P),s,u),[4,kh(r,a)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),Ds(r),[3,4];case 2:return[4,cn(r.localStore,t,!1).then(function(){return hn(r,t,n)}).catch(Fe)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function gv(e,t){return m(this,void 0,void 0,function(){var n,r,i;return y(this,function(o){switch(o.label){case 0:n=_(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Dd(n.localStore,t)];case 2:return i=o.sent(),Ns(n,r,null),As(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,pe(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Fe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function yv(e,t,n){return m(this,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:r=_(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(s,u){var a=_(s);return a.persistence.runTransaction("Reject batch","readwrite-primary",function(c){var h;return a._n.lookupMutationBatch(c,u).next(function(l){return k(l!==null),h=l.keys(),a._n.removeMutationBatch(c,l)}).next(function(){return a._n.performConsistencyCheck(c)}).next(function(){return a.Mn.pn(c,h)})})}(r.localStore,t)];case 2:return i=o.sent(),Ns(r,t,n),As(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,pe(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Fe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function mv(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return y(this,function(u){switch(u.label){case 0:fe((n=_(e)).remoteStore)||T("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(a){var c=_(a);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(h){return c._n.getHighestUnacknowledgedBatchId(h)})}(n.localStore)];case 2:return(r=u.sent())===-1?[2,void t.resolve()]:((i=n.ko.get(r)||[]).push(t),n.ko.set(r,i),[3,4]);case 3:return o=u.sent(),s=bn(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}})})}function As(e,t){(e.ko.get(t)||[]).forEach(function(n){n.resolve()}),e.ko.delete(t)}function Ns(e,t,n){var r=_(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function hn(e,t,n){n===void 0&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(s){e.No.containsKey(s)||xh(e,s)})}function xh(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);n!==null&&(zn(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),Ds(e))}function Io(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Dh?(e.No.addReference(o.key,t),wv(e,o)):o instanceof Ch?(T("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||xh(e,o.key)):D()}}function wv(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(T("SyncEngine","New document in limbo: "+n),e.So.add(r),Ds(e))}function Ds(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new C(U.fromString(t)),r=e.Fo.next();e.Co.set(r,new hv(n)),e.Do=e.Do.insert(n,r),_i(e.remoteStore,new Ii(Kt(or(n.path)),r,2,Rt.o))}}function pe(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return y(this,function(u){switch(u.label){case 0:return r=_(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(a,c){s.push(r.Oo(c,t,n).then(function(h){if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,h.fromCache?"not-current":"current"),i.push(h);var l=Ad.Pn(c.targetId,h);o.push(l)}}))}),[4,Promise.all(s)]);case 1:return u.sent(),r.vo._r(i),[4,function(a,c){return m(this,void 0,void 0,function(){var h,l,f,p,d,g,b,I,N;return y(this,function(A){switch(A.label){case 0:h=_(a),A.label=1;case 1:return A.trys.push([1,3,,4]),[4,h.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(O){return E.forEach(c,function(F){return E.forEach(F.bn,function(j){return h.persistence.referenceDelegate.addReference(O,F.targetId,j)}).next(function(){return E.forEach(F.vn,function(j){return h.persistence.referenceDelegate.removeReference(O,F.targetId,j)})})})})];case 2:return A.sent(),[3,4];case 3:if(!Pe(l=A.sent()))throw l;return T("LocalStore","Failed to update sequence numbers: "+l),[3,4];case 4:for(f=0,p=c;f<p.length;f++)d=p[f],g=d.targetId,d.fromCache||(b=h.kn.get(g),I=b.snapshotVersion,N=b.withLastLimboFreeSnapshotVersion(I),h.kn=h.kn.insert(g,N));return[2]}})})}(r.localStore,o)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function bv(e,t){return m(this,void 0,void 0,function(){var n,r;return y(this,function(i){switch(i.label){case 0:return(n=_(e)).currentUser.isEqual(t)?[3,3]:(T("SyncEngine","User change. New user:",t.toKey()),[4,vh(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,function(o,s){o.ko.forEach(function(u){u.forEach(function(a){a.reject(new w(v.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ko.clear()}(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,pe(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Ev(e,t){var n=_(e),r=n.Co.get(t);if(r&&r.bo)return B().add(r.key);var i=B(),o=n.Vo.get(t);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Po.get(a);i=i.unionWith(c.view.wo)}return i}function Iv(e,t){return m(this,void 0,void 0,function(){var n,r,i;return y(this,function(o){switch(o.label){case 0:return[4,Xr((n=_(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&Io(n,t.targetId,i.To),i)]}})})}function Tv(e){return m(this,void 0,void 0,function(){var t;return y(this,function(n){return[2,mh((t=_(e)).localStore).then(function(r){return pe(t,r)})]})})}function _v(e,t,n,r){return m(this,void 0,void 0,function(){var i,o;return y(this,function(s){switch(s.label){case 0:return[4,function(u,a){var c=_(u),h=_(c._n);return c.persistence.runTransaction("Lookup mutation documents","readonly",function(l){return h.jt(l,a).next(function(f){return f?c.Mn.pn(l,f):E.resolve(null)})})}((i=_(e)).localStore,t)];case 1:return(o=s.sent())===null?[3,6]:n!=="pending"?[3,3]:[4,mn(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:n==="acknowledged"||n==="rejected"?(Ns(i,t,r||null),As(i,t),function(u,a){_(_(u)._n).Gt(a)}(i.localStore,t)):D(),s.label=4;case 4:return[4,pe(i,o)];case 5:return s.sent(),[3,7];case 6:T("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}})})}function Sv(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,u,a,c;return y(this,function(h){switch(h.label){case 0:return Cs(n=_(e)),Rs(n),t!==!0||n.$o===!0?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Gu(n,r.toArray())]);case 1:return i=h.sent(),n.$o=!0,[4,Eo(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)u=s[o],_i(n.remoteStore,u);return[3,7];case 3:return t!==!1||n.$o===!1?[3,7]:(a=[],c=Promise.resolve(),n.Vo.forEach(function(l,f){n.sharedClientState.isLocalQueryTarget(f)?a.push(f):c=c.then(function(){return hn(n,f),cn(n.localStore,f,!0)}),zn(n.remoteStore,f)}),[4,c]);case 4:return h.sent(),[4,Gu(n,a)];case 5:return h.sent(),function(l){var f=_(l);f.Co.forEach(function(p,d){zn(f.remoteStore,d)}),f.No.ts(),f.Co=new Map,f.Do=new vt(C.comparator)}(n),n.$o=!1,[4,Eo(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}})})}function Gu(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f,p,d,g,b;return y(this,function(I){switch(I.label){case 0:r=_(e),i=[],o=[],s=0,u=t,I.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=r.Vo.get(a))&&h.length!==0?[4,Yr(r.localStore,Kt(h[0]))]:[3,7]):[3,13];case 2:c=I.sent(),l=0,f=h,I.label=3;case 3:return l<f.length?(p=f[l],d=r.Po.get(p),[4,Iv(r,d)]):[3,6];case 4:(g=I.sent()).snapshot&&o.push(g.snapshot),I.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,yh(r.localStore,a)];case 8:return b=I.sent(),[4,Yr(r.localStore,b)];case 9:return c=I.sent(),[4,Ss(r,Oh(b),a,!1)];case 10:I.sent(),I.label=11;case 11:i.push(c),I.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function Oh(e){return Rc(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Av(e){var t=_(e);return _(_(t.localStore).persistence).fn()}function Nv(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s;return y(this,function(u){switch(u.label){case 0:return(i=_(e)).$o?(T("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,mh(i.localStore)];case 3:return o=u.sent(),s=as.createSynthesizedRemoteEventForCurrentChange(t,n==="current"),[4,pe(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,cn(i.localStore,t,!0)];case 6:return u.sent(),hn(i,t,r),[3,8];case 7:D(),u.label=8;case 8:return[2]}})})}function Dv(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,u,a,c,h,l,f;return y(this,function(p){switch(p.label){case 0:if(!(r=Cs(e)).$o)return[3,10];i=0,o=t,p.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(T("SyncEngine","Adding an already active target "+s),[3,5]):[4,yh(r.localStore,s)]):[3,6];case 2:return u=p.sent(),[4,Yr(r.localStore,u)];case 3:return a=p.sent(),[4,Ss(r,Oh(u),a.targetId,!1)];case 4:p.sent(),_i(r.remoteStore,a),p.label=5;case 5:return i++,[3,1];case 6:c=function(d){return y(this,function(g){switch(g.label){case 0:return r.Vo.has(d)?[4,cn(r.localStore,d,!1).then(function(){zn(r.remoteStore,d),hn(r,d)}).catch(Fe)]:[3,2];case 1:g.sent(),g.label=2;case 2:return[2]}})},h=0,l=n,p.label=7;case 7:return h<l.length?(f=l[h],[5,c(f)]):[3,10];case 8:p.sent(),p.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Cs(e){var t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=kh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ev.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=vv.bind(null,t),t.vo._r=uv.bind(null,t.eventManager),t.vo.Mo=av.bind(null,t.eventManager),t}function Rs(e){var t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=gv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=yv.bind(null,t),t}var Lh=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return y(this,function(n){switch(n.label){case 0:return this.R=Ti(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return n.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return dh(this.persistence,new ph,t.initialUser,this.R)},e.prototype.qo=function(t){return new Vd(qd.bs,this.R)},e.prototype.Bo=function(t){return new wh},e.prototype.terminate=function(){return m(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),Ph=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Qo=n,o.cacheSizeBytes=r,o.forceOwnership=i,o.synchronizeTabs=!1,o}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r=this;return y(this,function(i){switch(i.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return i.sent(),[4,xd(this.localStore)];case 2:return i.sent(),[4,this.Qo.initialize(this,n)];case 3:return i.sent(),[4,Rs(this.Qo.syncEngine)];case 4:return i.sent(),[4,mn(this.Qo.remoteStore)];case 5:return i.sent(),[4,this.persistence.He(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()})];case 6:return i.sent(),[2]}})})},t.prototype.Ko=function(n){return dh(this.persistence,new ph,n.initialUser,this.R)},t.prototype.Uo=function(n){var r=this.persistence.referenceDelegate.garbageCollector;return new wd(r,n.asyncQueue)},t.prototype.qo=function(n){var r=vs(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Ut.withCacheSize(this.cacheSizeBytes):Ut.DEFAULT;return new Sd(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,bh(),Cr(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(n){return new wh},t}(Lh),Cv=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r,!1)||this).Qo=n,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r,i=this;return y(this,function(o){switch(o.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof Wi?(this.sharedClientState.syncEngine={ui:_v.bind(null,r),ai:Nv.bind(null,r),hi:Dv.bind(null,r),fn:Av.bind(null,r),ci:Tv.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(s){return m(i,void 0,void 0,function(){return y(this,function(u){switch(u.label){case 0:return[4,Sv(this.Qo.syncEngine,s)];case 1:return u.sent(),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):s||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},t.prototype.Bo=function(n){var r=bh();if(!Wi.yt(r))throw new w(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var i=vs(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new Wi(r,n.asyncQueue,i,n.clientId,n.initialUser)},t}(Ph),To=function(){function e(){}return e.prototype.initialize=function(t,n){return m(this,void 0,void 0,function(){var r=this;return y(this,function(i){switch(i.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(o){return zu(r.syncEngine,o,1)},this.remoteStore.remoteSyncer.handleCredentialChange=bv.bind(null,this.syncEngine),[4,Eo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new sv},e.prototype.createDatastore=function(t){var n,r=Ti(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new Gd(n));return function(o,s,u){return new Qd(o,s,u)}(t.credentials,i,r)},e.prototype.createRemoteStore=function(t){var n,r,i,o,s,u=this;return n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(a){return zu(u.syncEngine,a,0)},s=Bu.yt()?new Bu:new Bd,new Yd(n,r,i,o,s)},e.prototype.createSyncEngine=function(t,n){return function(r,i,o,s,u,a,c){var h=new lv(r,i,o,s,u,a);return c&&(h.$o=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)},e.prototype.terminate=function(){return function(t){return m(this,void 0,void 0,function(){var n;return y(this,function(r){switch(r.label){case 0:return n=_(t),T("RemoteStore","RemoteStore shutting down."),n.Or.add(5),[4,yn(n)];case 1:return r.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Si=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,n){var r=this;this.muted||setTimeout(function(){r.muted||t(n)},0)},e}(),Rv=function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return m(this,void 0,void 0,function(){var n,r=this;return y(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new w(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(o,s){return m(this,void 0,void 0,function(){var u,a,c,h,l,f;return y(this,function(p){switch(p.label){case 0:return u=_(o),a=Kn(u.R)+"/documents",c={documents:s.map(function(d){return Bn(u.R,d)})},[4,u.$i("BatchGetDocuments",a,c)];case 1:return h=p.sent(),l=new Map,h.forEach(function(d){var g=function(b,I){return"found"in I?function(N,A){k(!!A.found),A.found.name,A.found.updateTime;var O=$t(N,A.found.name),F=bt(A.found.updateTime),j=new Ct({mapValue:{fields:A.found.fields}});return dt.newFoundDocument(O,F,j)}(b,I):"missing"in I?function(N,A){k(!!A.missing),k(!!A.readTime);var O=$t(N,A.missing),F=bt(A.readTime);return dt.newNoDocument(O,F)}(b,I):D()}(u.R,d);l.set(g.key.toString(),g)}),f=[],[2,(s.forEach(function(d){var g=l.get(d.toString());k(!!g),f.push(g)}),f)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(o){return r.recordVersion(o)}),n)]}})})},e.prototype.set=function(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new hr(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return m(this,void 0,void 0,function(){var t,n=this;return y(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(i){t.delete(i.key.toString())}),t.forEach(function(i,o){var s=C.fromPath(o);n.mutations.push(new us(s,n.precondition(s)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var s,u,a;return y(this,function(c){switch(c.label){case 0:return s=_(i),u=Kn(s.R)+"/documents",a={writes:o.map(function(h){return Hr(s.R,h)})},[4,s.Ni("Commit",u,a)];case 1:return c.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw D();n=L.min()}var r=this.readVersions.get(t.key.toString());if(r){if(!n.isEqual(r))throw new w(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)},e.prototype.precondition=function(t){var n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?ft.updateTime(n):ft.none()},e.prototype.preconditionForUpdate=function(t){var n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(L.min()))throw new w(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ft.updateTime(n)}return ft.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}(),kv=function(){function e(t,n,r,i){this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ec=5,this.Zi=new ys(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return m(t,void 0,void 0,function(){var n,r,i=this;return y(this,function(o){return n=new Rv(this.datastore),(r=this.sc(n))&&r.then(function(s){i.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){i.deferred.resolve(s)}).catch(function(u){i.ic(u)})})}).catch(function(s){i.ic(s)}),[2]})})})},e.prototype.sc=function(t){try{var n=this.updateFunction(t);return!Le(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}},e.prototype.ic=function(t){var n=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return n.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if(t.name==="FirebaseError"){var n=t.code;return n==="aborted"||n==="failed-precondition"||!Bc(n)}return!1},e}(),xv=function(){function e(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=it.UNAUTHENTICATED,this.clientId=Ic.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(o){return m(i,void 0,void 0,function(){return y(this,function(s){switch(s.label){case 0:return T("FirestoreClient","Received user=",o.uid),[4,this.credentialListener(o)];case 1:return s.sent(),this.user=o,[2]}})})})}return e.prototype.getConfiguration=function(){return m(this,void 0,void 0,function(){return y(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new w(v.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new _t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return m(t,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:o.sent(),o.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return r=o.sent(),i=bn(r,"Failed to shutdown persistence"),n.reject(i),[3,6];case 6:return[2]}})})}),n.promise},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fh(e,t){return m(this,void 0,void 0,function(){var n,r,i=this;return y(this,function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener(function(s){return m(i,void 0,void 0,function(){return y(this,function(u){switch(u.label){case 0:return r.isEqual(s)?[3,2]:[4,vh(t.localStore,s)];case 1:u.sent(),r=s,u.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function Mh(e,t){return m(this,void 0,void 0,function(){var n,r;return y(this,function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,ks(e)];case 1:return n=i.sent(),T("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener(function(o){return function(s,u){return m(this,void 0,void 0,function(){var a,c;return y(this,function(h){switch(h.label){case 0:return(a=_(s)).asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials"),c=fe(a),a.Or.add(3),[4,yn(a)];case 1:return h.sent(),c&&a.Br.set("Unknown"),[4,a.remoteSyncer.handleCredentialChange(u)];case 2:return h.sent(),a.Or.delete(3),[4,lr(a)];case 3:return h.sent(),[2]}})})}(t.remoteStore,o)}),e.onlineComponents=t,[2]}})})}function ks(e){return m(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(T("FirestoreClient","Using default OfflineComponentProvider"),[4,Fh(e,new Lh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Ai(e){return m(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(T("FirestoreClient","Using default OnlineComponentProvider"),[4,Mh(e,new To)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function $u(e){return ks(e).then(function(t){return t.persistence})}function Vh(e){return ks(e).then(function(t){return t.localStore})}function Hu(e){return Ai(e).then(function(t){return t.remoteStore})}function Uh(e){return Ai(e).then(function(t){return t.syncEngine})}function ln(e){return m(this,void 0,void 0,function(){var t,n;return y(this,function(r){switch(r.label){case 0:return[4,Ai(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=fv.bind(null,t.syncEngine),n.onUnlisten=pv.bind(null,t.syncEngine),n)]}})})}function Qu(e,t,n){var r=this;n===void 0&&(n={});var i=new _t;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return y(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new Si({next:function(d){a.enqueueAndForget(function(){return Is(u,p)});var g=d.docs.has(c);!g&&d.fromCache?l.reject(new w(v.UNAVAILABLE,"Failed to get document because the client is offline.")):g&&d.fromCache&&h&&h.source==="server"?l.reject(new w(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):l.resolve(d)},error:function(d){return l.reject(d)}}),p=new _s(or(c.path),f,{includeMetadataChanges:!0,so:!0});return Es(u,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}function Wu(e,t,n){var r=this;n===void 0&&(n={});var i=new _t;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return y(this,function(s){switch(s.label){case 0:return o=function(u,a,c,h,l){var f=new Si({next:function(d){a.enqueueAndForget(function(){return Is(u,p)}),d.fromCache&&h.source==="server"?l.reject(new w(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(d)},error:function(d){return l.reject(d)}}),p=new _s(c,f,{includeMetadataChanges:!0,so:!0});return Es(u,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}var Ov=function(e,t,n,r,i,o,s,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u},ti=function(){function e(t,n){this.projectId=t,this.database=n||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database==="(default)"},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Yu=new Map,qh=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Xu=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){this.changeListener=n,t.enqueueRetryable(function(){return n(it.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Lv=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){var r=this;this.changeListener=n,t.enqueueRetryable(function(){return n(r.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Pv=function(){function e(t){var n=this;this.currentUser=it.UNAUTHENTICATED,this.oc=new _t,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};var r=function(i){T("FirebaseCredentialsProvider","Auth detected"),n.auth=i,n.auth.addAuthTokenListener(n.uc)};t.onInit(function(i){return r(i)}),setTimeout(function(){if(!n.auth){var i=t.getImmediate({optional:!0});i?r(i):(T("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,n=this.cc,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(function(i){return t.cc!==n?(T("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):i?(k(typeof i.accessToken=="string"),new qh(i.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return y(this,function(i){switch(i.label){case 0:return[4,this.oc.promise];case 1:return i.sent(),[4,n(this.currentUser)];case 2:return i.sent(),this.changeListener=n,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return k(t===null||typeof t=="string"),new it(t)},e}(),Fv=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r,this.type="FirstParty",this.user=it.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},n=this.hc.auth.getAuthHeaderValueForFirstParty([]);return n&&(t.Authorization=n),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),Mv=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r}return e.prototype.getToken=function(){return Promise.resolve(new Fv(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,n){t.enqueueRetryable(function(){return n(it.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xs(e,t,n){if(!n)throw new w(v.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function Os(e,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new w(v.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function jh(e,t,n,r){if(t===!0&&r===!0)throw new w(v.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function Ju(e){if(!C.isDocumentKey(e))throw new w(v.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Zu(e){if(C.isDocumentKey(e))throw new w(v.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function Ni(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";var t=function(n){if(n.constructor){var r=/function\s+([^\s(]+)\s*\(/.exec(n.constructor.toString());if(r&&r.length>1)return r[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return typeof e=="function"?"a function":D()}function q(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new w(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ni(e);throw new w(v.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function ta(e,t){if(t<=0)throw new w(v.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ea=function(){function e(t){var n;if(t.host===void 0){if(t.ssl!==void 0)throw new w(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new w(v.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,jh("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),Gn=function(){function e(t,n){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ea({}),this._settingsFrozen=!1,t instanceof ti?(this._databaseId=t,this._credentials=new Xu):(this._app=t,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new w(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ti(r.options.projectId)}(t),this._credentials=new Pv(n))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new w(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return this._terminateTask!==void 0},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new w(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ea(t),t.credentials!==void 0&&(this._credentials=function(n){if(!n)return new Xu;switch(n.type){case"gapi":var r=n.client;return k(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Mv(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new w(v.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return t=this,(n=Yu.get(t))&&(T("ComponentProvider","Removing Datastore"),Yu.delete(t),n.terminate()),Promise.resolve();var t,n},e}(),G=function(){function e(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new se(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),xt=function(){function e(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),se=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,or(i))||this)._path=i,o.type="collection",o}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._path.popLast();return n.isEmpty()?null:new G(this.firestore,null,new C(n))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(n){return new t(this.firestore,n,this._path)},t}(xt);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=X(e),xs("collection","path",t),e instanceof Gn)return Zu(n=U.fromString.apply(U,H([t],r))),new se(e,null,n);if(!(e instanceof G||e instanceof se))throw new w(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Zu(n=U.fromString.apply(U,H([e.path],r)).child(U.fromString(t))),new se(e.firestore,null,n)}function Rr(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=X(e),arguments.length===1&&(t=Ic.u()),xs("doc","path",t),e instanceof Gn)return Ju(n=U.fromString.apply(U,H([t],r))),new G(e,null,new C(n));if(!(e instanceof G||e instanceof se))throw new w(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ju(n=e._path.child(U.fromString.apply(U,H([t],r)))),new G(e.firestore,e instanceof se?e.converter:null,new C(n))}function Kh(e,t){return e=X(e),t=X(t),(e instanceof G||e instanceof se)&&(t instanceof G||t instanceof se)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function zh(e,t){return e=X(e),t=X(t),e instanceof xt&&t instanceof xt&&e.firestore===t.firestore&&sr(e._query,t._query)&&e.converter===t.converter}var Vv=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new ys(this,"async_queue_retry"),this.Ic=function(){var r=Cr();r&&T("AsyncQueue","Visibility state changed to "+r.visibilityState),t.Zi.Gi()};var n=Cr();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var n=Cr();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var n=this;if(this.Ac(),this._c)return new Promise(function(){});var r=new _t;return this.Rc(function(){return n._c&&n.Ec?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)}).then(function(){return r.promise})},e.prototype.enqueueRetryable=function(t){var n=this;this.enqueueAndForget(function(){return n.wc.push(t),n.bc()})},e.prototype.bc=function(){return m(this,void 0,void 0,function(){var t,n=this;return y(this,function(r){switch(r.label){case 0:if(this.wc.length===0)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return r.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Pe(t=r.sent()))throw t;return T("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.bc()}),r.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var n=this,r=this.dc.then(function(){return n.gc=!0,t().catch(function(i){throw n.yc=i,n.gc=!1,Y("INTERNAL UNHANDLED ERROR: ",function(o){var s=o.message||"";return o.stack&&(s=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),s}(i)),i}).then(function(i){return n.gc=!1,i})});return this.dc=r,r},e.prototype.enqueueAfterDelay=function(t,n,r){var i=this;this.Ac(),this.Tc.indexOf(t)>-1&&(n=0);var o=iv.createAndSchedule(this,t,n,r,function(s){return i.vc(s)});return this.mc.push(o),o},e.prototype.Ac=function(){this.yc&&D()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return m(this,void 0,void 0,function(){var t;return y(this,function(n){switch(n.label){case 0:return[4,t=this.dc];case 1:n.sent(),n.label=2;case 2:if(t!==this.dc)return[3,0];n.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var n=0,r=this.mc;n<r.length;n++)if(r[n].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var n=this;return this.Pc().then(function(){n.mc.sort(function(s,u){return s.targetTimeMs-u.targetTimeMs});for(var r=0,i=n.mc;r<i.length;r++){var o=i[r];if(o.skipDelay(),t!=="all"&&o.timerId===t)break}return n.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var n=this.mc.indexOf(t);this.mc.splice(n,1)},e}();function fn(e){return function(t,n){if(typeof t!="object"||t===null)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&typeof r[s]=="function")return!0}return!1}(e)}var Uv=-1,Z=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).type="firestore",i._queue=new Vv,i._persistenceKey="name"in n?n.name:"[DEFAULT]",i}return R(t,e),t.prototype._terminate=function(){return this._firestoreClient||Gh(this),this._firestoreClient.terminate()},t}(Gn);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lt(e){return e._firestoreClient||Gh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Gh(e){var t,n=e._freezeSettings(),r=function(i,o,s,u){return new Ov(i,o,s,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,u.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new xv(e._credentials,e._queue,r)}function na(e,t,n){var r=this,i=new _t;return e.asyncQueue.enqueue(function(){return m(r,void 0,void 0,function(){var o;return y(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,Fh(e,n)];case 1:return s.sent(),[4,Mh(e,t)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!function(u){return u.name==="FirebaseError"?u.code===v.FAILED_PRECONDITION||u.code===v.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&u instanceof DOMException)||u.code===22||u.code===20||u.code===11}(o=s.sent()))throw o;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function ra(e){if(e._initialized||e._terminated)throw new w(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jt=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)if(t[r].length===0)throw new w(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vt(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),ke=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(Tt.fromBase64String(t))}catch(n){throw new w(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},e.fromUint8Array=function(t){return new e(Tt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),Me=function(e){this._methodName=e},Di=function(){function e(t,n){if(!isFinite(t)||t<-90||t>90)throw new w(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new w(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return P(this._lat,t._lat)||P(this._long,t._long)},e}(),qv=/^__.*__$/,jv=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return this.fieldMask!==null?new le(t,this.data,this.fieldMask,n,this.fieldTransforms):new cr(t,this.data,n,this.fieldTransforms)},e}(),$h=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return new le(t,this.data,this.fieldMask,n,this.fieldTransforms)},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}var Qh=function(){function e(t,n,r,i,o,s){this.settings=t,this.databaseId=n,this.R=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Cc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.$c(t),i},e.prototype.Oc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.Cc(),i},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return ei(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return this.fieldMask.find(function(n){return t.isPrefixOf(n)})!==void 0||this.fieldTransforms.find(function(n){return t.isPrefixOf(n.field)})!==void 0},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(t.length===0)throw this.Lc("Document fields must not be empty");if(Hh(this.Nc)&&qv.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),Bv=function(){function e(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.R=r||Ti(t)}return e.prototype.Uc=function(t,n,r,i){return i===void 0&&(i=!1),new Qh({Nc:t,methodName:n,qc:r,path:Vt.emptyPath(),Fc:!1,Bc:i},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function Ve(e){var t=e._freezeSettings(),n=Ti(e._databaseId);return new Bv(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Ci(e,t,n,r,i,o){o===void 0&&(o={});var s=e.Uc(o.merge||o.mergeFields?2:0,t,n,i);Ms("Data must be an object, but it was:",s,r);var u,a,c=Xh(r,s);if(o.merge)u=new Xe(s.fieldMask),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=_o(t,f[l],n);if(!s.contains(p))throw new w(v.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Zh(h,p)||h.push(p)}u=new Xe(h),a=s.fieldTransforms.filter(function(d){return u.covers(d.field)})}else u=null,a=s.fieldTransforms;return new jv(new Ct(c),u,a)}var Ls=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){if(n.Nc!==2)throw n.Nc===1?n.Lc(this._methodName+"() can only appear at the top level of your update data"):n.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return n.fieldMask.push(n.path),null},t.prototype.isEqual=function(n){return n instanceof t},t}(Me);function Wh(e,t,n){return new Qh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Kv=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){return new ar(n.path,new en)},t.prototype.isEqual=function(n){return n instanceof t},t}(Me),zv=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=Wh(this,n,!0),i=this.Kc.map(function(s){return Ue(s,r)}),o=new Ce(i);return new ar(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(Me),Gv=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=Wh(this,n,!0),i=this.Kc.map(function(s){return Ue(s,r)}),o=new Re(i);return new ar(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(Me),$v=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Qc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=new nn(n.R,Fc(n.R,this.Qc));return new ar(n.path,r)},t.prototype.isEqual=function(n){return this===n},t}(Me);function Ps(e,t,n,r){var i=e.Uc(1,t,n);Ms("Data must be an object, but it was:",i,r);var o=[],s=Ct.empty();Oe(r,function(a,c){var h=Vs(t,a,n);c=X(c);var l=i.Oc(h);if(c instanceof Ls)o.push(h);else{var f=Ue(c,l);f!=null&&(o.push(h),s.set(h,f))}});var u=new Xe(o);return new $h(s,u,i.fieldTransforms)}function Fs(e,t,n,r,i,o){var s=e.Uc(1,t,n),u=[_o(t,r,n)],a=[i];if(o.length%2!=0)throw new w(v.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(_o(t,o[c])),a.push(o[c+1]);for(var h=[],l=Ct.empty(),f=u.length-1;f>=0;--f)if(!Zh(h,u[f])){var p=u[f],d=a[f];d=X(d);var g=s.Oc(p);if(d instanceof Ls)h.push(p);else{var b=Ue(d,g);b!=null&&(h.push(p),l.set(p,b))}}var I=new Xe(h);return new $h(l,I,s.fieldTransforms)}function Yh(e,t,n,r){return r===void 0&&(r=!1),Ue(n,e.Uc(r?4:3,t))}function Ue(e,t){if(Jh(e=X(e)))return Ms("Unsupported field value:",t,e),Xh(e,t);if(e instanceof Me)return function(n,r){if(!Hh(r.Nc))throw r.Lc(n._methodName+"() can only be used with update() and set()");if(!r.path)throw r.Lc(n._methodName+"() is not currently supported inside arrays");var i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&t.Nc!==4)throw t.Lc("Nested arrays are not supported");return function(n,r){for(var i=[],o=0,s=0,u=n;s<u.length;s++){var a=Ue(u[s],r.Mc(o));a==null&&(a={nullValue:"NULL_VALUE"}),i.push(a),o++}return{arrayValue:{values:i}}}(e,t)}return function(n,r){if((n=X(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Fc(r.R,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){var i=It.fromDate(n);return{timestampValue:jn(r.R,i)}}if(n instanceof It)return i=new It(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:jn(r.R,i)};if(n instanceof Di)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ke)return{bytesValue:$c(r.R,n._byteString)};if(n instanceof G){i=r.databaseId;var o=n.firestore._databaseId;if(!o.isEqual(i))throw r.Lc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:hs(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Lc("Unsupported field value: "+Ni(n))}(e,t)}function Xh(e,t){var n={};return _c(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Oe(e,function(r,i){var o=Ue(i,t.kc(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function Jh(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof It||e instanceof Di||e instanceof ke||e instanceof G||e instanceof Me)}function Ms(e,t,n){if(!Jh(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){var r=Ni(n);throw r==="an object"?t.Lc(e+" a custom object"):t.Lc(e+" "+r)}}function _o(e,t,n){if((t=X(t))instanceof jt)return t._internalPath;if(typeof t=="string")return Vs(e,t);throw ei("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Hv=new RegExp("[~\\*/\\[\\]]");function Vs(e,t,n){if(t.search(Hv)>=0)throw ei("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return new(jt.bind.apply(jt,H([void 0],t.split("."))))()._internalPath}catch{throw ei("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function ei(e,t,n,r,i){var o=r&&!r.isEmpty(),s=i!==void 0,u="Function "+t+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new w(v.INVALID_ARGUMENT,(u+=". ")+e+a)}function Zh(e,t){return e.some(function(n){return n.isEqual(t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $n=function(){function e(t,n,r,i,o){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new G(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return this._document!==null},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Qv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var n=this._document.data.field(ni("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}},e}(),Qv=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}($n);function ni(e,t){return typeof t=="string"?Vs(e,t):t instanceof jt?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var we=function(){function e(t,n){this.hasPendingWrites=t,this.fromCache=n}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),Qt=function(e){function t(n,r,i,o,s,u){var a=this;return(a=e.call(this,n,r,i,o,u)||this)._firestore=n,a._firestoreImpl=n,a.metadata=s,a}return R(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(n){if(n===void 0&&(n={}),this._document){if(this._converter){var r=new Rn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}},t.prototype.get=function(n,r){if(r===void 0&&(r={}),this._document){var i=this._document.data.field(ni("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i,r.serverTimestamps)}},t}($n),Rn=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return n===void 0&&(n={}),e.prototype.data.call(this,n)},t}(Qt),re=function(){function e(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new we(i.hasPendingWrites,i.fromCache),this.query=r}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(n){return t.push(n)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.size===0},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(i){t.call(n,new Rn(r._firestore,r._userDataWriter,i.key,i,new we(r._snapshot.mutatedKeys.has(i.key),r._snapshot.fromCache),r.query.converter))})},e.prototype.docChanges=function(t){t===void 0&&(t={});var n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){var o=0;return r._snapshot.docChanges.map(function(u){return{type:"added",doc:new Rn(r._firestore,r._userDataWriter,u.doc.key,u.doc,new we(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}})}var s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(function(u){return i||u.type!==3}).map(function(u){var a=new Rn(r._firestore,r._userDataWriter,u.doc.key,u.doc,new we(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,h=-1;return u.type!==0&&(c=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),u.type!==1&&(h=(s=s.add(u.doc)).indexOf(u.doc.key)),{type:Wv(u.type),doc:a,oldIndex:c,newIndex:h}})}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges},e}();function Wv(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function tl(e,t){return e instanceof Qt&&t instanceof Qt?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(e._document===null?t._document===null:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof re&&t instanceof re&&e._firestore===t._firestore&&zh(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function el(e){if($r(e)&&e.explicitOrderBy.length===0)throw new w(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var fr=function(){};function Zt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var Yv=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).jc=n,o.Wc=r,o.Gc=i,o.type="where",o}return R(t,e),t.prototype._apply=function(n){var r=Ve(n.firestore),i=function(o,s,u,a,c,h,l){var f;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new w(v.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+h+"' queries on FieldPath.documentId().");if(h==="in"||h==="not-in"){aa(l,h);for(var p=[],d=0,g=l;d<g.length;d++){var b=g[d];p.push(ua(a,o,b))}f={arrayValue:{values:p}}}else f=ua(a,o,l)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||aa(l,h),f=Yh(u,"where",l,h==="in"||h==="not-in");var I=kt.create(c,h,f);return function(N,A){if(A.g()){var O=os(N);if(O!==null&&!O.isEqual(A.field))throw new w(v.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+O.toString()+"' and '"+A.field.toString()+"'");var F=is(N);F!==null&&rl(N,A.field,F)}var j=function(rt,Li){for(var En=0,qs=rt.filters;En<qs.length;En++){var js=qs[En];if(Li.indexOf(js.op)>=0)return js.op}return null}(N,function(rt){switch(rt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(A.op));if(j!==null)throw j===A.op?new w(v.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+A.op.toString()+"' filter."):new w(v.INVALID_ARGUMENT,"Invalid query. You cannot use '"+A.op.toString()+"' filters with '"+j.toString()+"' filters.")}(o,I),I}(n._query,0,r,n.firestore._databaseId,this.jc,this.Wc,this.Gc);return new xt(n.firestore,n.converter,function(o,s){var u=o.filters.concat([s]);return new Yt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),u,o.limit,o.limitType,o.startAt,o.endAt)}(n._query,i))},t}(fr),Xv=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).jc=n,i.zc=r,i.type="orderBy",i}return R(t,e),t.prototype._apply=function(n){var r=function(i,o,s){if(i.startAt!==null)throw new w(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new w(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var u=new He(o,s);return function(a,c){if(is(a)===null){var h=os(a);h!==null&&rl(a,h,c.field)}}(i,u),u}(n._query,this.jc,this.zc);return new xt(n.firestore,n.converter,function(i,o){var s=i.explicitOrderBy.concat([o]);return new Yt(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(n._query,r))},t}(fr),ia=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return R(t,e),t.prototype._apply=function(n){return new xt(n.firestore,n.converter,kc(n._query,this.Hc,this.Jc))},t}(fr),oa=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=nl(n,this.type,this.Yc,this.Xc);return new xt(n.firestore,n.converter,function(i,o){return new Yt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)}(n._query,r))},t}(fr),sa=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=nl(n,this.type,this.Yc,this.Xc);return new xt(n.firestore,n.converter,function(i,o){return new Yt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)}(n._query,r))},t}(fr);function nl(e,t,n,r){if(n[0]=X(n[0]),n[0]instanceof $n)return function(o,s,u,a,c){if(!a)throw new w(v.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+u+"().");for(var h=[],l=0,f=tn(o);l<f.length;l++){var p=f[l];if(p.field.isKeyField())h.push(Kr(s,a.key));else{var d=a.data.field(p.field);if(es(d))throw new w(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){var g=p.field.canonicalString();throw new w(v.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+g+"' (used as the orderBy) does not exist.")}h.push(d)}}return new qn(h,c)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Ve(e.firestore);return function(o,s,u,a,c,h){var l=o.explicitOrderBy;if(c.length>l.length)throw new w(v.INVALID_ARGUMENT,"Too many arguments provided to "+a+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var f=[],p=0;p<c.length;p++){var d=c[p];if(l[p].field.isKeyField()){if(typeof d!="string")throw new w(v.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+a+"(), but got a "+typeof d);if(!ss(o)&&d.indexOf("/")!==-1)throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+a+"() must be a plain document ID, but '"+d+"' contains a slash.");var g=o.path.child(U.fromString(d));if(!C.isDocumentKey(g))throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+a+"() must result in a valid document path, but '"+g+"' is not because it contains an odd number of segments.");var b=new C(g);f.push(Kr(s,b))}else{var I=Yh(u,a,d);f.push(I)}}return new qn(f,h)}(e._query,e.firestore._databaseId,i,t,n,r)}function ua(e,t,n){if(typeof(n=X(n))=="string"){if(n==="")throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!ss(t)&&n.indexOf("/")!==-1)throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(U.fromString(n));if(!C.isDocumentKey(r))throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Kr(e,new C(r))}if(n instanceof G)return Kr(e,n._key);throw new w(v.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ni(n)+".")}function aa(e,t){if(!Array.isArray(e)||e.length===0)throw new w(v.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new w(v.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function rl(e,t,n){if(!n.isEqual(t))throw new w(v.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Us=function(){function e(){}return e.prototype.convertValue=function(t,n){switch(n===void 0&&(n="none"),De(t)){case 0:return null;case 1:return t.booleanValue;case 2:return W(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(Je(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw D()}},e.prototype.convertObject=function(t,n){var r=this,i={};return Oe(t.fields,function(o,s){i[o]=r.convertValue(s,n)}),i},e.prototype.convertGeoPoint=function(t){return new Di(W(t.latitude),W(t.longitude))},e.prototype.convertArray=function(t,n){var r=this;return(t.values||[]).map(function(i){return r.convertValue(i,n)})},e.prototype.convertServerTimestamp=function(t,n){switch(n){case"previous":var r=Ac(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Vn(t));default:return null}},e.prototype.convertTimestamp=function(t){var n=ue(t);return new It(n.seconds,n.nanos)},e.prototype.convertDocumentKey=function(t,n){var r=U.fromString(t);k(th(r));var i=new ti(r.get(1),r.get(3)),o=new C(r.popFirst(5));return i.isEqual(n)||Y("Document "+o+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+n.projectId+"/"+n.database+") instead."),o},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Jv=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t}(Us),Zv=function(){function e(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Ve(t)}return e.prototype.set=function(t,n,r){this._verifyNotCommitted();var i=ie(t,this._firestore),o=Ri(i.converter,n,r),s=Ci(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,ft.none())),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,u=ie(t,this._firestore);return s=typeof(n=X(n))=="string"||n instanceof jt?Fs(this._dataReader,"WriteBatch.update",u._key,n,r,i):Ps(this._dataReader,"WriteBatch.update",u._key,n),this._mutations.push(s.toMutation(u._key,ft.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var n=ie(t,this._firestore);return this._mutations=this._mutations.concat(new hr(n._key,ft.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new w(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ie(e,t){if((e=X(e)).firestore!==t)throw new w(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ie=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t}(Us);function ca(e,t,n){e=q(e,G);var r=q(e.firestore,Z),i=Ri(e.converter,t,n);return pr(r,[Ci(Ve(r),"setDoc",e._key,i,e.converter!==null,n).toMutation(e._key,ft.none())])}function ha(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=q(e,G);var o=q(e.firestore,Z),s=Ve(o);return pr(o,[(typeof(t=X(t))=="string"||t instanceof jt?Fs(s,"updateDoc",e._key,t,n,r):Ps(s,"updateDoc",e._key,t)).toMutation(e._key,ft.exists(!0))])}function il(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=X(e);var s={includeMetadataChanges:!1},u=0;typeof i[u]!="object"||fn(i[u])||(s=i[u],u++);var a,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(fn(i[u])){var f=i[u];i[u]=(t=f.next)===null||t===void 0?void 0:t.bind(f),i[u+1]=(n=f.error)===null||n===void 0?void 0:n.bind(f),i[u+2]=(r=f.complete)===null||r===void 0?void 0:r.bind(f)}if(e instanceof G)c=q(e.firestore,Z),h=or(e._key.path),a={next:function(g){i[u]&&i[u](So(c,e,g))},error:i[u+1],complete:i[u+2]};else{var p=q(e,xt);c=q(p.firestore,Z),h=p._query;var d=new Ie(c);a={next:function(g){i[u]&&i[u](new re(c,d,p,g))},error:i[u+1],complete:i[u+2]},el(e._query)}return function(g,b,I,N){var A=this,O=new Si(N),F=new _s(b,O,I);return g.asyncQueue.enqueueAndForget(function(){return m(A,void 0,void 0,function(){var j;return y(this,function(rt){switch(rt.label){case 0:return j=Es,[4,ln(g)];case 1:return[2,j.apply(void 0,[rt.sent(),F])]}})})}),function(){O.Wo(),g.asyncQueue.enqueueAndForget(function(){return m(A,void 0,void 0,function(){var j;return y(this,function(rt){switch(rt.label){case 0:return j=Is,[4,ln(g)];case 1:return[2,j.apply(void 0,[rt.sent(),F])]}})})})}}(lt(c),h,l,a)}function pr(e,t){return function(n,r){var i=this,o=new _t;return n.asyncQueue.enqueueAndForget(function(){return m(i,void 0,void 0,function(){var s;return y(this,function(u){switch(u.label){case 0:return s=dv,[4,Uh(n)];case 1:return[2,s.apply(void 0,[u.sent(),r,o])]}})})}),o.promise}(lt(e),t)}function So(e,t,n){var r=n.docs.get(t._key),i=new Ie(e);return new Qt(e,i,t._key,r,new we(n.hasPendingWrites,n.fromCache),t.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tg=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this)._firestore=n,i}return R(t,e),t.prototype.get=function(n){var r=this,i=ie(n,this._firestore),o=new Ie(this._firestore);return e.prototype.get.call(this,n).then(function(s){return new Qt(r._firestore,o,i._key,s._document,new we(!1,!1),i.converter)})},t}(function(){function e(t,n){this._firestore=t,this._transaction=n,this._dataReader=Ve(t)}return e.prototype.get=function(t){var n=this,r=ie(t,this._firestore),i=new Jv(this._firestore);return this._transaction.lookup([r._key]).then(function(o){if(!o||o.length!==1)return D();var s=o[0];if(s.isFoundDocument())return new $n(n._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new $n(n._firestore,i,r._key,null,r.converter);throw D()})},e.prototype.set=function(t,n,r){var i=ie(t,this._firestore),o=Ri(i.converter,n,r),s=Ci(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,r);return this._transaction.set(i._key,s),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,u=ie(t,this._firestore);return s=typeof(n=X(n))=="string"||n instanceof jt?Fs(this._dataReader,"Transaction.update",u._key,n,r,i):Ps(this._dataReader,"Transaction.update",u._key,n),this._transaction.update(u._key,s),this},e.prototype.delete=function(t){var n=ie(t,this._firestore);return this._transaction.delete(n._key),this},e}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function la(){if(typeof Uint8Array=="undefined")throw new w(v.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function fa(){if(typeof atob=="undefined")throw new w(v.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ol=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return fa(),new e(ke.fromBase64String(t))},e.fromUint8Array=function(t){return la(),new e(ke.fromUint8Array(t))},e.prototype.toBase64=function(){return fa(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return la(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),eg=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,n){return function(r,i){ra(r=q(r,Z));var o=lt(r),s=r._freezeSettings(),u=new To;return na(o,u,new Ph(u,s.cacheSizeBytes,i==null?void 0:i.forceOwnership))}(t._delegate,{forceOwnership:n})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(n){ra(n=q(n,Z));var r=lt(n),i=n._freezeSettings(),o=new To;return na(r,o,new Cv(o,i.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(n){var r=this;if(n._initialized&&!n._terminated)throw new w(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new _t;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return m(r,void 0,void 0,function(){var o;return y(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,function(u){return m(this,void 0,void 0,function(){var a;return y(this,function(c){switch(c.label){case 0:return sn.yt()?(a=u+"main",[4,sn.delete(a)]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})}(vs(n._databaseId,n._persistenceKey))];case 1:return s.sent(),i.resolve(),[3,3];case 2:return o=s.sent(),i.reject(o),[3,3];case 3:return[2]}})})}),i.promise}(t._delegate)},e}(),sl=function(){function e(t,n,r){var i=this;this._delegate=n,this.Zc=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof ti||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var n=this._delegate._getSettings();t.merge||n.host===t.host||jr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},n),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,n,r){r===void 0&&(r={}),function(i,o,s,u){var a;u===void 0&&(u={});var c=(i=q(i,Gn))._getSettings();if(c.host!=="firestore.googleapis.com"&&c.host!==o&&jr("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},c),{host:o+":"+s,ssl:!1})),u.mockUserToken){var h,l;if(typeof u.mockUserToken=="string")h=u.mockUserToken,l=it.MOCK_USER;else{h=Il(u.mockUserToken,(a=i._app)===null||a===void 0?void 0:a.options.projectId);var f=u.mockUserToken.sub||u.mockUserToken.user_id;if(!f)throw new w(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new it(f)}i._credentials=new Lv(new qh(h,l))}}(this._delegate,t,n,r)},e.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return[4,$u(t)];case 1:return r=o.sent(),[4,Hu(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!0),function(s){var u=_(s);return u.Or.delete(0),lr(u)}(i))]}})})})}(lt(q(this._delegate,Z)))},e.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return[4,$u(t)];case 1:return r=o.sent(),[4,Hu(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!1),function(s){return m(this,void 0,void 0,function(){var u;return y(this,function(a){switch(a.label){case 0:return(u=_(s)).Or.add(0),[4,yn(u)];case 1:return a.sent(),u.Br.set("Offline"),[2]}})})}(i))]}})})})}(lt(q(this._delegate,Z)))},e.prototype.enablePersistence=function(t){var n=!1,r=!1;return t&&jh("synchronizeTabs",n=!!t.synchronizeTabs,"experimentalForceOwningTab",r=!!t.experimentalForceOwningTab),n?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,r)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new _t;return t.asyncQueue.enqueueAndForget(function(){return m(n,void 0,void 0,function(){var i;return y(this,function(o){switch(o.label){case 0:return i=mv,[4,Uh(t)];case 1:return[2,i.apply(void 0,[o.sent(),r])]}})})}),r.promise}(lt(q(this._delegate,Z)))},e.prototype.onSnapshotsInSync=function(t){return function(n,r){return function(i,o){var s=this,u=new Si(o);return i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return y(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.add(l),l.next()},[4,ln(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})}),function(){u.Wo(),i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var a;return y(this,function(c){switch(c.label){case 0:return a=function(h,l){_(h).Gr.delete(l)},[4,ln(i)];case 1:return[2,a.apply(void 0,[c.sent(),u])]}})})})}}(lt(n=q(n,Z)),fn(r)?r:{next:r})}(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new w(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new ri(this,Bh(this._delegate,t))}catch(n){throw gt(n,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new Te(this,Rr(this._delegate,t))}catch(n){throw gt(n,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new Oi(this,function(n,r){if(n=q(n,Gn),xs("collectionGroup","collection id",r),r.indexOf("/")>=0)throw new w(v.INVALID_ARGUMENT,"Invalid collection ID '"+r+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new xt(n,null,function(i){return new Yt(U.emptyPath(),i)}(r))}(this._delegate,t))}catch(n){throw gt(n,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var n=this;return function(r,i){return function(o,s){var u=this,a=new _t;return o.asyncQueue.enqueueAndForget(function(){return m(u,void 0,void 0,function(){var c;return y(this,function(h){switch(h.label){case 0:return[4,function(l){return Ai(l).then(function(f){return f.datastore})}(o)];case 1:return c=h.sent(),new kv(o.asyncQueue,c,s,a).run(),[2]}})})}),a.promise}(lt(r),function(o){return i(new tg(r,o))})}(this._delegate,function(r){return t(new ul(n,r))})},e.prototype.batch=function(){var t=this;return lt(this._delegate),new al(new Zv(this._delegate,function(n){return pr(t._delegate,n)}))},e.prototype.loadBundle=function(t){throw new w(v.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new w(v.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),ki=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new ol(new ke(n))},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return Te.eu(r,this.firestore,null)},t}(Us);function ng(e){var t;t=e,Pt.setLogLevel(t)}var ul=function(){function e(t,n){this._firestore=t,this._delegate=n,this._userDataWriter=new ki(t)}return e.prototype.get=function(t){var n=this,r=be(t);return this._delegate.get(r).then(function(i){return new Hn(n._firestore,new Qt(n._firestore._delegate,n._userDataWriter,i._key,i._document,i.metadata,r.converter))})},e.prototype.set=function(t,n,r){var i=be(t);return r?(Os("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=be(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,H([u,n,r],o)),this},e.prototype.delete=function(t){var n=be(t);return this._delegate.delete(n),this},e}(),al=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,n,r){var i=be(t);return r?(Os("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var u=be(t);return arguments.length===2?this._delegate.update(u,n):(i=this._delegate).update.apply(i,H([u,n,r],o)),this},e.prototype.delete=function(t){var n=be(t);return this._delegate.delete(n),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),xi=function(){function e(t,n,r){this._firestore=t,this._userDataWriter=n,this._delegate=r}return e.prototype.fromFirestore=function(t,n){var r=new Rn(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Qn(this._firestore,r),n!=null?n:{})},e.prototype.toFirestore=function(t,n){return n?this._delegate.toFirestore(t,n):this._delegate.toFirestore(t)},e.nu=function(t,n){var r=e.su,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new ki(t),n),i.set(n,o)),o},e}();xi.su=new WeakMap;var Te=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new ki(t)}return e.iu=function(t,n,r){if(t.length%2!=0)throw new w(v.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new G(n._delegate,r,new C(t)))},e.eu=function(t,n,r){return new e(n,new G(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new ri(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new ri(this.firestore,Bh(this._delegate,t))}catch(n){throw gt(n,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=X(t))instanceof G&&Kh(this._delegate,t)},e.prototype.set=function(t,n){n=Os("DocumentReference.set",n);try{return n?ca(this._delegate,t,n):ca(this._delegate,t)}catch(r){throw gt(r,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return arguments.length===1?ha(this._delegate,t):ha.apply(void 0,H([this._delegate,t,n],r))}catch(o){throw gt(o,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return pr(q((t=this._delegate).firestore,Z),[new hr(t._key,ft.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=cl(n),o=hl(n,function(s){return new Hn(t.firestore,new Qt(t.firestore._delegate,t._userDataWriter,s._key,s._document,s.metadata,t._delegate.converter))});return il(this._delegate,i,o)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=q(r,G);var i=q(r.firestore,Z),o=lt(i),s=new Ie(i);return function(u,a){var c=this,h=new _t;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return y(this,function(f){switch(f.label){case 0:return l=function(p,d,g){return m(this,void 0,void 0,function(){var b,I;return y(this,function(N){switch(N.label){case 0:return N.trys.push([0,2,,3]),[4,function(A,O){var F=_(A);return F.persistence.runTransaction("read document","readonly",function(j){return F.Mn.mn(j,O)})}(p,d)];case 1:return(I=N.sent()).isFoundDocument()?g.resolve(I):I.isNoDocument()?g.resolve(null):g.reject(new w(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return b=N.sent(),I=bn(b,"Failed to get document '"+d+" from cache"),g.reject(I),[3,3];case 3:return[2]}})})},[4,Vh(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._key).then(function(u){return new Qt(i,s,r._key,u,new we(u!==null&&u.hasLocalMutations,!0),r.converter)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=q(r,G);var i=q(r.firestore,Z);return Qu(lt(i),r._key,{source:"server"}).then(function(o){return So(i,r,o)})}(this._delegate):function(r){r=q(r,G);var i=q(r.firestore,Z);return Qu(lt(i),r._key).then(function(o){return So(i,r,o)})}(this._delegate)).then(function(r){return new Hn(n.firestore,new Qt(n.firestore._delegate,n._userDataWriter,r._key,r._document,r.metadata,n._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(xi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}();function gt(e,t,n){return e.message=e.message.replace(t,n),e}function cl(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(typeof r=="object"&&!fn(r))return r}return{}}function hl(e,t){var n,r,i;return{next:function(o){i.next&&i.next(t(o))},error:(n=(i=fn(e[0])?e[0]:fn(e[1])?e[1]:typeof e[0]=="function"?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Hn=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"ref",{get:function(){return new Te(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,n){return this._delegate.get(t,n)},e.prototype.isEqual=function(t){return tl(this._delegate,t._delegate)},e}(),Qn=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return this._delegate.data(n)},t}(Hn),Oi=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new ki(t)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,Zt(this._delegate,function(i,o,s){var u=o,a=ni("where",i);return new Yv(a,u,s)}(t,n,r)))}catch(i){throw gt(i,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,Zt(this._delegate,function(r,i){i===void 0&&(i="asc");var o=i,s=ni("orderBy",r);return new Xv(s,o)}(t,n)))}catch(r){throw gt(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,Zt(this._delegate,function(n){return ta("limit",n),new ia("limit",n,"F")}(t)))}catch(n){throw gt(n,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,Zt(this._delegate,function(n){return ta("limitToLast",n),new ia("limitToLast",n,"L")}(t)))}catch(n){throw gt(n,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Zt(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new oa("startAt",r,!0)}.apply(void 0,t)))}catch(r){throw gt(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Zt(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new oa("startAfter",r,!1)}.apply(void 0,t)))}catch(r){throw gt(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Zt(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new sa("endBefore",r,!0)}.apply(void 0,t)))}catch(r){throw gt(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Zt(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new sa("endAt",r,!1)}.apply(void 0,t)))}catch(r){throw gt(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return zh(this._delegate,t._delegate)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=q(r,xt);var i=q(r.firestore,Z),o=lt(i),s=new Ie(i);return function(u,a){var c=this,h=new _t;return u.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var l;return y(this,function(f){switch(f.label){case 0:return l=function(p,d,g){return m(this,void 0,void 0,function(){var b,I,N,A,O;return y(this,function(F){switch(F.label){case 0:return F.trys.push([0,2,,3]),[4,Xr(p,d,!0)];case 1:return O=F.sent(),b=new Rh(d,O.Bn),I=b._o(O.documents),N=b.applyChanges(I,!1),g.resolve(N.snapshot),[3,3];case 2:return A=F.sent(),O=bn(A,"Failed to execute query '"+d+" against cache"),g.reject(O),[3,3];case 3:return[2]}})})},[4,Vh(u)];case 1:return[2,l.apply(void 0,[f.sent(),a,h])]}})})}),h.promise}(o,r._query).then(function(u){return new re(i,s,r,u)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=q(r,xt);var i=q(r.firestore,Z),o=lt(i),s=new Ie(i);return Wu(o,r._query,{source:"server"}).then(function(u){return new re(i,s,r,u)})}(this._delegate):function(r){r=q(r,xt);var i=q(r.firestore,Z),o=lt(i),s=new Ie(i);return el(r._query),Wu(o,r._query).then(function(u){return new re(i,s,r,u)})}(this._delegate)).then(function(r){return new Ao(n.firestore,new re(n.firestore._delegate,n._userDataWriter,n._delegate,r._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=cl(n),o=hl(n,function(s){return new Ao(t.firestore,new re(t.firestore._delegate,t._userDataWriter,t._delegate,s._snapshot))});return il(this._delegate,i,o)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(xi.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(),rg=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new Qn(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),Ao=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"query",{get:function(){return new Oi(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(n){return new Qn(t._firestore,n)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var n=this;return this._delegate.docChanges(t).map(function(r){return new rg(n._firestore,r)})},e.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(i){t.call(n,new Qn(r._firestore,i))})},e.prototype.isEqual=function(t){return tl(this._delegate,t._delegate)},e}(),ri=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).firestore=n,i._delegate=r,i}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._delegate.parent;return n?new Te(this.firestore,n):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(n){try{return new Te(this.firestore,n===void 0?Rr(this._delegate):Rr(this._delegate,n))}catch(r){throw gt(r,"doc()","CollectionReference.doc()")}},t.prototype.add=function(n){var r=this;return function(i,o){var s=q(i.firestore,Z),u=Rr(i),a=Ri(i.converter,o);return pr(s,[Ci(Ve(i.firestore),"addDoc",u._key,a,i.converter!==null,{}).toMutation(u._key,ft.exists(!1))]).then(function(){return u})}(this._delegate,n).then(function(i){return new Te(r.firestore,i)})},t.prototype.isEqual=function(n){return Kh(this._delegate,n._delegate)},t.prototype.withConverter=function(n){return new t(this.firestore,n?this._delegate.withConverter(xi.nu(this.firestore,n)):this._delegate.withConverter(null))},t}(Oi);function be(e){return q(e,G)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ig=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(jt.bind.apply(jt,H([void 0],t)))}return e.documentId=function(){return new e(Vt.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=X(t))instanceof jt&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),og=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new Kv("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Ls("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new zv("arrayUnion",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Gv("arrayRemove",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(r){return new $v("increment",r)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}(),sg={Firestore:sl,GeoPoint:Di,Timestamp:It,Blob:ol,Transaction:ul,WriteBatch:al,DocumentReference:Te,DocumentSnapshot:Hn,Query:Oi,QueryDocumentSnapshot:Qn,QuerySnapshot:Ao,CollectionReference:ri,FieldPath:ig,FieldValue:og,setLogLevel:ng,CACHE_SIZE_UNLIMITED:Uv};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(e){(function(t,n){t.INTERNAL.registerComponent(new ii("firestore",function(r){var i=r.getProvider("app").getImmediate();return n(i,r.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},sg)))})(e,function(t,n){return new sl(t,new Z(t,n),new eg)}),e.registerVersion("@firebase/firestore","2.4.1")}ug(Se);const ag={apiKey:"AIzaSyA-ySaCuxD7s2IPMZSNM-XbzpdDOLVCTm8",authDomain:"chatapp-1a455.firebaseapp.com",projectId:"chatapp-1a455",storageBucket:"chatapp-1a455.appspot.com",messagingSenderId:"146735342472",appId:"1:146735342472:web:f7b30122903e30691b503d"};Se.apps.length||Se.initializeApp(ag);const ll=Se.firestore(),cg={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},Dt=new RTCPeerConnection(cg);let Tr=null,Yi=null;const pa=document.getElementById("webcamButton"),hg=document.getElementById("webcamVideo"),fl=document.getElementById("callButton"),pl=document.getElementById("callInput"),dl=document.getElementById("answerButton"),lg=document.getElementById("remoteVideo"),fg=document.getElementById("hangupButton");pa.onclick=async()=>{Tr=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),Yi=new MediaStream,Tr.getTracks().forEach(e=>{Dt.addTrack(e,Tr)}),Dt.ontrack=e=>{e.streams[0].getTracks().forEach(t=>{Yi.addTrack(t)})},hg.srcObject=Tr,lg.srcObject=Yi,fl.disabled=!1,dl.disabled=!1,pa.disabled=!0};fl.onclick=async()=>{const e=ll.collection("calls").doc(),t=e.collection("offerCandidates"),n=e.collection("answerCandidates");pl.value=e.id,Dt.onicecandidate=o=>{o.candidate&&t.add(o.candidate.toJSON())};const r=await Dt.createOffer();await Dt.setLocalDescription(r);const i={sdp:r.sdp,type:r.type};await e.set({offer:i}),e.onSnapshot(o=>{const s=o.data();if(!Dt.currentRemoteDescription&&(s==null?void 0:s.answer)){const u=new RTCSessionDescription(s.answer);Dt.setRemoteDescription(u)}}),n.onSnapshot(o=>{o.docChanges().forEach(s=>{if(s.type==="added"){const u=new RTCIceCandidate(s.doc.data());Dt.addIceCandidate(u)}})}),fg.disabled=!1};dl.onclick=async()=>{const e=pl.value,t=ll.collection("calls").doc(e),n=t.collection("answerCandidates"),r=t.collection("offerCandidates");Dt.onicecandidate=a=>{a.candidate&&n.add(a.candidate.toJSON())};const o=(await t.get()).data().offer;await Dt.setRemoteDescription(new RTCSessionDescription(o));const s=await Dt.createAnswer();await Dt.setLocalDescription(s);const u={type:s.type,sdp:s.sdp};await t.update({answer:u}),r.onSnapshot(a=>{a.docChanges().forEach(c=>{if(console.log(c),c.type==="added"){let h=c.doc.data();Dt.addIceCandidate(new RTCIceCandidate(h))}})})};
